<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="StÃ©phane Apiou">
<title>Installation d&#8217;un serveur Home Web Linux sur un Raspberry</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Installation d&#8217;un serveur Home Web Linux sur un Raspberry</h1>
<div class="details">
<span id="author" class="author">StÃ©phane Apiou</span><br>
<span id="email" class="email"><a href="mailto:stephane@apiou.org">stephane@apiou.org</a></span><br>
<span id="revnumber">version 1.7,</span>
<span id="revdate">2024-04-17</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_avant_propos">1. Avant propos</a></li>
<li><a href="#root_login">2. Se loguer root sur le serveur</a></li>
<li><a href="#pass_gen">3. Gestion des mots de passe</a></li>
<li><a href="#_choix_du_registrar">4. Choix du registrar</a></li>
<li><a href="#_installation_du_linux_sur_votre_raspberry_pi">5. Installation du linux sur votre Raspberry Pi</a>
<ul class="sectlevel2">
<li><a href="#_installation_avec_Ã©cran_et_clavier">5.1. Installation avec Ã©cran et clavier</a></li>
<li><a href="#_installation_headless">5.2. Installation Headless</a></li>
<li><a href="#_connexion_au_travers_du_rÃ©seau">5.3. Connexion au travers du rÃ©seau</a></li>
<li><a href="#_installation_headless_de_ubuntu_64">5.4. Installation Headless de Ubuntu 64</a></li>
</ul>
</li>
<li><a href="#_configuration_de_vnc">6. Configuration de VNC</a></li>
<li><a href="#_configuration_basique">7. Configuration basique</a>
<ul class="sectlevel2">
<li><a href="#domain_config">7.1. VÃ©rification du nom de serveur</a></li>
<li><a href="#_mettre_lÃ©diteur_de_votre_choix">7.2. Mettre l&#8217;Ã©diteur de votre choix</a></li>
<li><a href="#_installation_dun_repository_pour_etc">7.3. Installation d&#8217;un repository pour <code>/etc</code></a></li>
<li><a href="#_mise_Ã _jour_des_sources_de_paquets_debian_ou_ubuntu">7.4. Mise Ã  jour des sources de paquets Debian ou Ubuntu</a></li>
<li><a href="#_installation_des_paquets_de_base">7.5. Installation des paquets de base</a></li>
<li><a href="#_passage_de_la_locale_en_fr">7.6. Passage de la locale en FR</a></li>
<li><a href="#_installer_loutil_debfoster">7.7. Installer l&#8217;outil Debfoster</a></li>
<li><a href="#_crÃ©ation_dun_fichier_keeper_dans_etc">7.8. CrÃ©ation d&#8217;un fichier keeper dans /etc</a></li>
<li><a href="#_installation_des_mises_Ã _jours_automatiques">7.9. Installation des mises Ã  jours automatiques</a></li>
<li><a href="#_interdire_le_login_direct_en_root">7.10. Interdire le login direct en root</a></li>
<li><a href="#_crÃ©ation_dune_clÃ©_de_connexion_ssh_locale">7.11. CrÃ©ation d&#8217;une clÃ© de connexion ssh locale</a></li>
<li><a href="#_sudo_sans_mot_de_passe">7.12. Sudo sans mot de passe</a></li>
<li><a href="#_configuration_du_motd">7.13. Configuration du Motd</a></li>
<li><a href="#_installer_loutil_dselect">7.14. Installer l&#8217;outil dselect</a></li>
<li><a href="#swap_create">7.15. Ajouter un fichier de swap</a></li>
</ul>
</li>
<li><a href="#_installation_initiale_des_outils">8. Installation initiale des outils</a>
<ul class="sectlevel2">
<li><a href="#_installation_et_configuration_de_ispconfig">8.1. Installation et configuration de ISPConfig</a></li>
</ul>
</li>
<li><a href="#_configuration_manuelle_des_outils">9. Configuration Manuelle des outils</a>
<ul class="sectlevel2">
<li><a href="#_configuration_manuelle_de_postfix">9.1. Configuration manuelle de Postfix</a></li>
<li><a href="#_configuration_manuelle_de_mariadb">9.2. Configuration manuelle de MariaDB</a></li>
<li><a href="#_configuration_manuelle_dapache">9.3. Configuration manuelle d&#8217;Apache</a></li>
<li><a href="#_configuration_manuelle_d_awstats">9.4. Configuration manuelle d' Awstats</a></li>
<li><a href="#_configuration_manuelle_de_fail2ban">9.5. Configuration manuelle de Fail2ban</a></li>
<li><a href="#_installation_et_configuration_manuelle_de_pureftpd">9.6. Installation et configuration manuelle de PureFTPd</a></li>
<li><a href="#_installation_et_configuration_manuelle_de_phpmyadmin">9.7. Installation et configuration manuelle de Phpmyadmin</a></li>
<li><a href="#_installation_manuelle_du_webmail_roundcube">9.8. Installation manuelle du webmail Roundcube</a></li>
<li><a href="#_installation_manuelle_de_lets_encrypt">9.9. Installation manuelle de Let&#8217;s Encrypt</a></li>
</ul>
</li>
<li><a href="#After_manual_install">10. Suite de l&#8217;installation</a>
<ul class="sectlevel2">
<li><a href="#firewall">10.1. DÃ©blocage de port de firewall</a></li>
<li><a href="#_scan_des_vulnÃ©rabilitÃ©s">10.2. Scan des vulnÃ©rabilitÃ©s</a></li>
<li><a href="#_installation_du_systÃ¨me_dadministration_webmin">10.3. Installation du systÃ¨me d&#8217;administration Webmin</a></li>
</ul>
</li>
<li><a href="#domain-config">11. Configuration d&#8217;un domaine</a>
<ul class="sectlevel2">
<li><a href="#_login_initial">11.1. Login initial</a></li>
<li><a href="#_crÃ©ation_de_la_zone_dns_dun_domaine">11.2. CrÃ©ation de la zone DNS d&#8217;un domaine</a></li>
<li><a href="#_activation_de_dnssec">11.3. Activation de DNSSEC</a></li>
<li><a href="#_exemple_de_configuration_de_domaine">11.4. Exemple de configuration de domaine</a></li>
<li><a href="#_crÃ©ation_dun_sous_domaine">11.5. CrÃ©ation d&#8217;un sous domaine</a></li>
<li><a href="#domain-site">11.6. CrÃ©ation dâun site web</a></li>
<li><a href="#subdomain-site">11.7. CrÃ©ation dâun Site Vhost</a></li>
</ul>
</li>
<li><a href="#_associer_des_certificats_reconnu_Ã _vos_outils">12. Associer des certificats reconnu Ã  vos outils</a></li>
<li><a href="#_surveillance_du_serveur_avec_munin_et_monit">13. Surveillance du serveur avec Munin et Monit</a>
<ul class="sectlevel2">
<li><a href="#_note_prÃ©liminaire">13.1. Note prÃ©liminaire</a></li>
<li><a href="#_installation_et_configuration_de_munin">13.2. Installation et configuration de Munin</a></li>
<li><a href="#_activez_les_plugins_de_munin">13.3. Activez les plugins de Munin</a></li>
<li><a href="#_installer_et_configurer_monit">13.4. Installer et configurer Monit</a></li>
</ul>
</li>
<li><a href="#_configuration_de_la_messagerie">14. Configuration de la messagerie</a>
<ul class="sectlevel2">
<li><a href="#_configuration_de_lantispam_rspamd">14.1. Configuration de l&#8217;antispam rspamd</a></li>
<li><a href="#_crÃ©ation_du_serveur_de_messagerie">14.2. CrÃ©ation du serveur de messagerie</a></li>
<li><a href="#_finaliser_la_sÃ©curisation_de_votre_serveur_de_mail">14.3. Finaliser la sÃ©curisation de votre serveur de mail</a></li>
<li><a href="#_surveillance_du_statut_de_spammer">14.4. Surveillance du statut de Spammer</a></li>
<li><a href="#_crÃ©ation_de_lautoconfig_pour_thunderbird_et_android">14.5. CrÃ©ation de lâautoconfig pour Thunderbird et Android</a></li>
<li><a href="#_crÃ©ation_dautodiscover_pour_outlook">14.6. CrÃ©ation dâautodiscover pour Outlook</a></li>
<li><a href="#_crÃ©ation_dune_boite_mail">14.7. CrÃ©ation dâune boite mail</a></li>
<li><a href="#_configuration_de_votre_client_de_messagerie">14.8. Configuration de votre client de messagerie.</a></li>
<li><a href="#_mise_en_oeuvre_du_site_web_de_webmail">14.9. Mise en oeuvre du site web de webmail</a></li>
<li><a href="#_transfert_de_vos_boites_mails_imap">14.10. Transfert de vos boites mails IMAP</a></li>
</ul>
</li>
<li><a href="#_installation_de_docker_et_des_outils_associÃ©s">15. Installation de Docker et des outils associÃ©s</a>
<ul class="sectlevel2">
<li><a href="#_a_propos_des_raspberry_pi">15.1. A propos des Raspberry Pi</a></li>
<li><a href="#_installation_de_docker">15.2. Installation de Docker</a></li>
<li><a href="#_installation_de_docker_swarm">15.3. Installation de docker swarm</a></li>
<li><a href="#_choix_des_images_docker">15.4. Choix des images docker</a></li>
<li><a href="#_considÃ©rations_de_sÃ©curitÃ©">15.5. ConsidÃ©rations de sÃ©curitÃ©</a></li>
<li><a href="#_mise_Ã _jour_automatique_des_images">15.6. Mise Ã  jour automatique des images</a></li>
<li><a href="#_surveillance_et_redÃ©marrage_de_container">15.7. Surveillance et redÃ©marrage de container</a></li>
</ul>
</li>
<li><a href="#_configuration_de_docker_mirror">16. Configuration de Docker-mirror</a></li>
<li><a href="#_outils_web_de_gestion_des_containers">17. Outils web de gestion des containers</a>
<ul class="sectlevel2">
<li><a href="#_installation_de_yacht">17.1. Installation de Yacht</a></li>
<li><a href="#yacht_container_updt">17.2. Upgrade d&#8217;un container dans Yacht</a></li>
<li><a href="#_upgrade_de_yacht">17.3. Upgrade de Yacht</a></li>
<li><a href="#_installation_de_portainer">17.4. Installation de Portainer</a></li>
<li><a href="#port_container_updt">17.5. Upgrade d&#8217;un container dans Portainer</a></li>
<li><a href="#_upgrade_de_portainer">17.6. Upgrade de Portainer</a></li>
</ul>
</li>
<li><a href="#_installation_des_cms_joomla">18. Installation des CMS Joomla</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_joomla">18.1. CrÃ©ation du site web de Joomla</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es">18.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_crÃ©ation_de_lapplication_joomla">18.3. CrÃ©ation de l&#8217;application Joomla</a></li>
<li><a href="#_update_de_joomla">18.4. Update de Joomla</a></li>
</ul>
</li>
<li><a href="#_installation_des_cms_concrete5">19. Installation des CMS Concrete5</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_concrete5">19.1. CrÃ©ation du site web de Concrete5</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_2">19.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_crÃ©ation_de_lapplication_concrete5">19.3. CrÃ©ation de l&#8217;application Concrete5</a></li>
<li><a href="#_update_de_concrete5">19.4. Update de concrete5</a></li>
</ul>
</li>
<li><a href="#_installation_du_portail_wiki_mediawiki">20. Installation du portail wiki Mediawiki</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_mediawiki">20.1. CrÃ©ation du site web de Mediawiki</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_3">20.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_crÃ©ation_de_lapplication_mediawiki">20.3. CrÃ©ation de l&#8217;application Mediawiki</a></li>
<li><a href="#_update_du_serveur_mediawiki">20.4. Update du serveur Mediawiki</a></li>
</ul>
</li>
<li><a href="#_installation_dun_gestionnaire_de_blog_wordpress">21. Installation d&#8217;un gestionnaire de Blog Wordpress</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_wordpress">21.1. CrÃ©ation du site web de Wordpress</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_4">21.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_crÃ©ation_de_lapplication_wordpress">21.3. CrÃ©ation de l&#8217;application Wordpress</a></li>
<li><a href="#_update_de_wordpress">21.4. Update de wordpress</a></li>
</ul>
</li>
<li><a href="#_installation_du_cms_micro_weber">22. Installation du CMS Micro Weber</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_microweber">22.1. CrÃ©ation du site web de Microweber</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_5">22.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_installation_de_microweber">22.3. Installation de Microweber</a></li>
<li><a href="#_update_de_microweber">22.4. Update de Microweber</a></li>
</ul>
</li>
<li><a href="#_installation_de_mealie">23. Installation de Mealie</a>
<ul class="sectlevel2">
<li><a href="#_prÃ©requis">23.1. PrÃ©requis</a></li>
<li><a href="#_installation_du_serveur_mealie">23.2. Installation du serveur Mealie</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_mealie">23.3. CrÃ©ation du site web de mealie</a></li>
<li><a href="#_configuration_du_site_mealie">23.4. Configuration du site mealie</a></li>
<li><a href="#_upgrade_de_mealie">23.5. Upgrade de Mealie</a></li>
</ul>
</li>
<li><a href="#_installation_du_gestionnaire_de_photos_piwigo">24. Installation du gestionnaire de photos Piwigo</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_piwigo">24.1. CrÃ©ation du site web de Piwigo</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_6">24.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_installation_de_piwigo">24.3. Installation de Piwigo</a></li>
<li><a href="#_update_de_piwigo">24.4. Update de Piwigo</a></li>
</ul>
</li>
<li><a href="#_installation_du_systÃ¨me_collaboratif_nextcloud">25. Installation du systÃ¨me collaboratif Nextcloud</a>
<ul class="sectlevel2">
<li><a href="#_installation_initiale">25.1. Installation initiale</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_nextcloud">25.2. CrÃ©ation du site web de Nextcloud</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_7">25.3. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_installation_de_nextcloud">25.4. Installation de Nextcloud</a></li>
<li><a href="#_upgrade_de_nextcloud">25.5. Upgrade de Nextcloud</a></li>
</ul>
</li>
<li><a href="#_installation_du_gestionnaire_de_projet_gitea">26. Installation du gestionnaire de projet Gitea</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_gitea">26.1. CrÃ©ation du site web de Gitea</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_8">26.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_tÃ©lÃ©chargez_et_installez_gitea">26.3. TÃ©lÃ©chargez et installez Gitea</a></li>
<li><a href="#_activer_une_connexion_ssh_dÃ©diÃ©e">26.4. Activer une connexion SSH dÃ©diÃ©e</a></li>
<li><a href="#_update_de_gitea">26.5. Update de Gitea</a></li>
</ul>
</li>
<li><a href="#_installation_de_vaultwarden">27. Installation de vaultwarden</a>
<ul class="sectlevel2">
<li><a href="#_prÃ©requis_2">27.1. PrÃ©requis</a></li>
<li><a href="#_installation_du_serveur_vaultwarden">27.2. Installation du serveur vaultwarden</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_vaultwarden">27.3. CrÃ©ation du site web de vaultwarden</a></li>
<li><a href="#_configuration_du_site_vaultwarden">27.4. Configuration du site vaultwarden</a></li>
<li><a href="#_upgrade_de_vaultwarden">27.5. Upgrade de vaultwarden</a></li>
</ul>
</li>
<li><a href="#_installation_de_heimdall">28. Installation de Heimdall</a>
<ul class="sectlevel2">
<li><a href="#_prÃ©requis_3">28.1. PrÃ©requis</a></li>
<li><a href="#_installation_du_serveur_heimdall">28.2. Installation du serveur Heimdall</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_heimdall">28.3. CrÃ©ation du site web de heimdall</a></li>
<li><a href="#_configuration_du_site_heimdall">28.4. Configuration du site heimdall</a></li>
<li><a href="#_upgrade_de_heimdall">28.5. Upgrade de Heimdall</a></li>
</ul>
</li>
<li><a href="#_installation_du_systÃ¨me_de_partage_de_fichiers_seafile">29. Installation du systÃ¨me de partage de fichiers Seafile</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_seafile">29.1. CrÃ©ation du site web de Seafile</a></li>
<li><a href="#_crÃ©ation_de_bases_de_donnÃ©es">29.2. CrÃ©ation de bases de donnÃ©es</a></li>
<li><a href="#_tÃ©lÃ©chargez_et_installez_seafile">29.3. TÃ©lÃ©chargez et installez Seafile</a></li>
<li><a href="#_lancement_initial">29.4. Lancement initial</a></li>
<li><a href="#_lancement_automatique_de_seafile">29.5. Lancement automatique de Seafile</a></li>
</ul>
</li>
<li><a href="#_upgrade_de_seafile">30. Upgrade de Seafile</a></li>
<li><a href="#_installation_du_systÃ¨me_de_monitoring_grafana">31. Installation du systÃ¨me de monitoring Grafana</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_grafana">31.1. CrÃ©ation du site web de Grafana</a></li>
<li><a href="#_installation_de_grafana">31.2. Installation de Grafana</a></li>
<li><a href="#_installation_et_configuration_de_loki">31.3. Installation et configuration de Loki</a></li>
<li><a href="#_installation_et_configuration_de_promtail">31.4. Installation et configuration de Promtail</a></li>
<li><a href="#_upgrade_de_grafana">31.5. Upgrade de Grafana</a></li>
</ul>
</li>
<li><a href="#_installation_du_systÃ¨me_de_backup_borgbackup">32. Installation du systÃ¨me de backup BorgBackup</a>
<ul class="sectlevel2">
<li><a href="#_introduction">32.1. Introduction</a></li>
<li><a href="#_installation_du_serveur_de_stockage">32.2. Installation du serveur de stockage</a></li>
<li><a href="#_installation_sur_le_serveur_sauvegardÃ©">32.3. Installation sur le serveur sauvegardÃ©</a></li>
<li><a href="#_lister_les_backups">32.4. Lister les backups</a></li>
<li><a href="#_obtenir_les_infos_sur_un_backup">32.5. Obtenir les infos sur un backup</a></li>
<li><a href="#_vÃ©rifier_un_backup">32.6. VÃ©rifier un backup</a></li>
<li><a href="#_restaurer_un_backup">32.7. Restaurer un backup</a></li>
<li><a href="#_supprimer_vos_vieux_backups">32.8. Supprimer vos vieux backups</a></li>
<li><a href="#_restauration_durgence">32.9. Restauration d&#8217;urgence.</a></li>
<li><a href="#_installation_de_borgweb">32.10. Installation de Borgweb</a></li>
<li><a href="#_crÃ©ation_du_site_web_de_borgweb">32.11. CrÃ©ation du site web de Borgweb</a></li>
</ul>
</li>
<li><a href="#_installation_dun_serveur_de_vpn_wireguard">33. Installation d&#8217;un serveur de VPN Wireguard</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_wireguard">33.1. CrÃ©ation du site web de Wireguard</a></li>
<li><a href="#_installation_de_wireguard">33.2. Installation de Wireguard</a></li>
<li><a href="#_update_de_wireguard">33.3. Update de Wireguard</a></li>
</ul>
</li>
<li><a href="#_installation_dun_serveur_de_bureau_Ã _distance_guacamole">34. Installation d&#8217;un serveur de bureau Ã  distance Guacamole</a>
<ul class="sectlevel2">
<li><a href="#_crÃ©ation_du_site_web_de_guacamole">34.1. CrÃ©ation du site web de Guacamole</a></li>
<li><a href="#_crÃ©ation_des_bases_de_donnÃ©es_9">34.2. CrÃ©ation des bases de donnÃ©es</a></li>
<li><a href="#_installation_du_guacamole">34.3. Installation du Guacamole</a></li>
<li><a href="#_upgrade_de_guacamole">34.4. Upgrade de Guacamole</a></li>
</ul>
</li>
<li><a href="#_annexe">35. Annexe</a>
<ul class="sectlevel2">
<li><a href="#_installation_de_hestia">35.1. Installation de Hestia</a></li>
<li><a href="#_configuration_dun_Ã©cran_3_5_inch_rpi_lcd_a">35.2. Configuration d&#8217;un Ã©cran 3.5 inch RPI LCD (A)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_avant_propos">1. Avant propos</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce document est disponible sur le site <a href="https://raspberry-installation.readthedocs.io">ReadTheDocs</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz4KPHN2ZyBoZWlnaHQ9Jzc4cHgnIHByZXNlcnZlQXNwZWN0UmF0aW89J25vbmUnIHZlcnNpb249JzEuMScgdmlld0JveD0nMCAwIDc4IDc4JyB3aWR0aD0nNzhweCcgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+Cjx0aXRsZT5odHRwczovL3Jhc3BiZXJyeS1pbnN0YWxsYXRpb24ucmVhZHRoZWRvY3MuaW88L3RpdGxlPgo8ZyBpZD0nY2FudmFzJz4KPHJlY3QgZmlsbD0nI2ZmZicgaGVpZ2h0PSc3OHB4JyB3aWR0aD0nNzhweCcgeD0nMCcgeT0nMCcvPgo8ZyBmaWxsPScjMDAwJyBpZD0nYmFyY29kZSc+CjxwYXRoIGQ9J00xMSAxMFYgMTJNMTMgMTBWIDEyTTE1IDEwViAxMk0xNyAxMFYgMTJNMTkgMTBWIDEyTTIxIDEwViAxMk0yMyAxMFYgMTJNMjkgMTBWIDEyTTMxIDEwViAxMk0zMyAxMFYgMTJNMzkgMTBWIDEyTTQ1IDEwViAxMk00NyAxMFYgMTJNNTUgMTBWIDEyTTU3IDEwViAxMk01OSAxMFYgMTJNNjEgMTBWIDEyTTYzIDEwViAxMk02NSAxMFYgMTJNNjcgMTBWIDEyTTExIDEyViAxNE0yMyAxMlYgMTRNMzMgMTJWIDE0TTM1IDEyViAxNE00NyAxMlYgMTRNNTUgMTJWIDE0TTY3IDEyViAxNE0xMSAxNFYgMTZNMTUgMTRWIDE2TTE3IDE0ViAxNk0xOSAxNFYgMTZNMjMgMTRWIDE2TTI5IDE0ViAxNk0zMSAxNFYgMTZNMzMgMTRWIDE2TTQxIDE0ViAxNk00MyAxNFYgMTZNNTEgMTRWIDE2TTU1IDE0ViAxNk01OSAxNFYgMTZNNjEgMTRWIDE2TTYzIDE0ViAxNk02NyAxNFYgMTZNMTEgMTZWIDE4TTE1IDE2ViAxOE0xNyAxNlYgMThNMTkgMTZWIDE4TTIzIDE2ViAxOE0yNyAxNlYgMThNMzEgMTZWIDE4TTMzIDE2ViAxOE0zNyAxNlYgMThNNDUgMTZWIDE4TTU1IDE2ViAxOE01OSAxNlYgMThNNjEgMTZWIDE4TTYzIDE2ViAxOE02NyAxNlYgMThNMTEgMThWIDIwTTE1IDE4ViAyME0xNyAxOFYgMjBNMTkgMThWIDIwTTIzIDE4ViAyME0yNyAxOFYgMjBNMzEgMThWIDIwTTM1IDE4ViAyME00MyAxOFYgMjBNNDUgMThWIDIwTTQ3IDE4ViAyME00OSAxOFYgMjBNNTEgMThWIDIwTTU1IDE4ViAyME01OSAxOFYgMjBNNjEgMThWIDIwTTYzIDE4ViAyME02NyAxOFYgMjBNMTEgMjBWIDIyTTIzIDIwViAyMk0yOSAyMFYgMjJNMzEgMjBWIDIyTTM5IDIwViAyMk01MSAyMFYgMjJNNTUgMjBWIDIyTTY3IDIwViAyMk0xMSAyMlYgMjRNMTMgMjJWIDI0TTE1IDIyViAyNE0xNyAyMlYgMjRNMTkgMjJWIDI0TTIxIDIyViAyNE0yMyAyMlYgMjRNMjcgMjJWIDI0TTMxIDIyViAyNE0zNSAyMlYgMjRNMzkgMjJWIDI0TTQzIDIyViAyNE00NyAyMlYgMjRNNTEgMjJWIDI0TTU1IDIyViAyNE01NyAyMlYgMjRNNTkgMjJWIDI0TTYxIDIyViAyNE02MyAyMlYgMjRNNjUgMjJWIDI0TTY3IDIyViAyNE0yOSAyNFYgMjZNMzUgMjRWIDI2TTM5IDI0ViAyNk00MyAyNFYgMjZNNDcgMjRWIDI2TTQ5IDI0ViAyNk0xMSAyNlYgMjhNMTMgMjZWIDI4TTIxIDI2ViAyOE0yMyAyNlYgMjhNMjUgMjZWIDI4TTI5IDI2ViAyOE0zMSAyNlYgMjhNMzUgMjZWIDI4TTM3IDI2ViAyOE0zOSAyNlYgMjhNNDEgMjZWIDI4TTQ1IDI2ViAyOE01MSAyNlYgMjhNNTkgMjZWIDI4TTYxIDI2ViAyOE0xMSAyOFYgMzBNMTMgMjhWIDMwTTE3IDI4ViAzME0xOSAyOFYgMzBNMjUgMjhWIDMwTTI3IDI4ViAzME0zMSAyOFYgMzBNMzkgMjhWIDMwTTQxIDI4ViAzME00NSAyOFYgMzBNNDcgMjhWIDMwTTQ5IDI4ViAzME01NyAyOFYgMzBNNTkgMjhWIDMwTTYzIDI4ViAzME02NSAyOFYgMzBNMTEgMzBWIDMyTTE1IDMwViAzMk0yMSAzMFYgMzJNMjMgMzBWIDMyTTI1IDMwViAzMk0yOSAzMFYgMzJNMzMgMzBWIDMyTTM1IDMwViAzMk0zOSAzMFYgMzJNNDEgMzBWIDMyTTQzIDMwViAzMk01MyAzMFYgMzJNNTkgMzBWIDMyTTE1IDMyViAzNE0yMSAzMlYgMzRNMjUgMzJWIDM0TTI3IDMyViAzNE0zMSAzMlYgMzRNMzMgMzJWIDM0TTQ3IDMyViAzNE00OSAzMlYgMzRNNTEgMzJWIDM0TTU1IDMyViAzNE01OSAzMlYgMzRNNjEgMzJWIDM0TTEzIDM0ViAzNk0xNSAzNFYgMzZNMTcgMzRWIDM2TTIzIDM0ViAzNk0yNSAzNFYgMzZNMjkgMzRWIDM2TTMxIDM0ViAzNk00MSAzNFYgMzZNNDMgMzRWIDM2TTUxIDM0ViAzNk01NSAzNFYgMzZNNjcgMzRWIDM2TTExIDM2ViAzOE0xNyAzNlYgMzhNMTkgMzZWIDM4TTIxIDM2ViAzOE0yNSAzNlYgMzhNMjkgMzZWIDM4TTMxIDM2ViAzOE0zNSAzNlYgMzhNMzcgMzZWIDM4TTQxIDM2ViAzOE00MyAzNlYgMzhNNDcgMzZWIDM4TTQ5IDM2ViAzOE01MSAzNlYgMzhNNTUgMzZWIDM4TTU3IDM2ViAzOE01OSAzNlYgMzhNNjUgMzZWIDM4TTY3IDM2ViAzOE0xMSAzOFYgNDBNMTcgMzhWIDQwTTIzIDM4ViA0ME0yNyAzOFYgNDBNMzcgMzhWIDQwTTM5IDM4ViA0ME00MSAzOFYgNDBNNDMgMzhWIDQwTTQ3IDM4ViA0ME01MSAzOFYgNDBNNTcgMzhWIDQwTTYxIDM4ViA0ME02MyAzOFYgNDBNMTEgNDBWIDQyTTEzIDQwViA0Mk0yNSA0MFYgNDJNMjcgNDBWIDQyTTI5IDQwViA0Mk0zMSA0MFYgNDJNMzUgNDBWIDQyTTUxIDQwViA0Mk01MyA0MFYgNDJNNTUgNDBWIDQyTTU5IDQwViA0Mk02MyA0MFYgNDJNNjcgNDBWIDQyTTExIDQyViA0NE0xNyA0MlYgNDRNMjEgNDJWIDQ0TTIzIDQyViA0NE0yNyA0MlYgNDRNMjkgNDJWIDQ0TTMxIDQyViA0NE0zNSA0MlYgNDRNMzcgNDJWIDQ0TTM5IDQyViA0NE00MSA0MlYgNDRNNDUgNDJWIDQ0TTQ5IDQyViA0NE01NyA0MlYgNDRNNjEgNDJWIDQ0TTYzIDQyViA0NE0xMSA0NFYgNDZNMTMgNDRWIDQ2TTE1IDQ0ViA0Nk0xOSA0NFYgNDZNMjcgNDRWIDQ2TTI5IDQ0ViA0Nk00MSA0NFYgNDZNNDMgNDRWIDQ2TTQ5IDQ0ViA0Nk01MSA0NFYgNDZNNTMgNDRWIDQ2TTU1IDQ0ViA0Nk01NyA0NFYgNDZNNTkgNDRWIDQ2TTYzIDQ0ViA0Nk02NSA0NFYgNDZNNjcgNDRWIDQ2TTExIDQ2ViA0OE0xMyA0NlYgNDhNMTkgNDZWIDQ4TTIxIDQ2ViA0OE0yMyA0NlYgNDhNMjcgNDZWIDQ4TTI5IDQ2ViA0OE0zNSA0NlYgNDhNMzkgNDZWIDQ4TTQxIDQ2ViA0OE00MyA0NlYgNDhNNDUgNDZWIDQ4TTQ5IDQ2ViA0OE01MyA0NlYgNDhNNTUgNDZWIDQ4TTU5IDQ2ViA0OE02MSA0NlYgNDhNNjcgNDZWIDQ4TTExIDQ4ViA1ME0xNyA0OFYgNTBNMzMgNDhWIDUwTTM5IDQ4ViA1ME00MSA0OFYgNTBNNDcgNDhWIDUwTTUxIDQ4ViA1ME01NSA0OFYgNTBNNTkgNDhWIDUwTTExIDUwViA1Mk0xNSA1MFYgNTJNMTcgNTBWIDUyTTE5IDUwViA1Mk0yMyA1MFYgNTJNMjcgNTBWIDUyTTMxIDUwViA1Mk0zMyA1MFYgNTJNMzUgNTBWIDUyTTM3IDUwViA1Mk0zOSA1MFYgNTJNNDEgNTBWIDUyTTQzIDUwViA1Mk00NSA1MFYgNTJNNDkgNTBWIDUyTTUxIDUwViA1Mk01MyA1MFYgNTJNNTUgNTBWIDUyTTU3IDUwViA1Mk01OSA1MFYgNTJNNjMgNTBWIDUyTTY1IDUwViA1Mk02NyA1MFYgNTJNMjcgNTJWIDU0TTM1IDUyViA1NE00MSA1MlYgNTRNNDUgNTJWIDU0TTQ3IDUyViA1NE01MSA1MlYgNTRNNTkgNTJWIDU0TTYxIDUyViA1NE0xMSA1NFYgNTZNMTMgNTRWIDU2TTE1IDU0ViA1Nk0xNyA1NFYgNTZNMTkgNTRWIDU2TTIxIDU0ViA1Nk0yMyA1NFYgNTZNMjcgNTRWIDU2TTI5IDU0ViA1Nk0zNyA1NFYgNTZNNDEgNTRWIDU2TTQ3IDU0ViA1Nk00OSA1NFYgNTZNNTEgNTRWIDU2TTU1IDU0ViA1Nk01OSA1NFYgNTZNNjEgNTRWIDU2TTYzIDU0ViA1Nk0xMSA1NlYgNThNMjMgNTZWIDU4TTI3IDU2ViA1OE0yOSA1NlYgNThNMzEgNTZWIDU4TTMzIDU2ViA1OE0zOSA1NlYgNThNNDEgNTZWIDU4TTQzIDU2ViA1OE01MSA1NlYgNThNNTkgNTZWIDU4TTY1IDU2ViA1OE0xMSA1OFYgNjBNMTUgNThWIDYwTTE3IDU4ViA2ME0xOSA1OFYgNjBNMjMgNThWIDYwTTM1IDU4ViA2ME0zOSA1OFYgNjBNNDMgNThWIDYwTTQ5IDU4ViA2ME01MSA1OFYgNjBNNTMgNThWIDYwTTU1IDU4ViA2ME01NyA1OFYgNjBNNTkgNThWIDYwTTYxIDU4ViA2ME0xMSA2MFYgNjJNMTUgNjBWIDYyTTE3IDYwViA2Mk0xOSA2MFYgNjJNMjMgNjBWIDYyTTI5IDYwViA2Mk0zMyA2MFYgNjJNMzcgNjBWIDYyTTQxIDYwViA2Mk00NSA2MFYgNjJNNDcgNjBWIDYyTTQ5IDYwViA2Mk01MyA2MFYgNjJNNjEgNjBWIDYyTTYzIDYwViA2Mk02NyA2MFYgNjJNMTEgNjJWIDY0TTE1IDYyViA2NE0xNyA2MlYgNjRNMTkgNjJWIDY0TTIzIDYyViA2NE0zNyA2MlYgNjRNMzkgNjJWIDY0TTQxIDYyViA2NE00NSA2MlYgNjRNNTEgNjJWIDY0TTU1IDYyViA2NE01NyA2MlYgNjRNNTkgNjJWIDY0TTYxIDYyViA2NE02MyA2MlYgNjRNNjUgNjJWIDY0TTExIDY0ViA2Nk0yMyA2NFYgNjZNMjcgNjRWIDY2TTM1IDY0ViA2Nk0zOSA2NFYgNjZNNDEgNjRWIDY2TTQ5IDY0ViA2Nk01NSA2NFYgNjZNNjEgNjRWIDY2TTYzIDY0ViA2Nk02NyA2NFYgNjZNMTEgNjZWIDY4TTEzIDY2ViA2OE0xNSA2NlYgNjhNMTcgNjZWIDY4TTE5IDY2ViA2OE0yMSA2NlYgNjhNMjMgNjZWIDY4TTI3IDY2ViA2OE0zMSA2NlYgNjhNMzMgNjZWIDY4TTM1IDY2ViA2OE0zNyA2NlYgNjhNMzkgNjZWIDY4TTQ1IDY2ViA2OE00OSA2NlYgNjhNNTMgNjZWIDY4TTU1IDY2ViA2OE01OSA2NlYgNjhNNjEgNjZWIDY4TTYzIDY2ViA2OCcgc3Ryb2tlPScjMDAwJyBzdHJva2Utd2lkdGg9JzInLz4KPC9nPjwvZz4KPC9zdmc+Cg==" alt="Diagram" width="78" height="78">
</div>
</div>
<div class="paragraph">
<p>et sur <a href="https://github.com/stefapi/vps_installation">Github</a>. Sur Github vous trouverez aussi les versions PDF, EPUB, HTML, Docbook et Asciidoc de ce document</p>
</div>
<div class="paragraph">
<p>Cette documentation dÃ©crit la mÃ©thode que j&#8217;ai utilisÃ© pour installer une homebox (site auto hÃ©bergÃ©) avec un raspberry PI.</p>
</div>
<div class="paragraph">
<p>Elle est le rÃ©sultat de trÃ¨s nombreuses heures de travail pour collecter la documentation nÃ©cessaire.
Sur mon serveur, j&#8217;ai installÃ© un Ubuntu pour Raspberry. Cette documentation dÃ©crit aussi l&#8217;installation pour une Raspbian.</p>
</div>
<div class="paragraph">
<p>Dans ce document, je montre la configuration de nombreux types de sites web et services dans un domaine en utilisant ISPConfig.</p>
</div>
<div class="paragraph">
<p>Sont installÃ©s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un panel <a href="https://www.ispconfig.org/">ISPConfig</a>,</p>
</li>
<li>
<p>un configurateur <a href="http://www.webmin.com/">Webmin</a>,</p>
</li>
<li>
<p>un serveur apache avec sa configuration let&#8217;s encrypt et les plugins PHP, Python et Ruby,</p>
</li>
<li>
<p>un serveur de mail avec antispam, sÃ©curisation d&#8217;envoi des mails et autoconfiguration pour Outlook, Thunderbird, Android,</p>
</li>
<li>
<p>un webmail <a href="https://roundcube.net">roundcube</a>,</p>
</li>
<li>
<p>un serveur de mailing list <a href="https://www.list.org">mailman</a>,</p>
</li>
<li>
<p>un serveur ftp et sftp sÃ©curisÃ©,</p>
</li>
<li>
<p>un serveur de base de donnÃ©es MariaDB et son interface web d&#8217;administration <a href="https://www.phpmyadmin.net/">phpmyadmin</a>,</p>
</li>
<li>
<p>des outils de sÃ©curisation, de mise Ã  jour automatique et d&#8217;audit du serveur,</p>
</li>
<li>
<p>un outil de Monitoring <a href="http://munin-monitoring.org/">Munin</a>,</p>
</li>
<li>
<p>un outil de Monitoring <a href="http://mmonit.com/monit/">Monit</a>,</p>
</li>
<li>
<p>l&#8217;installation de <a href="https://hub.docker.com/">Docker</a> et des outils <a href="https://portainer.io">Portainer</a> et <a href="https://yacht.sh">Yacht</a>,</p>
</li>
<li>
<p>un sous domaine pointant sur un site auto-hÃ©bergÃ© (lâinstallation du site n&#8217;est pas dÃ©crite ici; Se rÃ©fÃ©rer Ã  <a href="https://yunohost.org">Yunohost</a> ) par exemple,</p>
</li>
<li>
<p>un site CMS sous <a href="https://www.joomla.fr/">Joomla</a>,</p>
</li>
<li>
<p>un site CMS sous <a href="https://www.concrete5.org/">Concrete5</a>,</p>
</li>
<li>
<p>un site WIKI sous <a href="https://www.mediawiki.org">Mediawiki</a>,</p>
</li>
<li>
<p>un site de blog <a href="https://wordpress.com">Wordpress</a>,</p>
</li>
<li>
<p>un site <a href="https://microweber.org/">Microweber</a>,</p>
</li>
<li>
<p>un site Photo sous <a href="https://piwigo.org/">Piwigo</a>,</p>
</li>
<li>
<p>un site de partage de recettes de cuisine <a href="https://hay-kot.github.io/mealie/">Mealie</a></p>
</li>
<li>
<p>un site Collaboratif sous <a href="https://nextcloud.com">Nextcloud</a>,</p>
</li>
<li>
<p>un site <a href="https://gitea.io">Gitea</a> et son repository GIT,</p>
</li>
<li>
<p>un serveur de mots de passe <a href="https://bitwarden.com/">Bitwarden</a>,</p>
</li>
<li>
<p>un dashboard pour vos sites web <a href="https://heimdall.site/">Heimdall</a>,</p>
</li>
<li>
<p>un serveur et un site  de partage de fichiers <a href="https://www.seafile.com">Seafile</a>,</p>
</li>
<li>
<p>un serveur <a href="https://grafana.com/">Grafana</a>, <a href="https://prometheus.io/">Prometheus</a>, <a href="https://github.com/grafana/loki">Loki</a>, Promtail pour gÃ©rer les statistiques et les logs du serveur,</p>
</li>
<li>
<p>un serveur de sauvegardes <a href="https://borgbackup.readthedocs.io/">BorgBackup</a>,</p>
</li>
<li>
<p>un serveur de VPN <a href="https://github.com/wg-easy/wg-easy">Wireguard (wg-easy)</a>,</p>
</li>
<li>
<p>un serveur de bureau Ã  distance <a href="https://guacamole.apache.org">Guacamole</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dans ce document nous configurons un nom de domaine principal. Pour la clartÃ© du texte, il sera nommÃ© "example.com". Il est Ã  remplacer Ã©videmment par votre nom de domaine principal.</p>
</div>
<div class="paragraph">
<p>Je suppose dans ce document que vous savez vous connecter Ã  distance sur un serveur en mode terminal, que vous savez vous servir de <code>ssh</code> pour Linux ou de <code>putty</code> pour Windows, que vous avez des notions Ã©lÃ©mentaires de Shell Unix et que vous savez vous servir de l&#8217;Ã©diteur <code>vi</code>. Si <code>vi</code> est trop compliquÃ© pour vous, je vous suggÃ¨re d&#8217;utiliser l&#8217;Ã©diteur de texte <code>nano</code> Ã  la place et de remplacer <code>vi</code> par <code>nano</code> dans toutes les lignes de commande.</p>
</div>
<div class="paragraph">
<p>Dans le document, on peut trouver des textes entourÃ©s de &lt;texte&gt;. Cela signifie que vous devez mettre ici votre propre texte selon vos prÃ©fÃ©rences.</p>
</div>
<div class="paragraph">
<p>Le coÃ»t pour mettre en oeuvre ce type de serveur est relativement faible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compter 15-18â¬TTC/an pour un nom de domaine classique (mais il peut y avoir des promos)</p>
</li>
<li>
<p>Comptez 47â¬ pour acheter une carte Raspberry PI 4 (1Go de Ram) et 67â¬ pour un PI 4 avec 4Go de Ram ou 94â¬ pour un PI 5 avec 8Go de Ram. A cela il faut ajouter un boitier, une alim et une flash de 64 ou 128 Go (prenez les cartes SD les plus rapide possible en Ã©criture).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vous en aurez donc entre 80â¬ pour une petite Configuration Raspberry PI 4 1Go, flash de 64 Go et 160â¬ pour une configuration Raspberry PI 5 8 Go et une flash de 512 Go.</p>
</div>
<div class="paragraph">
<p>Il existe aussi des kits permettant de mettre en oeuvre des cartes NVME avec un gros gain de performance disque.</p>
</div>
<div class="paragraph">
<p>Par rapport Ã  une solution VPS directement dans le cloud, ce budget correspond Ã  7-16 mois d&#8217;abonnement selon la configuration. Si vous avez la Fibre chez vous, il est nettement plus rentable d&#8217;utiliser un Raspberry que de prendre un abonnement VPS.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="root_login">2. Se loguer root sur le serveur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A de nombreux endroit dans la documentation, il est demandÃ© de se loguer root sur le serveur.
Pour se loguer root, et dans lâhypothÃ¨se que vous avez mis en place un compte sudo:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>De votre machine locale, loguez vous avec votre compte <code>&lt;sudo_username&gt;</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mettez ici &lt;sudo_username&gt; par votre nom de login et &lt;example.com&gt; par votre nom de domaine ou son adresse IP. Au dÃ©but votre nom de domaine achetÃ© n&#8217;est pas encore configurÃ©. Il faut donc utiliser le nom de machine ( par exemple pour un VPS OVH: VPSxxxxxx.ovh.net ou pour un raspberry: raspberrypi.local ) ou votre adresse IP.
<div class="paragraph">
<p>ou utilisez putty si vous Ãªtes sous Windows.</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>Tapez votre mot de passe s&#8217;il est demandÃ©. Si vous avez installÃ© une clÃ© de connexion ce ne devrait pas Ãªtre le cas.</p>
</li>
<li>
<p>Loguez-vous <code>root</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Un mot de passe vous est demandÃ©. Tapez le mot de passe demandÃ©.</p>
</div>
</li>
<li>
<p>Dans le cas contraire (pas de sudo crÃ©Ã© et connexion en root directe sur le serveur):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Se loguer root sur le serveur distant. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh root@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;example.com&gt; par votre nom de domaine.
<div class="paragraph">
<p>Tapez ensuite votre mot de passe root</p>
</div></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pass_gen">3. Gestion des mots de passe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A propos des mots de passe: il est conseillÃ© de saisir des mots de passe de 12 caractÃ¨res contenant des majuscules/minuscules/nombres/caractÃ¨res spÃ©ciaux. Une autre faÃ§on de faire est de saisir de longues phrases. Par exemple: 'J&#8217;aime manger de la mousse au chocolat parfumÃ©e Ã  la menthe'. Ce dernier exemple a un taux de complexitÃ© bien meilleur qu&#8217;un mot de passe classique. Il est aussi plus facile Ã  retenir que 'Az3~1ym_a&amp;'.</p>
</div>
<div class="paragraph">
<p>Cependant, si vous Ãªtes en manque d&#8217;inspiration et que vous souhaitez gÃ©nÃ©rer des mots de passe, voici quelques mÃ©thodes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En se basant sur la date. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">date</span> +%s | <span class="nb">sha256sum</span> | <span class="nb">base64</span> | <span class="nb">head</span> <span class="nt">-c</span> 32 <span class="p">;</span> <span class="nb">echo</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En se basant sur les nombres alÃ©atoires systÃ¨me. Tapez l&#8217;une des deux lignes ci dessous :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">tr</span> <span class="nt">-cd</span> <span class="s1">'[:graph:]'</span> &lt; /dev/urandom | <span class="nb">head</span> <span class="nt">-c</span> 32<span class="p">;</span> <span class="nb">echo <i class="conum" data-value="1"></i><b>(1)</b>
tr</span> <span class="nt">-cd</span> A-Za-z0-9 &lt; /dev/urandom | <span class="nb">head</span> <span class="nt">-c</span> 32<span class="p">;</span><span class="nb">echo</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant Openssl. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openssl rand <span class="nt">-base64</span> 32 | <span class="nb">cut</span> <span class="nt">-c-32</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant gpg. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">gpg <span class="nt">--gen-random</span> <span class="nt">--armor</span> 1 32 | <span class="nb">cut</span> <span class="nt">-c-32</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res</td>
</tr>
</table>
</div>
</li>
<li>
<p>En utilisant pwgen pour gÃ©nÃ©rer des mots de passe qui suivent des rÃ¨gles de longueur et types de caractÃ¨res.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>pwgen</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pwgen <span class="nt">-Bcny</span> 32 <span class="nt">-1</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez 32 par la valeur qui vous convient pour gÃ©nÃ©rer un mot de passe d&#8217;une taille diffÃ©rente de 32 caractÃ¨res. La commande crÃ©e un mot de passe non ambigue avec au moins une majuscule , une valeur numÃ©rique, un symbole.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>En utilisant apg pour gÃ©nÃ©rer des mots de passe prononcables tel que: <code>7quiGrikCod+ (SEVEN-qui-Grik-Cod-PLUS_SIGN)</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>apg</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apg</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>En utilisant xkcdpass pour gÃ©nÃ©rer des passphrases comme: <code>context smashup spiffy cuddly throttle landfall</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour installer l&#8217;outil, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>xkcdpass</code></pre>
</div>
</div>
</li>
<li>
<p>Ensuite tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">xkcdpass</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_choix_du_registrar">4. Choix du registrar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour rappel, un registrar est une sociÃ©tÃ© auprÃ¨s de laquelle vous pourrez acheter un nom de domaine sur une durÃ©e dÃ©terminÃ©e. Vous devrez fournir pour votre enregistrement un ensemble de donnÃ©es personnelles qui permettront de vous identifier en tant que propriÃ©taire de ce nom de domaine.</p>
</div>
<div class="paragraph">
<p>Pour ma part j&#8217;ai choisi Gandi car il ne sont pas trÃ¨s cher et leur interface d&#8217;administration est simple d&#8217;usage. Vous pouvez trÃ¨s bien prendre aussi vos DNS chez OVH.</p>
</div>
<div class="paragraph">
<p>Une fois votre domaine enregistrÃ© et votre compte crÃ©Ã© vous pouvez vous loguer sur la <a href="https://admin.gandi.net/dashboard">plateforme de gestion de Gandi</a>.</p>
</div>
<div class="paragraph">
<p>Allez dans Nom de domaine et sÃ©lectionnez le nom de domaine que vous voulez administrer.
La vue gÃ©nÃ©rale vous montre les services actifs. Il faut une fois la configuration des DNS effectuÃ©e Ãªtre dans le mode suivant:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Serveurs de noms: Externes</p>
</li>
<li>
<p>Emails: Inactif</p>
</li>
<li>
<p>DNSSEC: Inactif (cela sera activÃ© dans une seconde Ã©tape de ce guide)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vous ne devez avoir aucune boite mail active sur ce domaine. A regardez dans le menu "Boites &amp; redirections Mails".</p>
</div>
<div class="paragraph">
<p>Ajoutez des Glue records:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un pour ns1.&lt;example.com&gt; liÃ© Ã  l&#8217;adresse &lt;IP&gt; du serveur</p>
</li>
<li>
<p>un pour ns2.&lt;example.com&gt; liÃ© Ã  l&#8217;adresse &lt;IP&gt; du serveur</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vous devez reconfigurer les 'Enregistrements DNS' en mode externes.
Dans le menu "serveurs de noms", vous devez configurer les serveurs de noms externe. Mettre 3 DNS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les deux DNS de votre domaine: ns1.&lt;example.com&gt; et ns2.&lt;example.com&gt;</p>
</li>
<li>
<p>puis enfin le nom de votre machine dÃ©finie par votre hÃ©bergeur de VPS: <code>vmixxxxxx.contaboserver.net</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ajoutez des Glue records:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un pour ns1.&lt;example.com&gt; liÃ© Ã  l&#8217;adresse &lt;IP&gt; du serveur</p>
</li>
<li>
<p>un pour ns2.&lt;example.com&gt; liÃ© Ã  l&#8217;adresse &lt;IP&gt; du serveur</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il y a la possibilitÃ© chez OVH d&#8217;utiliser un DNS secondaire. Dans ce cas, enregistrez votre nom de domaine sur le serveur de dns secondaire de votre hÃ©bergeur. Notez ensuite le nom de domaine de ce DNS secondaire et ajoutez une entrÃ©e supplÃ©mentaire sur le serveur de votre registrar avec l&#8217;adresse DNS secondaire.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Avoir un DNS sur au moins deux machines distinctes est la configuration recommandÃ©e.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le menu restant est associÃ© Ã  DNSSEC; nous y reviendrons plus tard.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_linux_sur_votre_raspberry_pi">5. Installation du linux sur votre Raspberry Pi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C&#8217;est la premiÃ¨re Ã©tape.</p>
</div>
<div class="paragraph">
<p>Il vous faut bien choisir le type de linux que vous souhaitez installer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Debian 64: C&#8217;est la distribution la plus connue et celle qui offre le plus de possibilitÃ©s juste aprÃ¨s l&#8217;installation (notamment pour faire de la domotique, utiliser le GPIO &#8230;&#8203;) .</p>
</li>
<li>
<p>Ubuntu 64: Elle est plus proche d&#8217;une Ubuntu standard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il vous faudra un lecteur de flash microSD - USB que vous brancherez sur votre PC.</p>
</div>
<div class="paragraph">
<p>Il existe maintenant un outil nommÃ© <a href="https://www.raspberrypi.org/downloads/">Rasberry PI Imager</a> pour la plateforme qui vous convient. C&#8217;est le moyen de plus simple de flasher votre Raspberry pi.</p>
</div>
<div class="paragraph">
<p>Pour Windows, trÃ¨s simple, il suffit de lancer le programme tÃ©lÃ©chargÃ©.
Pour Linux, appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
wget https://downloads.raspberrypi.org/imager/imager_amd64.deb
dpkg <span class="nt">-i</span> imager_amd64.deb</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez le programme.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure ci dessous commune Ã  toutes les plateformes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vous avez deux faÃ§ons d&#8217;installer:</p>
<div class="ulist">
<ul>
<li>
<p>avec un Ã©cran et un clavier qui est la mÃ©thode la plus facile</p>
</li>
<li>
<p>en mode Headless qui est plus complexe mais ne nÃ©cessite pas d&#8217;Ã©cran ni de clavier. L&#8217;installation s&#8217;effectue automatiquement.</p>
</li>
</ul>
</div>
</li>
<li>
<p>SÃ©lectionnez <code>Choisir le modÃ¨le</code> et dans la liste choisissez votre type de Raspberry</p>
</li>
<li>
<p>SÃ©lectionnez <code>Choisir l&#8217;OS</code> et dans la liste choisissez <code>Raspberry Pi OS (64-bit)</code> ou <code>Other general-purpose OS</code>&#8594;`Ubuntu`&#8594;`Ubuntu Desktop 64`</p>
</li>
<li>
<p>SÃ©lectionnez <code>Choisir le Stockage</code> et sÃ©lectionnez votre lecteur de carte SD</p>
</li>
<li>
<p>Cliquez sur <code>Suivant</code></p>
</li>
<li>
<p>Cliquez sur <code>Modifier RÃ©glages</code> si vous souhaitez installer en mode headless le Raspberry sinon cliquez sur <code>Non</code> et allez Ã  l&#8217;Ã©tape 10</p>
</li>
<li>
<p>Dans l&#8217;onglet <code>GÃ©nÃ©ral</code></p>
<div class="ulist">
<ul>
<li>
<p>Donnez le nom de votre Raspberry dans <code>Nom d&#8217;hÃ´te</code></p>
</li>
<li>
<p>Donnez votre utilisateur sudo dans <code>nom d&#8217;utilisateur</code></p>
</li>
<li>
<p>Donnez votre mot de passe dans <code>Mot de passe</code>. Utilisez un gÃ©nÃ©rateur de mot de passe pour en obtenir un suffisamment complexe</p>
</li>
<li>
<p>Donnez votre SSID Wifi dans <code>SSID</code></p>
</li>
<li>
<p>Donner le mot de passe de votre wifi dans <code>Mot de passe</code>. Vous pouvez l&#8217;afficher si vous voulez vÃ©rifier que la saisie est correcte.</p>
</li>
<li>
<p>Dans <code>Pays Wi-fi</code> mettez <code>FR</code></p>
</li>
<li>
<p>Dans <code>Fuseau horaire</code> mettez votre pays <code>Europe/Paris</code> par exemple</p>
</li>
<li>
<p>Dans type de clavier mettez <code>fr</code> si vous avez un clavier Azerty</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans l&#8217;onglet `Services</p>
<div class="ulist">
<ul>
<li>
<p>Activez <code>Activer SSH</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>Utiliser un mot de passe pour l&#8217;authentification</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Enregistrer</code></p>
</li>
<li>
<p>Cliquez sur <code>Oui</code></p>
</li>
<li>
<p>Dans la fenÃªtre suivant intitulÃ©e <code>Attention</code> cliquez sur <code>Oui</code></p>
</li>
<li>
<p>Attendez la fin du chargement et de l&#8217;Ã©criture sur la flash.</p>
</li>
<li>
<p>En fonction de la mÃ©thode choisie, allez au chapitre suivant ou celui encore aprÃ¨s.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_installation_avec_Ã©cran_et_clavier">5.1. Installation avec Ã©cran et clavier</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, il vous faut un clavier+souris et un Ã©cran.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre raspberry PI.</p>
</li>
<li>
<p>Brancher un clavier, une souris et un Ã©cran (ou utilisez un Ã©cran 3,5" configurÃ© selon la procÃ©dure en annexe).</p>
</li>
<li>
<p>Branchez votre Raspberry sur votre rÃ©seau Ethernet filaire (vous pouvez aussi utiliser le wifi)</p>
</li>
<li>
<p>DÃ©marrez votre raspberry. Attention, les Raspberry PI 5 ont un bouton <code>On</code></p>
</li>
<li>
<p>Attendez environ 2 minutes le temps que le premier boot se termine. Tout pendant la procÃ©dure de boot, la petite led d&#8217;accÃ¨s disque doit clignoter. Vous devez assez rapidement arriver sur le bureau</p>
</li>
<li>
<p>Un Ã©cran de configuration doit s&#8217;afficher automatiquement.</p>
</li>
<li>
<p>SÃ©lectionnez le clavier et la langue en franÃ§ais</p>
</li>
<li>
<p>Tapez votre nouveau mot de passe et votre compte utilisateur</p>
</li>
<li>
<p>Choisissez votre connexion wifi et entrez le mot de passe</p>
</li>
<li>
<p>Les mises Ã  jours de paquets Debian ainsi que l&#8217;installation des traductions en franÃ§ais vont s&#8217;installer.</p>
</li>
<li>
<p>Une fois les installations terminÃ©es, le Raspberry va rebooter.</p>
</li>
<li>
<p>Une fois rebootÃ©, sÃ©lectionnez dans le menu <code>PrÃ©fÃ©rences</code>&#8594;`Configuration du Raspberry PI`</p>
<div class="ulist">
<ul>
<li>
<p>Dans l&#8217;onglet <code>Display</code> Cliquez sur <code>Set Resolution</code> et choisissez <code>31: 1920x1080</code></p>
</li>
<li>
<p>Dans l&#8217;onglet <code>Interfaces</code> activez <code>SSH</code> et <code>VNC</code></p>
</li>
<li>
<p>Cliquez sur <code>Valider</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur lâicÃ´ne <code>VNC</code> dans la barre en haut Ã  Droite</p>
<div class="ulist">
<ul>
<li>
<p>Dans la fenÃªtre cliquez sur le menu burger en haut Ã  Droite.</p>
</li>
<li>
<p>Choisissez <code>Options</code> puis l&#8217;onglet <code>SÃ©curitÃ©</code></p>
</li>
<li>
<p>Dans le champ Authentification choisissez l&#8217;option <code>mot de passe VNC</code></p>
</li>
<li>
<p>Tapez votre mot de passe dans les deux champs et cliquez <code>Valider</code> puis <code>OK</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Vous pouvez maintenant rebooter votre Raspberry sans Ã©cran et sans clavier pour continuer la configuration.</p>
</li>
<li>
<p>Vous avez deux options: connexion en mode SSH ou au travers d&#8217;une connexion VNC</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Allez au chapitre <a href="#_connexion_au_travers_du_rÃ©seau">Connexion au travers du rÃ©seau</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_headless">5.2. Installation Headless</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, pas besoin d&#8217;Ã©cran, de clavier et de souris. Tout s&#8217;effectue Ã  distance.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre raspberry PI.</p>
</li>
<li>
<p>DÃ©marrez votre raspberry. Attention, les Raspberry PI 5 ont un bouton <code>On</code></p>
</li>
<li>
<p>Attendez environ 2 minutes le temps que le premier boot se termine. Tout pendant la procÃ©dure de boot, la petite led d&#8217;accÃ¨s disque doit clignoter.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_connexion_au_travers_du_rÃ©seau">5.3. Connexion au travers du rÃ©seau</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vous devez maintenant dÃ©couvrir l&#8217;adresse IP de votre Raspberry, pour cela tapez la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ping raspberrypi.local <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Attention remplacez raspberrypi par le nom d&#8217;HÃ´te que vous avez choisi lors de la configuration</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si le Raspberry a dÃ©marrÃ© correctement, cette commande doit montrer l&#8217;adresse IP du raspberry et une rÃ©ponse correcte au ping</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>PING raspberrypi.local (192.168.3.212) 56(84) bytes of data.
64 bytes from raspberrypi.local (192.168.3.212): icmp_seq=1 ttl=64 time=1.32 ms</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vous pouvez aussi utiliser la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"> arp <span class="nt">-na</span> | <span class="nb">grep</span> <span class="nt">-Pi</span> <span class="s2">"(b8:27:eb)|(dc:a6:32)|(e4:5f:01)|(d8:3a:dd)"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Elle vous donnera l&#8217;adresse IP de tous les raspberry de votre rÃ©seau et prÃ©sents dans le cache ARP de votre PC.</p>
</li>
<li>
<p>Ensuite testez l&#8217;adresse ip trouvÃ©e</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ping 192.168.0.100 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici l&#8217;adresse IP qui a Ã©tÃ© dÃ©couverte.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si le Raspberry a dÃ©marrÃ© correctement, cette commande doit montrer l&#8217;adresse IP du raspberry et une rÃ©ponse correcte au ping</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=64 time=1.49 ms</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Si vous n&#8217;obtenez aucun rÃ©sultat essayer la commande <code>nmap</code> sur le subnet de votre rÃ©seau local</p>
<div class="ulist">
<ul>
<li>
<p>On obtient l&#8217;adresse local du subnet en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-I</span></code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;adresse IP de votre PC est affichÃ©e comme premier mot. Par exemple :`192.168.3.10`</p>
</li>
<li>
<p>le subnet se dÃ©duit de cette adresse en gardant les 3 premiers nombres (cas gÃ©nÃ©ral de la plupart des utilisateurs).</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">nmap <span class="nt">-sn</span> 192.168.3.0/24 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En suite Ã  l&#8217;exemple de hostname reÃ§u dans l&#8217;Ã©tape prÃ©cÃ©ndente, nous avons remplacÃ© le 10 Ã  la fin de l&#8217;adresse IP par 0.</td>
</tr>
</table>
</div>
</li>
<li>
<p>la commande affiche alors les adresses IP et mac de toutes les machines prÃ©sentes sur le rÃ©seau.</p>
</li>
<li>
<p>le Raspberry se reconnait par son nom de machine qui contient le terme <code>raspberry</code> ou par son adresse mac qui est reconnue du type <code>Raspberry Pi Foundation</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>vous pouvez alors directement vous connecter. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh username@adresse_ip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>username est le <code>nom d&#8217;utilisateur</code> dÃ©fini lors de la configuration. adresse_ip est l&#8217;adresse IP du Raspberry pi dÃ©couverte prÃ©cÃ©demment ou raspberrypi.local ou <code>nom d&#8217;hÃ´te</code>.local</td>
</tr>
</table>
</div>
</li>
<li>
<p>Se loguer avec le mot de passe dÃ©fini pendant la configuration</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_headless_de_ubuntu_64">5.4. Installation Headless de Ubuntu 64</h3>
<div class="paragraph">
<p>Pour ce type d&#8217;installation, pas besoin d&#8217;Ã©cran, de clavier et de souris. Tout s&#8217;effectue Ã  distance.</p>
</div>
<div class="paragraph">
<p>Dans la suite, je suppose que vous possÃ©dez un PC fonctionnant avec un Linux (la procÃ©dure peut Ãªtre adaptÃ©e pour une machine Windows en utilisant la ligne de commande et putty)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avant d&#8217;enlever votre flash SD du lecteur, appliquez la procÃ©dure ci aprÃ¨s:</p>
<div class="ulist">
<ul>
<li>
<p>Sur la flash, 2 partitions ont Ã©tÃ© crÃ©es. Montez la partition <code>system-boot</code></p>
</li>
<li>
<p>sur cette partition, editez le fichier <code>network-config</code> et Ã©ditez le avec un Ã©diteur de text (Nano ou vi sous linux ou Notepad sous windows).</p>
</li>
<li>
<p>Mettez y le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>version: 2
ethernets:
  eth0:
    dhcp4: true
    optional: true
wifis:
  wlan0:
    dhcp4: true
    optional: true
    access-points:
      YOURSSID: <i class="conum" data-value="1"></i><b>(1)</b>
        password: "YOURPASSWORD" <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>YOURSSID</code> par le nom SSID de votre wifi local</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez <code>YOURPASSWORD</code> par le mot de passe de votre wifi local</td>
</tr>
</table>
</div>
</li>
<li>
<p>sauvez le fichier</p>
</li>
<li>
<p>dÃ©montez la partition</p>
</li>
<li>
<p>au boot sur la carte SD, le fichier sera recopiÃ© dans votre configuration et le rÃ©seau wifi sera ainsi accessible</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enlevez la carte SD de votre lecteur et insÃ©rez la dans votre Raspberry PI.</p>
</li>
<li>
<p>DÃ©marrez votre raspberry.</p>
</li>
<li>
<p>Attendez environ 2 minutes le temps que le premier boot se termine. Tout pendant la procÃ©dure de boot, la petite led d&#8217;accÃ¨s disque doit clignoter.</p>
</li>
<li>
<p>Vous devez maintenant dÃ©couvrir l&#8217;adresse IP de votre Raspberry, pour cela tapez la commande suivante:
+</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre> arp -na | grep -Pi "(b8:27:eb)|(dc:a6:32)|(e4:5f:01)|(d8:3a:dd)"</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensuite testez l&#8217;adresse ip trouvÃ©e</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ping 192.168.0.100 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici l&#8217;adresse IP qui a Ã©tÃ© dÃ©couverte.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si le Raspberry a dÃ©marrÃ© correctement, cette commande doit montrer l&#8217;adresse IP du raspberry et une rÃ©ponse correcte au ping</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>PING 192.168.0.100 (192.168.0.100) 56(84) bytes of data.
64 bytes from 192.168.0.100: icmp_seq=1 ttl=64 time=1.49 ms</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Si vous n&#8217;obtenez aucun rÃ©sultat essayer la commande <code>nmap</code> sur le subnet de votre rÃ©seau local</p>
<div class="ulist">
<ul>
<li>
<p>On obtient l&#8217;adresse local du subnet en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-I</span></code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;adresse IP de votre PC est affichÃ©e comme premier mot. Par exemple :`192.168.3.10`</p>
</li>
<li>
<p>le subnet se dÃ©duit de cette adresse en gardant les 3 premiers nombres (cas gÃ©nÃ©ral de la plupart des utilisateurs).</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">nmap <span class="nt">-sn</span> 192.168.3.0/24</code></pre>
</div>
</div>
</li>
<li>
<p>la commande affiche alors les adresses IP et mac de toutes les machines prÃ©sentes sur le rÃ©seau.</p>
</li>
<li>
<p>le Raspberry se reconnait par son nom de machine qui contient le terme <code>ubuntu</code> ou par son adresse mac qui est reconnue du type <code>Raspberry Pi Foundation</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>vous pouvez alors directement vous connecter. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh ubuntu@adresse_ip <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adresse_ip est l&#8217;adresse IP du Raspberry pi dÃ©couverte prÃ©cÃ©demment</td>
</tr>
</table>
</div>
</li>
<li>
<p>Se loguer avec le mot de passe <code>ubuntu</code></p>
</li>
<li>
<p>Un nouveau mot de passe vous sera demandÃ© puis vous serez dÃ©connectÃ©.</p>
</li>
<li>
<p>Reconnectez vous.</p>
</li>
<li>
<p>Installez la langue franÃ§aise. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>language-pack-fr manpages-fr</code></pre>
</div>
</div>
</li>
<li>
<p>Installer la locale qui vous plait. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dpkg-reconfigure locales</code></pre>
</div>
</div>
</li>
<li>
<p>Choisissez votre langue locale. Par exemple: <code>fr_FR.UTF-8</code></p>
</li>
<li>
<p>Installer la la timezone qui vous plait. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dpkg-reconfigure tzdata</code></pre>
</div>
</div>
</li>
<li>
<p>Choisissez votre Timezone. Par exemple: <code>Europe/Paris</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_de_vnc">6. Configuration de VNC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VNC permet de prendre le contrÃ´le Ã  distance et en mode graphique du raspberry pi.</p>
</div>
<div class="paragraph">
<p>Il peut Ãªtre lancÃ© Ã  la demande ou automatiquement au dÃ©marrage du raspberry pour un utilisateur standard.</p>
</div>
<div class="paragraph">
<p>L&#8217;installation est simple:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sur le bureau du raspberry aller dans le menu &#8594;PrÃ©fÃ©rences&#8594;Configuration du raspberry Pi</p>
</li>
<li>
<p>Dans la fenÃªtre qui s&#8217;ouvre allez dans l&#8217;onglet interfaces et cliquez sur VNC.</p>
</li>
<li>
<p>Cliquez sur Valider</p>
</li>
<li>
<p>Le raspberry PI a des problÃ¨mes de lenteurs lorsque vous ne branchez pas d&#8217;Ã©cran au moment du boot de votre raspberry. C&#8217;est typiquement le cas pour les configurations Headless. Pour corriger cela il faut forcer une rÃ©solution avec une autodÃ©tection de l&#8217;Ã©cran. Il faut modifier la conf de boot.</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez,</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/firmware/cmdline.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Puis sur la ligne prÃ©sentÃ© Ã  l&#8217;Ã©cran, ajoutez au bout le texte suivant prÃ©cÃ©dÃ© d&#8217;un espace. Vous pouvez changer la rÃ©solution (1024x768) comme vous voulez :</p>
<div class="listingblock">
<div class="content">
<pre>video=HDMI-A-1:1024x768@60D</pre>
</div>
</div>
</li>
<li>
<p>Le driver graphique dÃ©finit par dÃ©faut n&#8217;est pas le bon pour un Raspberry PI 4 ou 5. Tapez</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /boot/firmware/config.txt</code></pre>
</div>
</div>
</li>
<li>
<p>Cherchez la ligne <code>dtoverlay=vc4-kms-v3d</code> et replacez la avec :</p>
<div class="listingblock">
<div class="content">
<pre>gpu_mem=128
dtoverlay=vc4-kms-v3d-pi4 <i class="conum" data-value="1"></i><b>(1)</b>
hdmi_force_hotplug=1</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>pour un raspberry PI 5 remplacez -pi4 par -pi5.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si la ligne n&#8217;est pas trouvÃ© c&#8217;est que la configuration est plus rÃ©cente. il faut alors rajouter ces lignes directement dans le fichier vers la fin.</p>
</li>
<li>
<p>Rebootez</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enfin sur votre machine HÃ´te:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez Tigervnc-viewer; c&#8217;est le seul qui est compatible avec les certificats de ce VNC</p>
</li>
<li>
<p>SÃ©lectionnez l&#8217;adresse IP de votre raspberry</p>
</li>
<li>
<p>Connectez vous, acceptez les certificats</p>
</li>
<li>
<p>Entrez le login et mot de passe de votre compte sudo du raspberry.</p>
</li>
<li>
<p>C&#8217;est fait
Si vous ne souhaitez pas dÃ©marrer automatiquement x11vnc, ne crÃ©ez pas le fichier 'vnc server.desktop' dans le rÃ©pertoire autostart.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_basique">7. Configuration basique</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="domain_config">7.1. VÃ©rification du nom de serveur</h3>
<div class="paragraph">
<p>Cette partie consiste Ã  vÃ©rifier que le serveur a un hostname correctement configurÃ©.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>vÃ©rifier que le hostname est bien celui attendu (c&#8217;est Ã  dire configurÃ© par votre hÃ©bergeur). Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /etc/hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le nom du hostname (sans le domaine) doit s&#8217;afficher.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Si ce n&#8217;est pas le cas, changer ce nom en Ã©ditant le fichier. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">vi /etc/hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changez la valeur, sauvegardez et rebootez. Tapez :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">reboot</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifier le fichier <code>hosts</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si le fichier contient plusieurs lignes avec la mÃªme adresse de loopback en <code>127.x.y.z</code>, en gardez une seule et celle avec le hostname et le nom de domaine complet.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>si ce n&#8217;est pas le cas, changer les lignes en Ã©ditant le fichier. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/hosts</code></pre>
</div>
</div>
</li>
<li>
<p>Changez la ou les lignes, sauvegardez.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Le FQDN (nom de machine avec le nom de domaine) doit Ãªtre dÃ©clarÃ© avant le hostname simple dans le fichier <code>hosts</code>.  Pour que la configuration de votre serveur de mail soit correcte vous devez installer un FQDN contenant l&#8217;adresse de mail comme <code>mail.example.com</code>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebootez. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">reboot</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifiez que tout est correctement configurÃ©.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La sortie doit afficher le nom de host.</p>
</div>
</li>
<li>
<p>Tapez ensuite :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La sortie doit afficher le nom de host avec le nom de domaine.</p>
</div>
</li>
<li>
<p>Reconfigurez les clÃ©s SSH server si vous avez changÃ© le Hostname. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">rm</span> <span class="nt">-v</span> /etc/ssh/ssh_host_<span class="k">*</span>
dpkg-reconfigure openssh-server</code></pre>
</div>
</div>
</li>
<li>
<p>Les nouvelles clÃ©s vont Ãªtre regÃ©nÃ©rÃ©es.</p>
</li>
<li>
<p>DÃ©connectez vous de votre session SSH et reconnectez vous.</p>
</li>
<li>
<p>Sur votre poste de travail, la clÃ© d&#8217;authentification du serveur aura changÃ©e. il vous faudra annuler l&#8217;ancien puis accepter la nouvelle.</p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/known_hosts"</span> <span class="nt">-R</span> <span class="nb">hostname</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer hostname par l&#8217;adresse IP ou le nom de machine</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="#root_login">Reloguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_mettre_lÃ©diteur_de_votre_choix">7.2. Mettre l&#8217;Ã©diteur de votre choix</h3>
<div class="paragraph">
<p>En fonction de vos prÃ©fÃ©rences en terme d&#8217;Ã©diteur, choisissez celui qui vous convient pour les outils utilisant un Ã©diteur de faÃ§on automatique tels que <code>crontab</code>.</p>
</div>
<div class="paragraph">
<p>Pour les dÃ©butants, il est conseillÃ© d&#8217;utiliser <code>nano</code> pour les utilisateurs avancÃ©s, vous pouvez utiliser <code>vim</code></p>
</div>
<div class="paragraph">
<p><a href="#root_login">Loguez vous comme root </a>.</p>
</div>
<div class="paragraph">
<p>Si vous voulez installer <code>vim</code>, tapez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>vim</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pour SÃ©lectionner votre Ã©diteur par dÃ©faut, tapez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">update-alternatives  <span class="nt">--config</span> editor</code></pre>
</div>
</div>
<div class="paragraph">
<p>choisissez le chiffre correspondant Ã  Nano ou Vim.basic et quittez.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_dun_repository_pour_etc">7.3. Installation d&#8217;un repository pour <code>/etc</code></h3>
<div class="paragraph">
<p>Si vous souhaitez gÃ©rer en gestion de configuration le contenu de votre rÃ©pertoire <code>/etc</code>, installez <code>etckeeper</code>.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle. Elle permet de garder dans un repository GIT toutes les modifications qui sont effectuÃ©es dans /etc soit par vous soit au moment de l&#8217;installation de paquets.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update
apt <span class="nb">install </span>etckeeper</code></pre>
</div>
</div>
</li>
<li>
<p>Vous pouvez crÃ©er un repository privÃ© dans le cloud pour stocker votre configuration de serveur (autre serveur privÃ© de confiance ou repository privÃ©  <code>Gitlab</code> ou <code>Github</code>).</p>
</li>
<li>
<p>Ajoutez ce repository distant. Pour <code>Gitlab</code> et <code>Github</code>, une fois le repository crÃ©Ã©, demandez l&#8217;affichage de la commande git pour une communication en ssh. Tapez ensuite sur votre serveur :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc
git remote add origin git@github.com:username/etc_keeper.git <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer l&#8217;url par celle qui correspond au chemin de votre repository</td>
</tr>
</table>
</div>
</li>
<li>
<p>modifier le fichier de configuration de <code>etckeeper</code>. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/etckeeper/etckeeper.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Recherchez la ligne contenant <code>PUSH_REMOTE</code> et ajoutez y tous les repositories distant sur lesquels vous souhaitez pousser les modifications. Pour notre configuration, mettez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">PUSH_REMOTE</span><span class="o">=</span><span class="s2">"origin"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Pour Ã©viter des demandes de mot de passe de la part de <code>github</code> ou <code>gitlab</code>, il est nÃ©cessaire de dÃ©clarer une clÃ© publique sur leur site. CrÃ©ez une clÃ© sur votre serveur pour l&#8217;utilisateur root:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CrÃ©er un rÃ©pertoire <code>/root/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /root
<span class="nb">mkdir</span> <span class="nt">-p</span> .ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /root/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
<li>
<p>Allez sur <code>gitlab</code> ou <code>github</code> dans la rubriques "settings" et le menu "SSH keys". Ajoutez la clÃ© que vous aurez affichÃ© avec la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> /root/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuez un premier push. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc
git push <span class="nt">-u</span> origin master</code></pre>
</div>
</div>
</li>
<li>
<p>aucun mot de passe ne doit vous Ãªtre demandÃ©. Si ce n&#8217;est pas le cas, re-vÃ©rifier les Ã©tapes prÃ©cÃ©dentes.</p>
</li>
<li>
<p>Lancer <code>etckeeper</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">etckeeper commit</code></pre>
</div>
</div>
</li>
<li>
<p>Tout le contenu de <code>/etc</code> est poussÃ© sur le repository. Saisissez un commentaire.</p>
</li>
<li>
<p>C&#8217;est fait !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_mise_Ã _jour_des_sources_de_paquets_debian_ou_ubuntu">7.4. Mise Ã  jour des sources de paquets Debian ou Ubuntu</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Selon la distribution installÃ©e suivez la procÃ©dure ci-aprÃ¨s ou celle suivante.</p>
</li>
<li>
<p>Modifier la liste standard de paquets Debian</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ãditer le fichier <code>/etc/apt/sources.list</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apt/sources.list</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©-commenter les lignes dÃ©butant par <code>deb</code> et contenant le terme <code>backports</code>. Par exemple pour <code>#deb <a href="http://deb.debian.org/debian" class="bare">http://deb.debian.org/debian</a> bookworm-backports main contrib non-free</code> enlever le # en dÃ©but de ligne</p>
</li>
<li>
<p>Ajouter sur toutes les lignes les paquets <code>contrib</code> et <code>non-free</code> . en ajoutant ces textes aprÃ¨s chaque mot <code>main</code> du fichier <code>source.list</code></p>
</li>
<li>
<p>Le fichier doit ressembler Ã  ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bookworm</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span> <span class="err">non-free-firmware</span>

<span class="c">## Major bug fix updates produced after the final release of the
## distribution.
</span><span class="err">deb</span> <span class="err">http://security.debian.org/debian-security</span> <span class="err">bookworm-security</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span> <span class="err">non-free-firmware</span>
<span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bookworm-updates</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span> <span class="err">non-free-firmware</span>

<span class="c">## N.B. software from this repository may not have been tested as
## extensively as that contained in the main release, although it includes
## newer versions of some applications which may provide useful features.
</span><span class="err">deb</span> <span class="err">http://deb.debian.org/debian</span> <span class="err">bookworm-backports</span> <span class="err">main</span> <span class="err">contrib</span> <span class="err">non-free</span> <span class="err">non-free-firmware</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Modifier la liste standard de paquets Ubuntu</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ãditer le fichier <code>/etc/apt/sources.list</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apt/sources.list</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©-commenter les lignes dÃ©butant par <code>deb</code> enlever le # en dÃ©but de ligne</p>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuer une mise Ã  niveau du systÃ¨me</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Mettez Ã  jour la liste des paquets. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Installez les nouveautÃ©s. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt dist-upgrade</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Effectuez du mÃ©nage. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt autoremove</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_des_paquets_de_base">7.5. Installation des paquets de base</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>curl wget ntpdate apt-transport-https apt-listchanges apt-file apt-rdepends man</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_passage_de_la_locale_en_fr">7.6. Passage de la locale en FR</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>locales</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez ensuite:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre> dpkg-reconfigure locales</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dans l&#8217;Ã©cran qui apparait, sÃ©lectionnez: <code>fr_FR.UTF_8</code></p>
</li>
<li>
<p>Tapez ensuite sur la ligne de commande: <code>locale</code></p>
</li>
<li>
<p>Le texte suivant apparait:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>LANG=fr_FR.UTF-8
LC_CTYPE="fr_FR.UTF-8"
LC_NUMERIC="fr_FR.UTF-8"
LC_TIME="fr_FR.UTF-8"
LC_COLLATE="fr_FR.UTF-8"
LC_MONETARY="fr_FR.UTF-8"
LC_MESSAGES="fr_FR.UTF-8"
LC_PAPER="fr_FR.UTF-8"
LC_NAME="fr_FR.UTF-8"
LC_ADDRESS="fr_FR.UTF-8"
LC_TELEPHONE="fr_FR.UTF-8"
LC_MEASUREMENT="fr_FR.UTF-8"
LC_IDENTIFICATION="fr_FR.UTF-8"
LC_ALL=</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez ensuite la ligne suivante pour installer l&#8217;environnement en franÃ§ais:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>task-french</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installer_loutil_debfoster">7.7. Installer l&#8217;outil Debfoster</h3>
<div class="paragraph">
<p>L&#8217;outil <code>debfoster</code> permet de ne conserver que les paquets essentiels.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="paragraph">
<p>Il maintient un fichier <code>keepers</code> prÃ©sent dans <code>/var/lib/debfoster</code></p>
</div>
<div class="paragraph">
<p>En rÃ©pondant aux questions de conservations de paquets, <code>debfoster</code> maintient la liste des paquets uniques nÃ©cessaires au systÃ¨me.
Tous les autres paquets seront supprimÃ©s.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajouter le paquet <code>debfoster</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez <code>debfoster</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©pondez au questions pour chaque paquet</p>
</li>
<li>
<p>Acceptez la liste des modifications proposÃ©es Ã  la fin. Les paquets superflus seront supprimÃ©s</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ci dessous une petite liste de paquets Ã  conserver sur une installation basique Debian 64 pour Raspberry PI:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-listchanges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-rdepends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-transport-https</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">avahi-daemon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">build-essential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cifs-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">console-setup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debconf-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debfoster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dphys-swapfile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dselect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ethtool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fake-hwclock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fbset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-atheros</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-brcm80211</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-libertas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-misc-nonfree</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firmware-realtek</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gdb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hardlink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">htop</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">libpam-chksshpwd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">libraspberrypi-doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">man-db</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mkvtoolnix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ncdu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nfs-common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">p7zip-full</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pi-bluetooth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pkg-config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">python-is-python3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raspberrypi-net-mods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raspinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rng-tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rpi-update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rsync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh-import-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sudo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">udisks2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usb-modeswitch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">userconf-pi</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">v4l-utils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wireless-tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wpasupplicant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zip</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>La mÃªme liste pour un Ubuntu pour Raspberry PI:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-listchanges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-rdepends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">apt-transport-https</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud-init</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debfoster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">etckeeper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">language-pack-fr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux-firmware-raspi2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux-raspi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">manpages-fr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ntpdate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openssh-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-boot-rpi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ubuntu-server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ubuntu-standard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wpasupplicant</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dun_fichier_keeper_dans_etc">7.8. CrÃ©ation d&#8217;un fichier keeper dans /etc</h3>
<div class="paragraph">
<p>Vous pourriez Ãªtre intÃ©ressÃ© aprÃ¨s l&#8217;installation de <code>debfoster</code> et de <code>etckeeper</code> de construire automatiquement un fichier qui contient la liste des paquets qui permettent de rÃ©installer le systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/etckeeper/pre-commit.d/35debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>Saisissez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># Make sure sort always sorts in same order.</span>
<span class="nv">LANG</span><span class="o">=</span>C
<span class="nb">export </span>LANG

shellquote<span class="o">()</span> <span class="o">{</span>
        <span class="c"># Single quotes text, escaping existing single quotes.</span>
        <span class="nb">sed</span> <span class="nt">-e</span> <span class="s2">"s/'/'</span><span class="se">\"</span><span class="s2">'</span><span class="se">\"</span><span class="s2">'/g"</span> <span class="nt">-e</span> <span class="s2">"s/^/'/"</span> <span class="nt">-e</span> <span class="s2">"s/</span><span class="nv">$/</span><span class="s2">'/"</span>
<span class="o">}</span>


<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> git <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> hg <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> bzr <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> darcs <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c"># Make sure the file is not readable by others, since it can leak</span>
        <span class="c"># information about contents of non-readable directories in /etc.</span>
        debfoster <span class="nt">-q</span> <span class="nt">-k</span> /etc/keepers
        <span class="nb">chmod </span>600 /etc/keepers
        <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"1i</span><span class="se">\\</span><span class="s2"># debfoster file"</span> /etc/keepers
        <span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"1i</span><span class="se">\\</span><span class="s2"># Generated by etckeeper.  Do not edit."</span>  /etc/keepers

        <span class="c"># stage the file as part of the current commit</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$VCS</span><span class="s2">"</span> <span class="o">=</span> git <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="c"># this will do nothing if the keepers file is unchanged.</span>
                git add keepers
        <span class="k">fi</span>
        <span class="c"># hg, bzr and darcs add not done, they will automatically</span>
        <span class="c"># include the file in the current commit</span>
<span class="k">fi</span></code></pre>
</div>
</div>
</li>
<li>
<p>Sauvez et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/etckeeper/pre-commit.d/35debfoster</code></pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez maintenant <code>etckeeper</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">etckeeper commit</code></pre>
</div>
</div>
</li>
<li>
<p>Le fichier keepers est crÃ©Ã© et sauvegardÃ© automatiquement.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_des_mises_Ã _jours_automatiques">7.9. Installation des mises Ã  jours automatiques</h3>
<div class="paragraph">
<p>Si vous souhaitez installer automatiquement les paquets Debian de correction de bugs de sÃ©curitÃ©, cette installation est pour vous.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
L&#8217;installation automatique de paquets peut conduire dans certains cas
trÃ¨s rare Ã  des dysfonctionnements du serveur. Il est important de
regarder pÃ©riodiquement les logs d&#8217;installation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>unattended-upgrades</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_interdire_le_login_direct_en_root">7.10. Interdire le login direct en root</h3>
<div class="paragraph">
<p>Il est toujours vivement dÃ©conseillÃ© d&#8217;autoriser la possibilitÃ© de se connecter directement en SSH en tant que root.</p>
</div>
<div class="paragraph">
<p>Avec les versions rÃ©centes de Debian Bookworm pour raspberry pi, il n&#8217;est plus nÃ©cessaire de crÃ©er le compte sudo qui est crÃ©Ã© par dÃ©faut lors de la procÃ©dure d&#8217;installation standard. Cette procÃ©dure est cependant  indispensable pour l&#8217;installation d&#8217;une distribution debian standard.</p>
</div>
<div class="paragraph">
<p>Une remarque tout de mÃªme pour le raspberry pi: le compte sudo permet de se logger root sans aucun mot de passe. C&#8217;est considÃ©rÃ© comme une faille de sÃ©curitÃ©. Pour corriger cela, <a href="#root_login">Loguez vous comme root sur le serveur</a> et tapez:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">rm</span> <span class="nt">-f</span> /etc/sudoers.d/010_pi-nopasswd</code></pre>
</div>
</div>
<div class="paragraph">
<p>La procÃ©dure suivante s&#8217;applique pour la crÃ©ation du compte sudo sur une debian standard.</p>
</div>
<div class="paragraph">
<p>Notre premiÃ¨re action sera de dÃ©sactiver le login direct en root  et d&#8217;autoriser le sudo.</p>
</div>
<div class="paragraph">
<p>Respectez bien les Ã©tapes de cette procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez l&#8217;outil <code>sudo</code> s&#8217;il n&#8217;est pas dÃ©jÃ  prÃ©sent. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install sudo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez un utilisateur standard qui sera nommÃ© par la suite en tant que &lt;sudo_username&gt;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adduser &lt;sudo_username&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login</td>
</tr>
</table>
</div>
</li>
<li>
<p>RÃ©pondez aux questions qui vont sont posÃ©es: habituellement le nom complet d&#8217;utilisateur et le mot de passe.</p>
</li>
<li>
<p>Donner les attributs sudo Ã  l&#8217;utilisateur <code>&lt;sudo_username&gt;</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">usermod <span class="nt">-a</span> <span class="nt">-G</span> <span class="nb">sudo</span> &lt;sudo_username&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login</td>
</tr>
</table>
</div>
</li>
<li>
<p>Dans une autre fenÃªtre, se connecter sur le serveur avec votre nouveau compte <code>&lt;sudo_username&gt;</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>une fois loguÃ©, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tapez le mot de passe de votre utilisateur. Vous devez avoir accÃ¨s au compte root. Si ce n&#8217;est pas le cas, revÃ©rifiez la procÃ©dure et repassez toutes les Ã©tapes.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Tout pendant que ces premiÃ¨res Ã©tapes ne donnent pas satisfaction ne passez pas Ã  la suite sous peine de perdre la possibilitÃ© dâaccÃ©der Ã  votre serveur.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Il faut maintenant modifier la configuration de sshd.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Editez le fichier <code>/etc/ssh/sshd_config</code>, Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/ssh/sshd_config</code></pre>
</div>
</div>
<div class="paragraph">
<p>il faut rechercher la ligne: <code>PermitRootLogin yes</code> et la remplacer par:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">PermitRootLogin</span> <span class="err">no</span></code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez le serveur ssh. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service sshd restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Faites maintenant l&#8217;essai de vous re-loguer avec le compte root.Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh root@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacer ici &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ce ne devrait plus Ãªtre possible: le serveur vous l&#8217;indique par un message <code>Permission denied, please try again.</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dune_clÃ©_de_connexion_ssh_locale">7.11. CrÃ©ation d&#8217;une clÃ© de connexion ssh locale</h3>
<div class="paragraph">
<p>Pour crÃ©er une clÃ© et la dÃ©ployer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une clÃ© sur votre machine locale (et pas sur le serveur distant!):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ouvrir un terminal</p>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh
<span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Sur votre PC local afficher la clÃ© Ã  l&#8217;Ã©cran. Elle sera copiÃ©e-collÃ©e par la suite:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cat</span> ~/.ssh/id_rsa.pub</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©ployez votre clÃ©:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Loguez vous sur votre serveur distant. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine
<div class="paragraph">
<p>Entrez votre mot de passe</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez le fichier <code>~/.ssh/authorized_keys</code> tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ~/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>et coller dans ce fichier le texte contenu dans le votre fichier local <code>~/.ssh/id_rsa.pub</code>. Remarque: il peut y avoir dÃ©jÃ  des clÃ©s dans le fichier <code>authorized_keys</code>.</p>
</div>
</li>
<li>
<p>SÃ©curisez votre fichier de clÃ©s. Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>600 ~/.ssh/authorized_keys</code></pre>
</div>
</div>
</li>
<li>
<p>SÃ©curisez le rÃ©pertoire SSH; Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©connectez vous de votre session</p>
</li>
</ol>
</div>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne en vous connectant. Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh &lt;sudo_username&gt;@&lt;example.com&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici &lt;sudo_username&gt; par votre login et &lt;example.com&gt; par votre nom de domaine
<div class="paragraph">
<p>La session doit s&#8217;ouvrir sans demander de mot de passe.</p>
</div></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_sudo_sans_mot_de_passe">7.12. Sudo sans mot de passe</h3>
<div class="paragraph">
<p>Avant tout, il faut bien se rendre compte que cela constitue potentiellement une faille de sÃ©curitÃ© et qu&#8217;en consÃ©quence, le compte possÃ©dant cette propriÃ©tÃ© devra Ãªtre autant sÃ©curisÃ© qu&#8217;un compte root.
LâintÃ©rÃªt Ã©tant d&#8217;interdire le compte root en connexion ssh tout en gardant la facilitÃ© de se loguer root sur le systÃ¨me au travers d&#8217;un super-compte.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajoutez un groupe sudonp et y affecter un utilisateur. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">addgroup <span class="nt">--system</span> sudonp</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ajouter l&#8217;utilisateur: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">usermod <span class="nt">-a</span> <span class="nt">-G</span> sudonp &lt;sudo_username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Ãventuellement retirez l&#8217;utilisateur du groupe sudo s&#8217;il a Ã©tÃ© ajoutÃ© auparavant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">gpasswd <span class="nt">-d</span> &lt;sudo_username&gt; <span class="nb">sudo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez le fichier sudoers. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/sudoers.d/010_sudonp</code></pre>
</div>
</div>
</li>
<li>
<p>Ajouter dans le fichier la ligne suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="err">%sudonp</span> <span class="py">ALL</span><span class="p">=</span><span class="s">(ALL:ALL) NOPASSWD: ALL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>L&#8217;utilisateur nom_d_utilisateur pourra se logger root sans mot de passe au travers de la commande <code>sudo bash</code></p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_motd">7.13. Configuration du Motd</h3>
<div class="paragraph">
<p>Le motd est affichÃ© au moment ou l&#8217;utilisateur se loggue en ssh. Nous allons configurer l&#8217;affichage de plusieurs informations importantes.</p>
</div>
<div class="sect3">
<h4 id="_installation_de_neofetch">7.13.1. Installation de Neofetch</h4>
<div class="paragraph">
<p>Neofetch affiche au dÃ©marrage de votre systÃ¨me des informations sur le fonctionnement de celui-ci.</p>
</div>
<div class="paragraph">
<p>Nous allons crÃ©er une configuration systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez le package neofetch. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>Editez ensuite le fichier <code>/etc/neofetch.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/neofetch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">print_info<span class="o">()</span> <span class="o">{</span>
    info title
    info underline

    info <span class="s2">"OS"</span> distro
    info <span class="s2">"Host"</span> model
    info <span class="s2">"Kernel"</span> kernel
    info <span class="s2">"Uptime"</span> <span class="nb">uptime
    </span>info <span class="s2">"Packages"</span> packages
    info <span class="s2">"Shell"</span> shell
    info <span class="s2">"Resolution"</span> resolution
    info <span class="s2">"DE"</span> de
    info <span class="s2">"WM"</span> wm
    info <span class="s2">"WM Theme"</span> wm_theme
    info <span class="s2">"Theme"</span> theme
    info <span class="s2">"Icons"</span> icons
    info <span class="s2">"Terminal"</span> term
    info <span class="s2">"Terminal Font"</span> term_font
    info <span class="s2">"CPU"</span> cpu
    info <span class="s2">"CPU Usage"</span> cpu_usage
    prin <span class="s2">"CPU Temp"</span> <span class="s2">"</span><span class="si">$(</span>vcgencmd measure_temp | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'='</span> <span class="s1">'{print $2}'</span><span class="si">)</span><span class="s2">"</span> <i class="conum" data-value="1"></i><b>(1)</b>
    prin <span class="s2">"Load"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> /proc/loadavg | <span class="nb">awk</span> <span class="s1">'{print $1, $2, $3}'</span><span class="si">)</span><span class="s2">"</span>
    info <span class="s2">"GPU"</span> gpu
    info <span class="s2">"GPU Driver"</span> gpu_driver  <span class="c"># Linux/macOS only</span>
    info <span class="s2">"Memory"</span> memory
    info <span class="s2">"Disk"</span> disk
    info <span class="s2">"Local IP"</span> local_ip
    info <span class="s2">"Public IP"</span> public_ip
    info <span class="s2">"Users"</span> <span class="nb">users
    </span>info <span class="s2">"Locale"</span> locale  <span class="c"># This only works on glibc systems.</span>

    info cols
<span class="o">}</span>

<span class="nv">title_fqdn</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">memory_percent</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">memory_unit</span><span class="o">=</span><span class="s2">"mib"</span>
<span class="nv">package_managers</span><span class="o">=</span><span class="s2">"on"</span>
<span class="nv">image_backend</span><span class="o">=</span><span class="s2">"ascii"</span>
<span class="nv">cpu_temp</span><span class="o">=</span><span class="s2">"on"</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cette ligne est Ã  retirer si vous n&#8217;utilisez pas de Raspberry PI 4 ou 5</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_du_motd_avec_neofetch">7.13.2. Configuration du MOTD avec Neofetch</h4>
<div class="paragraph">
<p>Pour afficher les informations au moment du login ssh, vous devez modifier le fichier Motd:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier Neofetch du MOTD</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/update-motd.d/20-neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ensuite dans le fichier la configuration suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
neofetch <span class="nt">--config</span> /etc/neofetch.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Changez les permissions du fichier <code>20-neofetch</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/update-motd.d/20-neofetch</code></pre>
</div>
</div>
</li>
<li>
<p>A notez que vous pouvez utiliser Neofetch pour votre fichier <code>.bash_profile</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mise_Ã _jour_de_packages">7.13.3. Mise Ã  jour de packages</h4>
<div class="paragraph">
<p>Vous pouvez ajouter la liste des mises Ã  jours dans le fichier MOTD:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez le package python de gestion APT. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-apt</code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier MOTD</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/update-motd.d/30-updates</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier mettez le contenu suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">apt_pkg</span>

<span class="n">DISTRO</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nc">Popen</span><span class="p">([</span><span class="sh">"</span><span class="s">lsb_release</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">-c</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">-s</span><span class="sh">"</span><span class="p">],</span>
                          <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">).</span><span class="nf">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">OpNullProgress</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">apt progress handler which supresses any output.</span><span class="sh">'''</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">done</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">is_security_upgrade</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Checks to see if a package comes from a DISTRO-security source.
    </span><span class="sh">'''</span>
    <span class="n">security_package_sources</span> <span class="o">=</span> <span class="p">[(</span><span class="sh">"</span><span class="s">Ubuntu</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">%s-security</span><span class="sh">"</span> <span class="o">%</span> <span class="n">DISTRO</span><span class="p">),</span>
                               <span class="p">(</span><span class="sh">"</span><span class="s">Debian</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">%s-security</span><span class="sh">"</span> <span class="o">%</span> <span class="n">DISTRO</span><span class="p">)]</span>

    <span class="nf">for </span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pkg</span><span class="p">.</span><span class="n">file_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">origin</span><span class="p">,</span> <span class="n">archive</span> <span class="ow">in</span> <span class="n">security_package_sources</span><span class="p">:</span>
            <span class="nf">if </span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">archive</span> <span class="o">==</span> <span class="n">archive</span> <span class="ow">and</span> <span class="nb">file</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="n">origin</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># init apt and config
</span><span class="n">apt_pkg</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

<span class="c1"># open the apt cache
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="nc">Cache</span><span class="p">(</span><span class="nc">OpNullProgress</span><span class="p">())</span>
<span class="k">except</span> <span class="nb">SystemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: Opening the cache (%s)</span><span class="sh">"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># setup a DepCache instance to interact with the repo
</span><span class="n">depcache</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="nc">DepCache</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>

<span class="c1"># take into account apt policies
</span><span class="n">depcache</span><span class="p">.</span><span class="nf">read_pinfile</span><span class="p">()</span>

<span class="c1"># initialise it
</span><span class="n">depcache</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

<span class="c1"># give up if packages are broken
</span><span class="k">if</span> <span class="n">depcache</span><span class="p">.</span><span class="n">broken_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: Broken packages exist.</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># mark possible packages
</span><span class="k">try</span><span class="p">:</span>
    <span class="c1"># run distro-upgrade
</span>    <span class="n">depcache</span><span class="p">.</span><span class="nf">upgrade</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># reset if packages get marked as deleted -&gt; we don't want to break anything
</span>    <span class="k">if</span> <span class="n">depcache</span><span class="p">.</span><span class="n">del_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">depcache</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>

    <span class="c1"># then a standard upgrade
</span>    <span class="n">depcache</span><span class="p">.</span><span class="nf">upgrade</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">SystemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">Error: Couldn</span><span class="sh">'</span><span class="s">t mark the upgrade (%s)</span><span class="sh">"</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># run around the packages
</span><span class="n">upgrades</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">security_upgrades</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">.</span><span class="n">packages</span><span class="p">:</span>
    <span class="n">candidate</span> <span class="o">=</span> <span class="n">depcache</span><span class="p">.</span><span class="nf">get_candidate_ver</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">pkg</span><span class="p">.</span><span class="n">current_ver</span>

    <span class="c1"># skip packages not marked as upgraded/installed
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">depcache</span><span class="p">.</span><span class="nf">marked_install</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span> <span class="ow">or</span> <span class="n">depcache</span><span class="p">.</span><span class="nf">marked_upgrade</span><span class="p">(</span><span class="n">pkg</span><span class="p">)):</span>
        <span class="k">continue</span>

    <span class="c1"># increment the upgrade counter
</span>    <span class="n">upgrades</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># keep another count for security upgrades
</span>    <span class="k">if</span> <span class="nf">is_security_upgrade</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
        <span class="n">security_upgrades</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># double check for security upgrades masked by another package
</span>    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">pkg</span><span class="p">.</span><span class="n">version_list</span><span class="p">:</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">current</span> <span class="ow">and</span> <span class="n">apt_pkg</span><span class="p">.</span><span class="nf">version_compare</span><span class="p">(</span><span class="n">version</span><span class="p">.</span><span class="n">ver_str</span><span class="p">,</span> <span class="n">current</span><span class="p">.</span><span class="n">ver_str</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nf">is_security_upgrade</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
            <span class="n">security_upgrades</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">break</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">%d updates to install.</span><span class="sh">"</span> <span class="o">%</span> <span class="n">upgrades</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">%d are security updates.</span><span class="sh">"</span> <span class="o">%</span> <span class="n">security_upgrades</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>  <span class="c1"># leave a trailing blank line</span></code></pre>
</div>
</div>
</li>
<li>
<p>Changez les permissions du fichier <code>30-updates</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/update-motd.d/30-updates</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installer_loutil_dselect">7.14. Installer l&#8217;outil dselect</h3>
<div class="paragraph">
<p>L&#8217;outil <code>dselect</code> permet de choisir de faÃ§on interactive les paquets que l&#8217;on souhaite installer.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ajouter le paquet <code>dselect</code>. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>dselect</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="swap_create">7.15. Ajouter un fichier de swap</h3>
<div class="paragraph">
<p>Pour un serveur VPS ou Raspberry Pi de 2 Go de RAM, la taille du fichier de swap sera de 2 Go.
Si vous avez beaucoup d&#8217;outils et de serveurs Ã  installer il peut Ãªtre nÃ©cessaire d&#8217;avoir 4 Go de RAM au total + 2 Go de swap.</p>
</div>
<div class="paragraph">
<p>Enfin pour un Raspberry PI 3 avec 1 Go de Ram, il faut ajouter 1 Go de swap.</p>
</div>
<div class="paragraph">
<p>Tapez :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tout d&#8217;abord, si l&#8217;outil <code>dphys-swapfile</code> est installÃ© et configurÃ© sur la machine, commencez par dÃ©sactiver le swap. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">dphys-swapfile uninstall</code></pre>
</div>
</div>
</li>
<li>
<p>Pour installer un swap de 4Go, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /
fallocate <span class="nt">-l</span> 4G /swapfile
<span class="nb">chmod </span>600 /swapfile
mkswap /swapfile
swapon /swapfile</code></pre>
</div>
</div>
</li>
<li>
<p>Enfin ajoutez une entrÃ©e dans le fichier fstab. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/fstab</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez la ligne:</p>
<div class="listingblock">
<div class="content">
<pre>/swapfile swap swap defaults 0 0</pre>
</div>
</div>
</li>
<li>
<p>Enfin vous pouvez Ãªtre tentÃ© de limiter le swap (surtout utile sur les systÃ¨mes avec peu de RAM et du SSD. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/sysctl.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ou modifiez la ligne:</p>
<div class="listingblock">
<div class="content">
<pre>vm.swappiness = 5</pre>
</div>
</div>
</li>
<li>
<p>Le paramÃ¨tre sera actif au prochain reboot</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_initiale_des_outils">8. Installation initiale des outils</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La procÃ©dure d&#8217;installation ci-dessous configure ISPconfig avec les fonctionnalitÃ©s suivantes: Postfix, Dovecot, MariaDB, rkHunter, Apache, PHP, Let&#8217;s Encrypt, PureFTPd, Bind, Webalizer, AWStats, fail2Ban, UFW Firewall, PHPMyadmin, RoundCube.</p>
</div>
<div class="paragraph">
<p>L&#8217;installation est simplifiÃ©e grÃ¢ce Ã  l&#8217;utilisation de l&#8217;autoinstalleur d&#8217;ISPConfig.</p>
</div>
<div class="paragraph">
<p>cet installeur fonction pour les version de Debian 10, 11 et 12 et  Ubuntu 20.04 Ã  24.04</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_de_ispconfig">8.1. Installation et configuration de ISPConfig</h3>
<div class="paragraph">
<p>ISPConfig est un systÃ¨me de configuration de sites web totalement compatible avec Webmin.</p>
</div>
<div class="paragraph">
<p>Pour installer ISPConfig, vous devez suivre la procÃ©dure ci-dessous. ISPConfig 3 a Ã©tÃ© utilisÃ© dans ce tutoriel.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">hostname</span> <span class="nt">-f</span></code></pre>
</div>
</div>
</li>
<li>
<p>La sortie doit Ãªtre du type:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mail.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Si ce n&#8217;est pas le cas corrigez le FQDN en vous rÃ©fÃ©rant au chapitre <a href="#domain_config">VÃ©rification du nom de serveur</a>.</p>
</li>
<li>
<p>Nous allons maintenant installer <a href="https://www.ispconfig.org/ispconfig/download/">ISPConfig</a> avec l&#8217;autoinstalleur.</p>
</li>
<li>
<p>Mettez Ã  jour le systÃ¨me. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update <span class="o">&amp;&amp;</span> apt dist-upgrade</code></pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez l&#8217;autoinstalleur en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget <span class="nt">-O</span> - https://get.ispconfig.org | sh <span class="nt">-s</span> <span class="nt">--</span> <span class="nt">--use-ftp-ports</span><span class="o">=</span>40110-40210 <span class="nt">--unattended-upgrades</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>vous pouvez remplacer l&#8217;Ã©ventail de ports FTP par d&#8217;autres si vous voulez.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Au bout d&#8217;un moment vous verrez s&#8217;afficher:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">WARNING! This script will reconfigure your <span class="nb">complete </span>server!
It should be run on a freshly installed server and all current configuration that you have <span class="k">done </span>will most likely be lost!
Type <span class="s1">'yes'</span> <span class="k">if </span>you really want to <span class="k">continue</span></code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©pondez 'yes'. L&#8217;installation dÃ©marre.</p>
</li>
<li>
<p>Lorsque l&#8217;installation se termine vous verrez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">[</span>INFO] Your ISPConfig admin password is: 5GvfSSSYsdfdYC
<span class="o">[</span>INFO] Your MySQL root password is: kkAkft82d!kafMwqxdtYs</code></pre>
</div>
</div>
</li>
<li>
<p>Notez ces informations, elles vous serviront pour vous connecter au panel ISPConfig ou Ã  votre base mysql (PhpMyAdmin).</p>
</li>
<li>
<p>L&#8217;installation est terminÃ©e. Vous accÃ©dez au serveur Ã  l&#8217;adresse: <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a> .</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Lors de votre premiÃ¨re connexion, votre domaine n&#8217;est pas encore configurÃ©. Il faudra alors utiliser le nom DNS donnÃ© par votre hÃ©bergeur pour votre machine. Pour Contabo, elle s&#8217;Ã©crit <code>vmixxxxx.contaboserver.net</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>. Loguez vous avec le login <code>admin</code> et le mot de passe que vous avez rÃ©cupÃ©rÃ© plus haut.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si le message "Possible attack detected. This action has been logged.". Cela signifie que vous avez des cookies d&#8217;une prÃ©cÃ©dente installation qui sont configurÃ©s. Effacer les cookies de ce site de votre navigateur.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vous pouvez passer maintenant Ã  la suite de la configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_manuelle_des_outils">9. Configuration Manuelle des outils</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce chapitre dÃ©crit comment configurer manuellement Postfix, Mariadb, Apache, Awstats, Fail2ban, Pureftp, Phpmyadmin, Roundcube, Letsencrypt manuellement.</p>
</div>
<div class="paragraph">
<p>Ce chapitre est Ã  sauter si vous avez installÃ© ISPConfig. Vous devez poursuivre vers <a href="#After_manual_install">Suite de l&#8217;installation</a></p>
</div>
<div class="paragraph">
<p>Commencez l&#8217;installation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez quelques outils de base. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>packages ssh, openssh-server, nano, vim-nox, lsb-release, apt-transport-https, ca-certificates, wget, git, gnupg, software-properties-common, curl, cron, ntp</code></pre>
</div>
</div>
</li>
<li>
<p>Installez ensuite:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>dbconfig-common, postfix, postfix-mysql, mariadb-client, mariadb-server, openssl, rkhunter, binutils, <span class="nb">sudo</span>, getmail6, rsyslog dovecot-imapd, dovecot-pop3d, dovecot-mysql, dovecot-sieve, dovecot-managesieved, dovecot-lmtpd</code></pre>
</div>
</div>
</li>
<li>
<p>Puis installez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>software-properties-common update-inetd dnsutils resolvconf clamav clamav-daemon zip unzip bzip2 xz-utils lzip borgbackup arj nomarch lzop cabextract apt-listchanges libnet-ldap-perl libauthen-sasl-perl daemon libio-string-perl libio-socket-ssl-perl libnet-ident-perl libnet-dns-perl libdbd-mysql-perl bind9 rspamd redis-server postgrey p7zip p7zip-full unrar-free lrzip</code></pre>
</div>
</div>
</li>
<li>
<p>Installez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>apache2 apache2-utils libapache2-mod-fcgid apache2-suexec-pristine libapache2-mod-python libapache2-mod-passenger</code></pre>
</div>
</div>
</li>
<li>
<p>Installez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>php php-pear php-memcache php-imagick mcrypt imagemagick libruby memcached php-apcu jailkit</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©terminer votre version de php. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">LC_ALL</span><span class="o">=</span><span class="s1">'C'</span> apt list <span class="nt">-a</span> <span class="s1">'php*'</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'php[0-9]+.[0-9]+/'</span> | <span class="nb">grep</span> <span class="s1">'\[installed\]'</span> | <span class="nb">sed</span> <span class="s1">'s/\(.*\)\/.*/\1/'</span></code></pre>
</div>
</div>
</li>
<li>
<p>En fonction de la version affichÃ©e Installez les packages PHP :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="k">for </span>i <span class="k">in </span>php#-gd php#-mysql php#-imap php#-cli php#-curl php#-intl php#-pspell php#-sqlite3 php#-tidy php#-xsl php#-zip php#-mbstring php#-soap php#-opcache php#-cgi php#-fpm php#-xmlrpc
<span class="k">do
</span><span class="nb">echo</span> <span class="nv">$i</span> | <span class="nb">sed</span> <span class="s1">'s/#/version/'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">done</span> | xargs apt <span class="nb">install</span> <span class="nt">-y</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer ici version par la version affichÃ©e plus haut. Par exemple 8.3</td>
</tr>
</table>
</div>
</li>
<li>
<p>Installez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>haveged geoip-database libclass-dbi-mysql-perl libtimedate-perl build-essential autoconf automake libtool flex bison debhelper binutils quota quotatool</code></pre>
</div>
</div>
</li>
<li>
<p>Installez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>pure-ftpd-common pure-ftpd-mysql awstats goaccess awffull</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_configuration_manuelle_de_postfix">9.1. Configuration manuelle de Postfix</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le master.cf file de postfix. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/postfix/main.cf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ou modifiez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre>append_dot_mydomain = yes
mydestination = mail.example.com, localhost, localhost.localdomain <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
</li>
<li>
<p>Editez le master.cf file de postfix. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/postfix/master.cf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre>submission inet n       -       y       -       -       smtpd
 -o syslog_name=postfix/submission
 -o smtpd_tls_security_level=encrypt
 -o smtpd_sasl_auth_enable=yes
 -o smtpd_client_restrictions=permit_sasl_authenticated,reject

submissions     inet  n       -       y       -       -       smtpd
 -o syslog_name=postfix/submissions
 -o smtpd_tls_wrappermode=yes
 -o smtpd_sasl_auth_enable=yes
 -o smtpd_client_restrictions=permit_sasl_authenticated,reject</pre>
</div>
</div>
</li>
<li>
<p>Sauvegardez et relancez Postfix:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart postfix</code></pre>
</div>
</div>
</li>
<li>
<p>Si vous avez installÃ© <code>SpamAssassin</code>, dÃ©sactiver <code>SpamAssassin</code> puisque <code>amavisd</code> utilise celui ci en sous jacent. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl stop spamassassin
systemctl disable spamassassin</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notez que si vous crÃ©ez une adresse mail nommÃ©e <code>homeserver@example.com</code>, vous pouvez utilisez toutes les variantes (nommÃ©es tag) derriÃ¨re le caractÃ¨re "+". Ainsi <code>homeserver+nospam@example.com</code> sera bien redirigÃ© vers votre boite et l&#8217;extension <code>+nospam</code> vous permettre de trier automatiquement les mails que vous ne voulez pas recevoir.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est possible de changer ce caractÃ¨re spÃ©cial en le modifiant dans le fichier <code>/etc/postfix/main.cf</code> sur la ligne commenÃ§ant par <code>recipient_delimiter</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_manuelle_de_mariadb">9.2. Configuration manuelle de MariaDB</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>SÃ©curisez votre installation MariaDB. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql_secure_installation</code></pre>
</div>
</div>
<div class="paragraph">
<p>RÃ©pondez au questions ainsi:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Enter current password for root</code>: &#8592; Tapez EntrÃ©e</p>
</li>
<li>
<p><code>Set root password? [Y/n]</code>: &#8592; Tapez <code>Y</code></p>
</li>
<li>
<p><code>New password:</code>: &#8592; Tapez votre mot de passe root MariaDB</p>
</li>
<li>
<p><code>Re-enter New password:</code>: &#8592; Tapez votre mot de passe root MariaDB</p>
</li>
<li>
<p><code>Remove anonymous users? [Y/n]</code>: &#8592; Tapez <code>Y</code></p>
</li>
<li>
<p><code>Disallow root login remotely? [Y/n]</code>: &#8592; Tapez <code>Y</code></p>
</li>
<li>
<p><code>Remove test database and access to it? [Y/n]</code>: &#8592; Tapez <code>Y</code></p>
</li>
<li>
<p><code>Reload privilege tables now? [Y/n]</code>: &#8592; Tapez <code>Y</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>MariaDB doit pouvoir Ãªtre atteint par toutes les interfaces et pas seulement localhost.</p>
</li>
<li>
<p>Ãditez le fichier de configuration. :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/mysql/mariadb.conf.d/50-server.cnf</code></pre>
</div>
</div>
</li>
<li>
<p>Commentez la ligne <code>bind-address</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#bind-address           = 127.0.0.1</span></code></pre>
</div>
</div>
</li>
<li>
<p>Modifiez la mÃ©thode d&#8217;accÃ¨s Ã  la base MariaDB pour utiliser la mÃ©thode de login native.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"update mysql.user set plugin = 'mysql_native_password' where user='root';"</span> | mysql <span class="nt">-u</span> root</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Editez le fichier debian.cnf. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/mysql/debian.cnf</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aux deux endroits du fichier ou le mot clÃ© <code>password</code> est prÃ©sent, mettez le mot de passe root de votre base de donnÃ©es.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="py">password</span> <span class="p">=</span> <span class="s">votre_mot_de_passe</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dans les versions rÃ©centes de Debian et Ubuntu, le mot clÃ© password n&#8217;est pas prÃ©sent. Il n&#8217;y a rien Ã  faire.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Pour Ã©viter l&#8217;erreur <code>Error in accept: Too many open files</code>, augmenter la limite du nombre de fichiers ouverts.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Editer le fichier: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/security/limits.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez Ã  la fin du fichier les deux lignes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql soft nofile 65535
mysql hard nofile 65535</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un nouveau rÃ©pertoire. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/systemd/system/mysql.service.d/</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Editer le fichier limits.conf. :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/mysql.service.d/limits.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre>[Service]
LimitNOFILE=infinity</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>RedÃ©marrez votre serveur MariaDB. Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl daemon-reload
systemctl restart mariadb</code></pre>
</div>
</div>
</li>
<li>
<p>vÃ©rifiez maintenant que MariaDB est accessible sur toutes les interfaces rÃ©seau. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">netstat <span class="nt">-tap</span> | <span class="nb">grep </span>mysql</code></pre>
</div>
</div>
</li>
<li>
<p>La sortie doit Ãªtre du type:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>tcp        0      0 0.0.0.0:mysql  0.0.0.0:*  LISTEN  1146/mariadbd
tcp6       0      0    [::]:mysql     [::]:*  LISTEN  1146/mariadbd</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_manuelle_dapache">9.3. Configuration manuelle d&#8217;Apache</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez les modules Apache nÃ©cessaires. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2enmod suexec rewrite ssl proxy_http actions include dav_fs dav auth_digest cgi headers actions proxy_fcgi <span class="nb">alias </span>speling</code></pre>
</div>
</div>
</li>
<li>
<p>Pour ne pas Ãªtre confrontÃ© aux problÃ¨mes de sÃ©curitÃ©  de type <a href="https://www.howtoforge.com/tutorial/httpoxy-protect-your-server/">HTTPOXY</a>, il est nÃ©cessaire de crÃ©er un petit module dans apache.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ãditez le fichier <code>httpoxy.conf</code> :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apache2/conf-available/httpoxy.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Collez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_headers.c</span><span class="p">&gt;
</span>    <span class="nc">RequestHeader</span> <span class="ss">unset</span> <span class="ss">Proxy</span> <span class="ss">early</span>
<span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Activez le module en tapant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2enconf httpoxy
systemctl restart apache2</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©sactiver la documentation apache en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2disconf apache2-doc
systemctl restart apache2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_manuelle_d_awstats">9.4. Configuration manuelle d' Awstats</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Configurer la tache cron d&#8217;awstats: Ãditez le fichier :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/cron.d/awstats</code></pre>
</div>
</div>
</li>
<li>
<p>Et commentez toutes les lignes:</p>
<div class="listingblock">
<div class="content">
<pre>#MAILTO=root
#*/10 * * * * www-data [ -x /usr/share/awstats/tools/update.sh ] &amp;&amp; /usr/share/awstats/tools/update.sh
# Generate static reports:
#10 03 * * * www-data [ -x /usr/share/awstats/tools/buildstatic.sh ] &amp;&amp; /usr/share/awstats/tools/buildstatic.sh</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_manuelle_de_fail2ban">9.5. Configuration manuelle de Fail2ban</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier jail.local :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/fail2ban/jail.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ajoutez les lignes suivantes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[pure-ftpd]</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">port</span> <span class="p">=</span> <span class="s">ftp</span>
<span class="py">filter</span> <span class="p">=</span> <span class="s">pure-ftpd</span>
<span class="py">logpath</span> <span class="p">=</span> <span class="s">/var/log/syslog</span>
<span class="py">maxretry</span> <span class="p">=</span> <span class="s">3</span>


<span class="nn">[dovecot]</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">filter</span> <span class="p">=</span> <span class="s">dovecot</span>
<span class="py">logpath</span> <span class="p">=</span> <span class="s">/var/log/mail.log</span>
<span class="py">maxretry</span> <span class="p">=</span> <span class="s">5</span>

<span class="nn">[postfix-sasl]</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">port</span> <span class="p">=</span> <span class="s">smtp</span>
<span class="py">filter</span> <span class="p">=</span> <span class="s">postfix[mode=auth]</span>
<span class="py">logpath</span> <span class="p">=</span> <span class="s">/var/log/mail.log</span>
<span class="py">maxretry</span> <span class="p">=</span> <span class="s">3</span></code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez Fail2ban: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart fail2ban</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_manuelle_de_pureftpd">9.6. Installation et configuration manuelle de PureFTPd</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>pure-ftpd-common pure-ftpd-mysql</code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez le fichier de conf: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/default/pure-ftpd-common</code></pre>
</div>
</div>
</li>
<li>
<p>Changez les lignes ainsi:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="py">STANDALONE_OR_INETD</span><span class="p">=</span><span class="s">standalone</span>
<span class="py">VIRTUALCHROOT</span><span class="p">=</span><span class="s">true</span></code></pre>
</div>
</div>
</li>
<li>
<p>Autorisez les connexions TLS. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo </span>1 <span class="o">&gt;</span> /etc/pure-ftpd/conf/TLS</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez un certificat SSL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/ssl/private/</code></pre>
</div>
</div>
</li>
<li>
<p>Puis crÃ©ez le certificat auto signÃ©. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openssl req <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 7300 <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> /etc/ssl/private/pure-ftpd.pem <span class="nt">-out</span> /etc/ssl/private/pure-ftpd.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>et rÃ©pondez aux questions de la maniÃ¨re suivante:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>Country Name (2 letter code) [AU]:</code> &#8592; Entrez le code pays Ã  2 lettres</p>
</li>
<li>
<p><code>State or Province Name (full name) [Some-State]:</code> &#8592; Entrer le nom d&#8217;Ã©tat</p>
</li>
<li>
<p><code>Locality Name (eg, city) []:</code> &#8592; Entrer votre ville</p>
</li>
<li>
<p><code>Organization Name (eg, company) [Internet Widgits Pty Ltd]:</code> &#8592; Entrez votre entreprise ou tapez entrÃ©e</p>
</li>
<li>
<p><code>Organizational Unit Name (eg, section) []:</code> &#8592; Tapez entrÃ©e</p>
</li>
<li>
<p><code>Common Name (e.g. server FQDN or YOUR name) []:</code> &#8592; Enter le nom d&#8217;hÃ´te de votre serveur. Dans notre cas: <code>server1.example.com</code></p>
</li>
<li>
<p><code>Email Address []:</code> &#8592; Tapez entrÃ©e</p>
</li>
</ol>
</div>
</li>
<li>
<p>Puis tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>600 /etc/ssl/private/pure-ftpd.pem</code></pre>
</div>
</div>
</li>
<li>
<p>et redÃ©marrez pure-ftpd en tapant: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart pure-ftpd-mysql</code></pre>
</div>
</div>
</li>
<li>
<p>En Option: Activer les quotas si votre kernel le permet.</p>
<div class="ulist">
<ul>
<li>
<p>Installez les paquets de gestion des quotas. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>quota quotatool</code></pre>
</div>
</div>
</li>
<li>
<p>Editez <code>fstab</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/fstab</code></pre>
</div>
</div>
</li>
<li>
<p>Inserez le texte ci dessous pour chaque directive de montage autre que <code>/proc</code> ou <code>/swapfile</code> :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>usrjquota=quota.user,grpjquota=quota.group,jqfmt=vfsv0</code></pre>
</div>
</div>
</li>
<li>
<p>Par exemple pour une ligne de la table contenant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>UUID=45576b38-39e8-4994-b8c1-ea4870e2e614 / ext4 errors=remount-ro  0 1</code></pre>
</div>
</div>
</li>
<li>
<p>Vous obtiendrez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>UUID=45576b38-39e8-4994-b8c1-ea4870e2e614 / ext4 errors=remount-ro,usrjquota=quota.user,grpjquota=quota.group,jqfmt=vfsv0 0 1</code></pre>
</div>
</div>
</li>
<li>
<p>Pour une Raspbian:</p>
<div class="ulist">
<ul>
<li>
<p>Editez le fichier rc.local pour crÃ©er /dev/root Ã  chaque reboot:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">ln</span> <span class="nt">-s</span> /dev/mmblk0p7 /dev/root
vi /etc/rc.local</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez avant <code>exit 0</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ln -s /dev/mmcblk0p7 /dev/root</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Pour activer les quotas, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mount <span class="nt">-o</span> remount /
quotacheck <span class="nt">-avugm</span>
quotaon <span class="nt">-avug</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_manuelle_de_phpmyadmin">9.7. Installation et configuration manuelle de Phpmyadmin</h3>
<div class="sect3">
<h4 id="_installation_de_phpmyadmin">9.7.1. Installation de Phpmyadmin</h4>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://www.phpmyadmin.net/downloads/">phpMyAdmin</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil.</p>
</li>
<li>
<p>Installez phpmyadmin. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> /usr/share/phpmyadmin
<span class="nb">mkdir</span> /etc/phpmyadmin
<span class="nb">mkdir</span> <span class="nt">-p</span> /var/lib/phpmyadmin/tmp
<span class="nb">chown</span> <span class="nt">-R</span> www-data:www-data /var/lib/phpmyadmin
<span class="nb">touch</span> /etc/phpmyadmin/htpasswd.setup
<span class="nb">cd</span> /tmp
<span class="nv">version</span><span class="o">=</span><span class="sb">`</span>wget <span class="nt">-O</span> - https://www.phpmyadmin.net/home_page/version.txt 2&gt; /dev/null | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="sb">`</span>
<span class="nb">echo </span>https://files.phpmyadmin.net/phpMyAdmin/#/phpMyAdmin-#-all-languages.tar.gz | <span class="nb">sed</span> <span class="s1">'s/#/'</span><span class="nv">$version</span><span class="s1">'/g'</span> | xargs wget <span class="nt">-O</span> phpmyadmin.tar.gz
<span class="nb">tar </span>xfz phpmyadmin.tar.gz
<span class="nb">mv </span>phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>/<span class="k">*</span> /usr/share/phpmyadmin/
<span class="nb">rm </span>phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>.tar.gz
<span class="nb">rm</span> <span class="nt">-rf</span> phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>
<span class="nb">cp</span> /usr/share/phpmyadmin/config.sample.inc.php  /usr/share/phpmyadmin/config.inc.php</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez votre chaÃ®ne alÃ©atoire en base64. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">tr</span> <span class="nt">-dc</span> A-Za-z0-9 &lt; /dev/urandom | <span class="nb">head</span> <span class="nt">-c</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">32</span><span class="k">}</span><span class="p">;</span><span class="nb">echo</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Copiez le texte gÃ©nÃ©rÃ©</p>
</li>
<li>
<p>Ãditez le fichier :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/share/phpmyadmin/config.inc.php</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Modifier lâentrÃ©e <code>blowfish_secret</code> en ajoutant votre propre chaÃ®ne de 32 caractÃ¨res gÃ©nÃ©rÃ©e juste avant.</p>
</li>
<li>
<p>Ãditez le fichier: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apache2/conf-available/phpmyadmin.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="c"># phpMyAdmin default Apache configuration</span>

<span class="nc">Alias</span> /phpmyadmin /usr/share/phpmyadmin

<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/share/phpmyadmin</span><span class="p">&gt;
</span>        <span class="nc">Options</span> <span class="ss">SymLinksIfOwnerMatch</span>
        <span class="nc">DirectoryIndex</span> index.php

        <span class="c"># limit libapache2-mod-php to files and directories necessary by pma</span>
        <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_php7.c</span><span class="p">&gt;
</span>                php_admin_value upload_tmp_dir /var/lib/phpmyadmin/tmp
                php_admin_value open_basedir /usr/share/phpmyadmin/:/etc/phpmyadmin/:/var/lib/phpmyadmin/:/usr/share/php/:/usr/share/javascript/
        <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
</span>
        <span class="c"># PHP 8+</span>
        <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_php.c</span><span class="p">&gt;
</span>                php_admin_value upload_tmp_dir /var/lib/phpmyadmin/tmp
                php_admin_value open_basedir /usr/share/phpmyadmin/:/etc/phpmyadmin/:/var/lib/phpmyadmin/:/usr/share/php/:/usr/share/javascript/
        <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
</span>
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span>
<span class="c"># Authorize for setup</span>
<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/share/phpmyadmin/setup</span><span class="p">&gt;
</span>        <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_authz_core.c</span><span class="p">&gt;
</span>                <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_authn_file.c</span><span class="p">&gt;
</span>                        <span class="nc">AuthType</span> <span class="ss">Basic</span>
                        <span class="nc">AuthName</span> "phpMyAdmin Setup"
                        <span class="nc">AuthUserFile</span> /etc/phpmyadmin/htpasswd.setup
                <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
</span>                <span class="nc">Require</span> valid-user
        <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span>
<span class="c"># Disallow web access to directories that don't need it</span>
<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/share/phpmyadmin/templates</span><span class="p">&gt;
</span>        <span class="nc">Require</span> <span class="ss">all</span> denied
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/share/phpmyadmin/libraries</span><span class="p">&gt;
</span>        <span class="nc">Require</span> <span class="ss">all</span> denied
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/share/phpmyadmin/setup/lib</span><span class="p">&gt;
</span>        <span class="nc">Require</span> <span class="ss">all</span> denied
<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Activez le module et redÃ©marrez apache. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2enconf phpmyadmin
systemctl restart apache2</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©er la base de donnÃ©e phpmyadmin.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql <span class="nt">-u</span> root <span class="nt">-p</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>puis entrer le mot de passe root</p>
</div>
</li>
<li>
<p>CrÃ©ez une base phpmyadmin. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">phpmyadmin</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez un utilisateur phpmyadmin. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">'pma'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'mypassword'</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>mypassword</code> doit Ãªtre remplacÃ© par <a href="#pass_gen">un mot de passe choisi.</a></td>
</tr>
</table>
</div>
</li>
<li>
<p>Accordez des privilÃ¨ges et sauvez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">phpmyadmin</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'pma'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'mypassword'</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>mypassword</code> doit Ãªtre remplacÃ© par le mot de passe choisi plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Flusher les privilÃ¨ges:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>et enfin</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">EXIT</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Chargez les tables sql dans la base phpmyadmin:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql <span class="nt">-u</span> root <span class="nt">-p</span> phpmyadmin &lt; /usr/share/phpmyadmin/sql/create_tables.sql</code></pre>
</div>
</div>
</li>
<li>
<p>Enfin ajoutez les mots de passe nÃ©cessaires dans le fichier de config.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/share/phpmyadmin/config.inc.php</code></pre>
</div>
</div>
</li>
<li>
<p>Rechercher le texte contenant <code>controlpass</code> .  Ci-dessous, un exemple:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="cm">/* User used to manipulate with storage */</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'controlhost'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'controlport'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'controluser'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'pma'</span><span class="p">;</span>
<span class="nv">$cfg</span><span class="p">[</span><span class="s1">'Servers'</span><span class="p">][</span><span class="nv">$i</span><span class="p">][</span><span class="s1">'controlpass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'mypassword'</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A tous les endroit ou vous voyez dans le texte ci dessus le mot <code>mypassword</code> mettez celui choisi. N&#8217;oubliez pas de dÃ©-commenter les lignes.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_upgrade_de_phpmyadmin">9.7.2. Upgrade de Phpmyadmin</h4>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://www.phpmyadmin.net/downloads/">phpMyAdmin</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil.</p>
</li>
<li>
<p>Mettez Ã  jour phpmyadmin. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mv</span> /usr/share/phpmyadmin /usr/share/phpmyadmin.old
<span class="nb">mkdir</span> /usr/share/phpmyadmin
<span class="nb">cd</span> /tmp
<span class="nv">version</span><span class="o">=</span><span class="sb">`</span>wget <span class="nt">-O</span> - https://www.phpmyadmin.net/home_page/version.txt 2&gt; /dev/null | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="sb">`</span>
<span class="nb">echo </span>https://files.phpmyadmin.net/phpMyAdmin/#/phpMyAdmin-#-all-languages.tar.gz | <span class="nb">sed</span> <span class="s1">'s/#/'</span><span class="nv">$version</span><span class="s1">'/g'</span> | xargs wget <span class="nt">-O</span> phpmyadmin.tar.gz
<span class="nb">tar </span>xfz phpmyadmin.tar.gz
<span class="nb">mv </span>phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>/<span class="k">*</span> /usr/share/phpmyadmin/
<span class="nb">rm </span>phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>.tar.gz
<span class="nb">rm</span> <span class="nt">-rf</span> phpMyAdmin-<span class="nv">$version</span><span class="nt">-all-languages</span>
<span class="nb">cp</span> /usr/share/phpmyadmin.old/config.inc.php  /usr/share/phpmyadmin/config.inc.php</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez apache. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart apache2</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne correctement sur le site phpmyadmin</p>
</li>
<li>
<p>Supprimez l&#8217;ancien rÃ©pertoire</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">rm</span> <span class="nt">-rf</span> /usr/share/phpmyadmin.old</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_manuelle_du_webmail_roundcube">9.8. Installation manuelle du webmail Roundcube</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>roundcube roundcube-core roundcube-mysql roundcube-plugins</code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©pondez aux question</p>
<div class="ulist">
<ul>
<li>
<p><code>Utiliser dbconfig_common</code> &#8592; RÃ©pondre <code>Oui</code></p>
</li>
<li>
<p><code>Mot de passe Mysql pour db Roundcube</code> &#8592; Tapez un mot de passe</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ãditez le fichier php de roundcube :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/roundcube/config.inc.php</code></pre>
</div>
</div>
</li>
<li>
<p>Et chercher les Ã©lÃ©ments de $config si dessous, et s&#8217;ils sont trouvÃ©s, remplacez les par les valeurs indiquÃ©es :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="nv">$config</span><span class="p">[</span><span class="s1">'default_host'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">'smtp_server'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">'imap_host'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"localhost:143"</span><span class="p">];</span>
<span class="nv">$config</span><span class="p">[</span><span class="s1">'smtp_host'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'localhost:25'</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ãditez la configuration apache pour roundcube: :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apache2/conf-enabled/roundcube.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>et ajouter au dÃ©but les lignes suivantes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="nc">Alias</span> /roundcube /var/lib/roundcube/public_html
<span class="nc">Alias</span> /webmail /var/lib/roundcube/public_html</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez Apache:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl reload apache2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_manuelle_de_lets_encrypt">9.9. Installation manuelle de Let&#8217;s Encrypt</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez Let&#8217;s Encrypt. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp <span class="p">;</span> wget <span class="nt">-O</span> -  https://get.acme.sh 2&gt;/dev/null | sh 2&gt;/dev/null</code></pre>
</div>
</div>
</li>
<li>
<p>Une faÃ§on alternative de l&#8217;installer est:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>certbot</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="After_manual_install">10. Suite de l&#8217;installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les chapitres suivants doivent Ãªtre suivis que ISPConfig soit installÃ© ou pas.</p>
</div>
<div class="sect2">
<h3 id="firewall">10.1. DÃ©blocage de port de firewall</h3>
<div class="paragraph">
<p>Par dÃ©faut, une fois le firewall activÃ©, TOUS les ports sont bloquÃ©s en entrÃ©e de votre Ã©quipement. Cela veut dire qu&#8217;il ne sera pas possible de connecter une machine externe sur votre Ã©quipement sans avoir effectuÃ© une opÃ©ration de dÃ©blocage du port du firewall.</p>
</div>
<div class="paragraph">
<p>Il existe deux maniÃ¨re de dÃ©bloquer un port. Elle dÃ©pend de ce que vous avez configurÃ©.</p>
</div>
<div class="sect3">
<h4 id="_dÃ©blocage_et_suppression_de_rÃ¨gles_de_firewall_avec_ispconfig">10.1.1. DÃ©blocage et suppression de rÃ¨gles de Firewall avec ISPconfig</h4>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes pour DÃ©bloquez le firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez sur le site ispconfig <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a></p>
</li>
<li>
<p>Loguez-vous et cliquez sur la rubrique <code>System</code> et le menu <code>Firewall</code>. Cliquez sur votre serveur.</p>
</li>
<li>
<p>dans la rubrique <code>Open TCP ports:</code>, ajoutez le numero de port xxxx que vous souhaitez dÃ©bloquer</p>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes bloquer (en lever une rÃ¨gle de dÃ©blocage) de firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez sur le site ispconfig <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a></p>
</li>
<li>
<p>Loguez-vous et cliquez sur la rubrique <code>System</code> et le menu <code>Firewall</code>. Cliquez sur votre serveur.</p>
</li>
<li>
<p>dans la rubrique <code>Open TCP ports:</code>, Supprimer le port xxxx</p>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remarque: si vous utilisez VNC, il faut dÃ©bloquer le port dans le firewall de ISPConfig. Appliquez la mÃ©thode de dÃ©blocage pour le port 5900.</p>
</div>
<div class="paragraph">
<p>Remarque: si vous avez besoin de dÃ©bloquer un port UDP vous devez allez dans la rubrique Open UDP Ports.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dÃ©blocage_de_firewall_ufw">10.1.2. DÃ©blocage de Firewall UFW</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Si vous avez installÃ© ISPconfig vous ne devez pas utiliser cette mÃ©thode !
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tout d&#8217;abord, Ã  la premiÃ¨re utilisation, il vous faut appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installez <code>ufw</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>ufw</code></pre>
</div>
</div>
</li>
<li>
<p>Autorisez SSH si vous ne voulez pas perdre votre connexion SSH Ã  l&#8217;activation du  firewall. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw allow 5900/tcp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cette ligne autorise VNC et est utile si vous utilisez ce protocole sur votre SystÃ¨me. Il est fortement dÃ©conseillÃ© pour un serveur visible sur internet d&#8217;autoriser ce protocole.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Activez le firewall. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw <span class="nb">enable</span></code></pre>
</div>
</div>
</li>
<li>
<p>C&#8217;est prÃªt !</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes pour DÃ©bloquez le firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw allow xxxx/tcp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez xxxx par le numero de port que vous souhaitez dÃ©bloquer</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes bloquer (en lever une rÃ¨gle de dÃ©blocage) de firewall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ufw delete allow xxxx/tcp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez xxxx par le numero de port que vous souhaitez dÃ©bloquer</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scan_des_vulnÃ©rabilitÃ©s">10.2. Scan des vulnÃ©rabilitÃ©s</h3>
<div class="sect3">
<h4 id="_installation_dun_scanner_de_vulnÃ©rabilitÃ©s_lynis">10.2.1. Installation d&#8217;un scanner de vulnÃ©rabilitÃ©s Lynis</h4>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>installer Git. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>git</code></pre>
</div>
</div>
</li>
<li>
<p>installer Lynis</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
</span>git clone https://github.com/CISOfy/lynis</code></pre>
</div>
</div>
</li>
<li>
<p>Executez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>lynis<span class="p">;</span>./lynis audit system</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>L&#8217;outil vous listera dans une forme trÃ¨s synthÃ©tique la liste des vulnÃ©rabilitÃ©s et des amÃ©liorations de sÃ©curitÃ© Ã  appliquer.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_upgrade_de_lynis">10.2.2. Upgrade de Lynis</h4>
<div class="paragraph">
<p>Pour effectuer la mise Ã  jour de Lynis appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
cd </span>lynis
git pull</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_systÃ¨me_dadministration_webmin">10.3. Installation du systÃ¨me d&#8217;administration Webmin</h3>
<div class="paragraph">
<p>Webmin est un outil gÃ©nÃ©raliste de configuration de votre serveur. Son usage peut Ãªtre assez complexe mais il permet une configuration plus prÃ©cise des fonctionnalitÃ©s.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Lancez le script de configuration de webmin:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-o</span> setup-repos.sh https://raw.githubusercontent.com/webmin/webmin/master/setup-repos.sh
sh setup-repos.sh
<span class="nb">rm </span>setup-repos.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Mise Ã  jour. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Installation de Webmin. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>webmin</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 10000 sur votre firewall</a></p>
</li>
<li>
<p>Changer le nom du user admin</p>
</li>
<li>
<p>Editez le fichier <code>miniserv.users</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/webmin/miniserv.users</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier remplacer le texte <code>root</code> par le nom de votre &lt;sudo_username&gt;.</p>
</li>
<li>
<p>De la mÃªme maniÃ¨re, Ã©diter le fichier <code>webmin.acl</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/webmin/webmin.acl</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier remplacer le texte <code>root</code> par le nom de votre &lt;sudo_username&gt;.</p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service webmin restart</code></pre>
</div>
</div>
</li>
<li>
<p>Connectez vous avec votre navigateur sur l&#8217;url <a href="https://&lt;example.com&gt;:10000" class="bare">https://&lt;example.com&gt;:10000</a>. Un message indique un problÃ¨me de sÃ©curitÃ©. Cela vient du certificat auto-signÃ©. Cliquez sur 'AvancÃ©' puis 'Accepter le risque et poursuivre'.</p>
</li>
<li>
<p>Loguez-vous &lt;sudo_username&gt;. Tapez le mot de passe de <code>&lt;sudo_username&gt;</code>. Le dashboard s&#8217;affiche.</p>
</li>
<li>
<p>Restreignez l&#8217;adressage IP</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Obtenez votre adresse IP en allant par exemples sur le site <a href="https://www.showmyip.com/" class="bare">https://www.showmyip.com/</a></p>
</li>
<li>
<p>Sur votre URL Webmin ou vous Ãªtes loguÃ©, allez dans Webmin&#8594;Webmin Configuration</p>
</li>
<li>
<p>Dans l&#8217;Ã©cran choisir lâicÃ´ne <code>Ip Access Control</code>.</p>
</li>
<li>
<p>Choisissez <code>Only allow from listed addresses</code></p>
</li>
<li>
<p>Puis dans le champ <code>Allowed IP addresses</code> tapez votre adresse IP rÃ©cupÃ©rÃ©e sur showmyip</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>Vous devriez avoir une brÃ¨ve dÃ©connexion le temps que le serveur Webmin redÃ©marre puis une reconnexion.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Si vous n&#8217;arrivez pas Ã  vous reconnecter c&#8217;est que l&#8217;adresse IP n&#8217;est pas la bonne. Le seul moyen de se reconnecter est de:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ãditez le fichier /etc/webmin/miniserv.conf et supprimez la ligne <code>allow= &#8230;&#8203;</code></p>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service webmin restart</code></pre>
</div>
</div>
</li>
<li>
<p>Connectez vous sur l&#8217;url de votre site Webmin. Tout doit fonctionner</p>
</li>
</ol>
</div>
</li>
<li>
<p>ComplÃ©ments de configuration</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pour augmenter la sÃ©curitÃ©, vous pouvez dÃ©sactiver le login <code>sudo_username</code> et crÃ©er un autre compte admin en allant dans: <code>Webmin</code> &#8594; <code>Webmin Users</code> &#8594; <code>Create a new privileged user</code>. Pour le user <code>sudo_username</code>, modifier le <code>Password</code> en mettant <code>No password accepted</code></p>
</li>
<li>
<p>Allez dans <code>Webmin</code> &#8594; <code>Webmin Configuration</code> &#8594; <code>SSL Encryption</code> &#8594; onglet <code>Let&#8217;s Encrypt</code> &#8594; <code>Request Certificate</code>. Attention cette opÃ©ration ne fonctionne que si le serveur est disponible sur internet.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Passez en FranÃ§ais. Pour les personnes non anglophone. Les traductions franÃ§aise ont des problÃ¨mes d&#8217;encodage de caractÃ¨re ce n&#8217;est donc pas recommandÃ©. La suite de mon tutoriel suppose que vous Ãªtes restÃ© en anglais.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Sur votre url Webmin ou vous Ãªtes loguÃ©, allez dans Webmin&#8594;Webmin Configuration</p>
</li>
<li>
<p>Dans l&#8217;Ã©cran choisir lâicÃ´ne <code>Language and Locale</code>.</p>
</li>
<li>
<p>Choisir <code>Display Language</code> Ã  <code>French (FR.UTF-8)</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domain-config">11. Configuration d&#8217;un domaine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cette configuration est rÃ©alisÃ©e avec le Panel ISPConfig installÃ© dans le chapitre prÃ©cÃ©dent.
L&#8217;Ã©tape "login initial" n&#8217;est Ã  appliquer qu&#8217;une seule fois. Une fois votre premier domaine configurÃ©, vous pourrez vous loguer Ã  ISPconfig en utilisant ce domaine Ã  l&#8217;adresse: <a href="https://example.com:8080/" class="bare">https://example.com:8080/</a> .</p>
</div>
<div class="sect2">
<h3 id="_login_initial">11.1. Login initial</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Cette procÃ©dure n&#8217;est Ã  appliquer que lorsqu&#8217;aucun domaine n&#8217;est encore crÃ©Ã©.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vous devrez tout d&#8217;abord vous loguer sur le serveur ISPConfig.
Comme vous n&#8217;avez pas encore configurÃ© de nom de de domaine, vous devrez vous loguer de prime abord sur le site <a href="http://vmixxxxx.contaboserver.net:8080/" class="bare">http://vmixxxxx.contaboserver.net:8080/</a> pour un vps chez contabo par exemple ou sur <a href="http://raspberrypi.local:8080/" class="bare">http://raspberrypi.local:8080/</a> pour un Raspberry.</p>
</div>
<div class="paragraph">
<p>Utiliser le login: Admin et le mot de passe que vous avez configurÃ© lors de l&#8217;installation d&#8217;ISPConfig</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aller dans la rubrique <code>System</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Dans le menu <code>Main config</code></p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Dans lâonglet <code>Sites</code>, configurer:</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p><code>Create subdomains as web site:</code> &#8592; Yes</p>
</li>
<li>
<p><code>Create aliasdomains as web site:</code> &#8592; Yes</p>
</li>
</ol>
</div>
</li>
<li>
<p>Dans l&#8217;onglet <code>Mail</code>Â :</p>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p><code>Administrator&#8217;s e-mail :</code> &#8592; adresse mail de lâadministrateur. par exemple <a href="mailto:admin@example.com">admin@example.com</a></p>
</li>
<li>
<p><code>Administrator&#8217;s name :</code> &#8592; nom de lâadministrateur</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Dans le menu <code>Firewall</code></p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add Firewall Record</code></p>
</li>
<li>
<p>Acceptez les valeurs par dÃ©faut en cliquant sur <code>Save</code></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est possible de basculer le site ISPConfig entiÃ¨rement en FranÃ§ais. J&#8217;ai pour ma part gardÃ© la version anglaise du site.
Vous trouverez donc tous les libellÃ©s dans la suite de la documentation en anglais.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Aller dans la rubrique <code>DNS</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Dans le menu <code>Templates</code></p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new record</code></p>
</li>
<li>
<p>Remplissez les champs comme ci-aprÃ¨s:</p>
<div class="ulist">
<ul>
<li>
<p><code>Name</code> &#8592; Tapez <code>Template IPV4 autoNS</code></p>
</li>
<li>
<p><code>Fields</code> &#8592; Cochez <code>Domain</code>, <code>IP Address</code>, <code>Email</code>, <code>DKIM</code>, <code>DNSSEC</code></p>
</li>
<li>
<p><code>Template</code> &#8592; remplissez comme ci dessous:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">[</span>ZONE]
<span class="nv">origin</span><span class="o">={</span>DOMAIN<span class="o">}</span><span class="nb">.</span>
<span class="nv">ns</span><span class="o">=</span>ns1.<span class="o">{</span>DOMAIN<span class="o">}</span><span class="nb">.</span>
<span class="nv">mbox</span><span class="o">={</span>EMAIL<span class="o">}</span><span class="nb">.</span>
<span class="nv">refresh</span><span class="o">=</span>7200
<span class="nv">retry</span><span class="o">=</span>540
<span class="nv">expire</span><span class="o">=</span>604800
<span class="nv">minimum</span><span class="o">=</span>3600
<span class="nv">ttl</span><span class="o">=</span>3600
<span class="nv">xfer</span><span class="o">=</span>
<span class="nv">also_notify</span><span class="o">=</span>
<span class="nv">dnssec_wanted</span><span class="o">=</span>N
<span class="nv">dnssec_algo</span><span class="o">=</span>ECDSAP256SHA256

<span class="o">[</span>DNS_RECORDS]
A|<span class="o">{</span>DOMAIN<span class="o">}</span>.|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|www|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|mail|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|autoconfig|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|autodiscover|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|webmail|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|ns1|<span class="o">{</span>IP<span class="o">}</span>|0|3600
CNAME|ftp|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|smtp|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|pop3|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|imap|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_pop3._tcp|0 0 .|0|3600
SRV|_imap._tcp|0 0 .|0|3600
SRV|_pop3s._tcp|1 995 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_imaps._tcp|1 993 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_submission._tcp|1 465 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_autodiscover._tcp|1 443 autodiscover.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
NS|<span class="o">{</span>DOMAIN<span class="o">}</span>.|ns1.<span class="o">{</span>DOMAIN<span class="o">}</span>.|0|3600
MX|<span class="o">{</span>DOMAIN<span class="o">}</span>.|mail.<span class="o">{</span>DOMAIN<span class="o">}</span>.|10|3600
TXT|<span class="o">{</span>DOMAIN<span class="o">}</span>.|v<span class="o">=</span>spf1 mx a ~all|0|3600</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new record</code></p>
</li>
<li>
<p>Remplissez les champs comme ci-aprÃ¨s:</p>
<div class="ulist">
<ul>
<li>
<p><code>Name</code> &#8592; Tapez <code>Template IPV6 autoNS</code></p>
</li>
<li>
<p><code>Fields</code> &#8592; Cochez <code>Domain</code>, <code>IP Address</code>, <code>IPV6 Address</code>, <code>Email</code>, <code>DKIM</code>, <code>DNSSEC</code></p>
</li>
<li>
<p><code>Template</code> &#8592; remplissez comme ci dessous:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">[</span>ZONE]
<span class="nv">origin</span><span class="o">={</span>DOMAIN<span class="o">}</span><span class="nb">.</span>
<span class="nv">ns</span><span class="o">=</span>ns1.<span class="o">{</span>DOMAIN<span class="o">}</span><span class="nb">.</span>
<span class="nv">mbox</span><span class="o">={</span>EMAIL<span class="o">}</span><span class="nb">.</span>
<span class="nv">refresh</span><span class="o">=</span>7200
<span class="nv">retry</span><span class="o">=</span>540
<span class="nv">expire</span><span class="o">=</span>604800
<span class="nv">minimum</span><span class="o">=</span>3600
<span class="nv">ttl</span><span class="o">=</span>3600
<span class="nv">xfer</span><span class="o">=</span>
<span class="nv">also_notify</span><span class="o">=</span>
<span class="nv">dnssec_wanted</span><span class="o">=</span>N
<span class="nv">dnssec_algo</span><span class="o">=</span>ECDSAP256SHA256

<span class="o">[</span>DNS_RECORDS]
A|<span class="o">{</span>DOMAIN<span class="o">}</span>.|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|www|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|mail|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|autoconfig|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|autodiscover|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|webmail|<span class="o">{</span>IP<span class="o">}</span>|0|3600
A|ns1|<span class="o">{</span>IP<span class="o">}</span>|0|3600
AAAA|<span class="o">{</span>DOMAIN<span class="o">}</span>.|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|www|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|mail|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|autoconfig|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|autodiscover|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|webmail|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
AAAA|ns1|<span class="o">{</span>IPV6<span class="o">}</span>|0|3600
CNAME|ftp|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|smtp|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|pop3|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
CNAME|imap|<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_pop3._tcp|0 0 .|0|3600
SRV|_imap._tcp|0 0 .|0|3600
SRV|_pop3s._tcp|1 995 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_imaps._tcp|1 993 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_submission._tcp|1 465 mail.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
SRV|_autodiscover._tcp|1 443 autodiscover.<span class="o">{</span>DOMAIN<span class="o">}</span>|0|3600
NS|<span class="o">{</span>DOMAIN<span class="o">}</span>.|ns1.<span class="o">{</span>DOMAIN<span class="o">}</span>.|0|3600
MX|<span class="o">{</span>DOMAIN<span class="o">}</span>.|mail.<span class="o">{</span>DOMAIN<span class="o">}</span>.|10|3600
TXT|<span class="o">{</span>DOMAIN<span class="o">}</span>.|v<span class="o">=</span>spf1 mx a ~all|0|3600</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_la_zone_dns_dun_domaine">11.2. CrÃ©ation de la zone DNS d&#8217;un domaine</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans <code>DNS</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>Add dns-zone</code></p>
</li>
<li>
<p>Cliquez sur <code>Dns zone wizard</code></p>
</li>
<li>
<p>Choisir le template <code>IPV4 autoNS</code> ou`IPV6 autoNS` selon que vous soyez IPV4 ou IPV4+V6</p>
</li>
<li>
<p>Remplissez les champs:</p>
<div class="ulist">
<ul>
<li>
<p><code>Domain :</code> &#8592; tapez le nom de votre domaine <code>example.com</code></p>
</li>
<li>
<p><code>IP Address:</code> &#8592; prendre lâadresse IPV4 du serveur sÃ©lectionnÃ©e</p>
</li>
<li>
<p><code>IPV6 Address:</code> &#8592; prendre lâadresse IPV6 du serveur sÃ©lectionnÃ©e</p>
</li>
<li>
<p><code>Email:</code> &#8592; votre Email valide exemple <code>admin@example.com</code></p>
</li>
<li>
<p><code>DKIM:</code> &#8592; Yes</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Si votre serveur est chez vous, il est probablement installÃ© derriÃ¨re un routeur ADSL configurÃ© au prÃ©alable avec une DMZ qui pointe sur ce serveur. Dans ce cas, vous ne devrez pas indiquer l&#8217;adresse IP locale de votre serveur mais l&#8217;adresse IP de votre routeur ADSL telle qu&#8217;elle est vue sur internet. On suppose aussi que cette adresse IP est statique et non pas allouÃ©e dynamiquement par l&#8217;opÃ©rateur.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Create DNS-record</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Attendez quelques minutes le temps que les enregistrements DNS se propagent et faites une essai de votre nom de domaine sur le site <a href="https://zonemaster.fr/domain_check">ZoneMaster</a>.</p>
</div>
<div class="paragraph">
<p>Dans le champ Nom de domaine saisissez votre nom de domaine et tapez sur check. Tout doit est OK sauf pour les serveurs de noms ns1 et ns2. Si ce n&#8217;est pas le cas, votre nom de domaine doit Ãªtre mal configurÃ© chez votre registrar. Il vous faut vÃ©rifier la configuration initiale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zonemaster a bien repÃ©rÃ© que l&#8217;on a essayÃ© de mettre des noms de host diffÃ©rents pour les serveurs de DNS. Ils ont cependant tous la mÃªme adresse IP. Cela apparait comme une erreur suite au test.
De la mÃªme maniÃ¨re, il indique dans la rubrique connectivitÃ© qu&#8217;il n&#8217;y a pas de redondance de serveur DNS.
Une maniÃ¨re de corriger ce problÃ¨me est de dÃ©finir un DNS secondaire chez OVH en utilisant le service qu&#8217;ils mettent Ã  disposition.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vous pouvez maintenant essayer les diffÃ©rents Hostname munis de leur nom de domaine dans votre navigateur. Par exemple: <a href="http://webmail.example.com" class="bare">http://webmail.example.com</a></p>
</div>
<div class="paragraph">
<p>Ils doivent afficher une page web basique (Apache2, ou de parking).Si ce n&#8217;est pas le cas revÃ©rifier la configuration du DNS dans ISPConfig.</p>
</div>
</div>
<div class="sect2">
<h3 id="_activation_de_dnssec">11.3. Activation de DNSSEC</h3>
<div class="paragraph">
<p>Vous pouvez maintenant activer DNSSEC afin d&#8217;augmenter la sÃ©curitÃ© de rÃ©solution de nom de domaine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>puis dans le menu <code>Zones</code></p>
</li>
<li>
<p>choisissez la zone correspondant Ã  votre domaine</p>
</li>
<li>
<p>dans l&#8217;onglet <code>Zones settings</code> allez tout en bas et activer la coche <code>Sign Zone (DNSSEC)</code></p>
</li>
<li>
<p>cliquez sur <code>Save</code></p>
</li>
<li>
<p>Une fois fait, retourner dans le mÃªme onglet. La boite `DNSSEC DS-Data for registry: `contient les informations que vous devez coller dans le site web de votre registrar pour sÃ©curiser votre zone.</p>
</li>
<li>
<p>Gardez cette fenÃªtre ouverte dans votre navigateur et ouvrez un autre onglet sur le site de votre registrar.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si vous Ãªtes chez <a href="https://admin.gandi.net/">Gandi</a>, il vous faut:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SÃ©lectionner le menu <code>nom de domaine</code></p>
</li>
<li>
<p>Choisir votre nom de domaine "example.com"</p>
</li>
<li>
<p>Allez dans l&#8217;onglet DNSSEC. Il doit permettre d&#8217;ajouter des clÃ©s puisque vous fonctionner avec des DNS externes.</p>
</li>
<li>
<p>Effacez Ã©ventuellement toutes les clÃ©s si vous n&#8217;Ãªtes pas sur de celles-ci.</p>
</li>
<li>
<p>puis cliquez sur <code>Ajouter une clÃ© externe</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>SÃ©lectionnez d&#8217;abord le flag <code>257 (KSK)</code>. puis l&#8217;algorithme <code>13 (ECDSAP256SHA256)</code></p>
</li>
<li>
<p>Collez ensuite la clÃ© de votre site ISPConfig. Elle doit ressembler Ã  cela:</p>
<div class="listingblock">
<div class="content">
<pre>example.com. IN DNSKEY 257 3 13 CGI4g4NzPkOXeuRzA1ZdBT7N5/WJ2su5Q6teGDjVeYq2kwnxbFsYJhjq QVcqDqm7gzFqPl6QC/zK1eC0zrPE9g==</pre>
</div>
</div>
</li>
<li>
<p>Cliquez sur <code>Ajouter</code></p>
</li>
<li>
<p>Entrez la deuxiÃ¨me clÃ©. Cliquez sur <code>Ajouter une clÃ© externe</code></p>
</li>
<li>
<p>SÃ©lectionnez d&#8217;abord le flag <code>256 (ZSK)</code>. puis l&#8217;algorithme <code>13 (ECDSAP256SHA256)</code></p>
</li>
<li>
<p>Collez ensuite la clÃ© de votre site ISPConfig. Elle doit ressembler Ã  cela:</p>
<div class="listingblock">
<div class="content">
<pre>example.com. IN DNSKEY 256 3 13 YFzB4DJmq0I7K6J17ynU4A+dracTW7qkrMnK5ZIbEO/DtjgJyDPaZn9f uvJ/KriFY/sdf89XHb4u8q+MQCm/cg==</pre>
</div>
</div>
</li>
<li>
<p>Cliquez sur <code>Ajouter</code></p>
</li>
<li>
<p>Les deux clÃ©s doivent maintenant apparaÃ®tre dans l&#8217;onglet <code>DNSSEC</code></p>
</li>
<li>
<p>Vous devez attendre quelques minutes (une heure dans certains cas) pour que les clÃ©s se propagent. Pendant ce temps vous pouvez avoir quelques problÃ¨mes d&#8217;accÃ¨s Ã  vos sites webs</p>
</li>
<li>
<p>Allez sur le site <a href="https://dnssec-debugger.verisignlabs.com/">DNSSEC Analyzer</a>.</p>
</li>
<li>
<p>Entrez votre nom de domaine "example.com" et tapez sur "entrÃ©e".</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le site doit afficher pour les diffÃ©rentes zones le statut des certificats. Tout doit Ãªtre au vert.
Si ce n&#8217;est pas le cas, rÃ©essayer dans une heure. S&#8217;il y a encore des problÃ¨mes vÃ©rifiez votre configuration dans ISPConfig, chez votre registrar (rubrique DNSSEC) ou regardez les logs d&#8217;ISPConfig sur votre serveur pour y dÃ©busquer une erreur.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Une erreur classique est de croiser les certificats avec leurs types. VÃ©rifiez bien que vous avez mis les bons certificats avec les bons types.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Une fois que vous activez DNSSEC, vous pourriez faire face au problÃ¨me suivant: les nouveaux enregistrements que vous renseignez ne sont pas actifs.
Une analyse des logs montre que la commande <code>dnssec-signzone</code> retourne l&#8217;erreur <code>fatal: 'example.com': found DS RRset without NS RRset</code>.
Cela signifie que vous avez saisi une ou deux entrÃ©es DS dans vos enregistrements. Il faut les supprimer pour que tout redevienne fonctionnel.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_exemple_de_configuration_de_domaine">11.4. Exemple de configuration de domaine</h3>
<div class="paragraph">
<p>Une fois la configuration terminÃ©, les diffÃ©rents enregistrements du domaines ressemblent Ã  l&#8217;exemple ci-dessous.
Il peut y avoir des enregistrements supplÃ©mentaires pour les configurations SPF, DKIM et Let&#8217;s encrypt.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>example.com.         3600 A              1.2.3.4
www                  3600 A              1.2.3.4
mail                 3600 A              1.2.3.4
ns1                  3600 A              1.2.3.4
ns2                  3600 A              1.2.3.4
webmail              3600 A              1.2.3.4
autoconfig           3600 A              1.2.3.4
autodiscover         3600 A              1.2.3.4
ftp                  3600 CNAME          example.com.
smtp                 3600 CNAME          mail.example.com.
pop3                 3600 CNAME          mail.example.com.
imap                 3600 CNAME          mail.example.com.
example.com.         3600 NS             ns1.example.com.
example.com.         3600 NS             ns2.example.com.
example.com.         3600 MX    10       mail.example.com.
_pop3s._tcp          3600 SRV   10 1 995 mail.example.com.
_imaps._tcp          3600 SRV   0  1 993 mail.example.com.
_submission._tcp     3600 SRV   0  1 465 mail.example.com.
_imap._tcp           3600 SRV   0  0 0   .
_pop3._tcp           3600 SRV   0  0 0   .
_autodiscover._tcp   3600 SRV   0 0 443  autoconfig.example.com.
example.com.         3600 TXT            "v=spf1 mx a ~all"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dun_sous_domaine">11.5. CrÃ©ation d&#8217;un sous domaine</h3>
<div class="paragraph">
<p>Supposons que vous Ãªtes en train de crÃ©er un sous domain nommÃ© <code>sub.example.com</code> .
Dans ce sous domaines vous allez crÃ©er un ensemble de site web par exemple <code>mail.sub.example.com</code> ou <code>blog.sub.example.com</code> .</p>
</div>
<div class="paragraph">
<p>Un cas assez classique est que ce sous domaine est dÃ©lÃ©guÃ© Ã  une machine tierce.</p>
</div>
<div class="paragraph">
<p>Par exemple: <code>example.com</code> est installÃ© sur un VPS quelque part sur internet et <code>sub.example.com</code> est hÃ©bergÃ© chez vous sur votre Raspberry.</p>
</div>
<div class="paragraph">
<p>On suppose que votre domain a Ã©tÃ© configurÃ© en suivant la procÃ©dure du chapitre prÃ©cÃ©dent.</p>
</div>
<div class="paragraph">
<p>Rien de bien sorcier pour votre sous domaine: Vous devez le crÃ©er sur votre Raspberry selon la mÃªme procÃ©dure mais avec le nom du sous domaine ( <code>sub.example.com</code> donc).</p>
</div>
<div class="paragraph">
<p>Vous aurez des actions complÃ©mentaires Ã  effectuer sur votre domaine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans <code>DNS</code> de votre serveur de domaine principal</p>
</li>
<li>
<p>SÃ©lectionner le menu <code>Zones</code> puis le domaine <code>example.com</code></p>
</li>
<li>
<p>Choisissez l&#8217;onglet <code>Records</code> et crÃ©ez:</p>
<div class="ulist">
<ul>
<li>
<p>un enregistrement de type <code>NS</code> avec une <code>Zone</code> &#8592; <code>sub.example.com.</code> et un <code>nameserver Hostname</code> &#8592; <code>ns1.sub.example.com.</code></p>
</li>
<li>
<p>un enregistrement de type <code>NS</code> avec une <code>Zone</code> &#8592; <code>sub.example.com.</code> et un <code>nameserver Hostname</code> &#8592; <code>ns2.sub.example.com.</code></p>
</li>
<li>
<p>un enregistrement de type <code>A</code> avec une <code>IP_Address</code> &#8592; <code>IPV4_NS1</code> et un <code>Hostname</code> &#8592; <code>ns1.sub.example.com.</code></p>
</li>
<li>
<p>un enregistrement de type <code>A</code> avec une <code>IP_Address</code> &#8592; <code>IPV4_NS2</code> et un <code>Hostname</code> &#8592; <code>ns2.sub.example.com.</code></p>
<div class="paragraph">
<p>Ces deux derniers types d&#8217;enregistrement se nomment un Glue record pour faire le lien vers le serveur secondaire.</p>
</div>
</li>
<li>
<p>Si vous connaissez pas l&#8217;adresse IPV4, tapez dans un terminal texte de votre serveur 'sub.example.com`:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget <span class="nt">-qO-</span> http://ipecho.net/plain<span class="p">;</span> <span class="nb">echo</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Si vous avez activÃ© DNSSEC sur votre serveur DNS de <code>sub.example.com</code> vous devrez rÃ©cupÃ©rer les entrÃ©es DS du champ <code>DNSSEC DS-Data for registry</code> de votre domaine <code>sub.example.com</code> et crÃ©er dans votre domaine <code>example.com</code> les deux entrÃ©es suivantes:</p>
<div class="ulist">
<ul>
<li>
<p>un enregistrement de type <code>DS</code> avec une <code>Zone</code> &#8592; <code>sub.example.com.</code> et un champ <code>data</code> contenant <code>xxxxx 7 1 &lt;votre_digest_recupÃ©rÃ©e&gt;</code></p>
</li>
<li>
<p>un enregistrement de type <code>DS</code> avec une <code>Zone</code> &#8592; <code>sub.example.com.</code> et un champ <code>data</code> contenant <code>xxxxx 7 2 &lt;votre_digest_recupÃ©rÃ©e&gt;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Allez sur le site <a href="https://dnssec-debugger.verisignlabs.com/">DNSSEC Analyzer</a>.</p>
</li>
<li>
<p>Entrez votre nom de domaine <code>sub.example.com</code> et tapez sur "entrÃ©e".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le site doit afficher pour les diffÃ©rentes zones le statut des certificats. Tout doit Ãªtre au vert.
Si ce n&#8217;est pas le cas, rÃ©essayer dans une heure. S&#8217;il y a encore des problÃ¨mes vÃ©rifiez votre configuration dans ISPConfig de votre domaine et de votre sous-domaine, chez votre registrar (rubrique DNSSEC) ou regardez les logs d&#8217;ISPConfig sur votre serveur pour y dÃ©busquer une erreur.</p>
</div>
</div>
<div class="sect2">
<h3 id="domain-site">11.6. CrÃ©ation dâun site web</h3>
<div class="paragraph">
<p>Dans la suite le site web sera nommÃ© <code>example.com</code>.</p>
</div>
<div class="paragraph">
<p>Vous devez avoir avant tout dÃ©fini le "record" DNS associÃ© au site.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aller dans "Sites"</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu "Website" pour dÃ©finir un site web</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur "Add new website"</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Client:</code> &#8592; laisser vide ou mettre le client que vous avez crÃ©Ã©.</p>
</li>
<li>
<p><code>IPv4-Address:</code> &#8592; mettre <code>*</code>. Si vous mettez votre adresse IPV4 vous allez rencontrer quelques disfonctionnements.</p>
</li>
<li>
<p><code>Domain:</code> &#8592; mettre <code>example.com</code></p>
</li>
<li>
<p><code>Auto-subdomain:</code> &#8592; sÃ©lectionner <code>wwww</code> ou <code>*</code> si lâon veut un certificat letâs encrypt wildcard</p>
</li>
<li>
<p><code>SSL:</code> &#8592; yes</p>
</li>
<li>
<p><code>Letâs Encrypt:</code> &#8592; yes</p>
</li>
<li>
<p><code>Php:</code> &#8592; SÃ©lectionez <code>php-fpm</code></p>
</li>
<li>
<p>SÃ©lectionnez Ã©ventuellement aussi les coches <code>Perl</code>, <code>Python</code>, <code>Ruby</code> en fonction des technologies dÃ©ployÃ©es sur votre site. Cela est indiquÃ© dans la procÃ©dure d&#8217;installation du site.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans lâonglet <code>redirect</code> du mÃªme Ã©cran</p>
<div class="ulist">
<ul>
<li>
<p><code>SEO Redirect:</code> &#8592; SÃ©lectionner <code>domain.tld &#8658;www.domain.tld</code></p>
</li>
<li>
<p><code>Rewrite http to https:</code> &#8592; yes</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans lâonglet <code>Statistics</code> du mÃªme Ã©cran</p>
<div class="ulist">
<ul>
<li>
<p><code>Set Webstatistics password:</code> &#8592; saisissez un mot de passe</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; ressaisissez le mot de passe</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans lâonglet <code>Backup</code> du mÃªme Ã©cran</p>
<div class="ulist">
<ul>
<li>
<p><code>Backup interval:</code> &#8592; saisir <code>weekly</code></p>
</li>
<li>
<p><code>Number of backup copies:</code> &#8592; saisir <code>1</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans l&#8217;onglet <code>Options</code>, il peut Ãªtre utile pour certains types de site qui sont des redirections d&#8217;autres sites (locaux, d&#8217;autres machines ou de container docker) de saisir dans la zone <code>Apache Directives:</code></p>
<div class="ulist">
<ul>
<li>
<p>Pour un site en HTTP (attention dans ce cas, ce site doit Ãªtre local ou dans un container pour des raisons de sÃ©curitÃ©) :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># Original httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPassMatch</span> ^/(.+)/websocket ws://localhost[:port_number_if_any]/$1/websocket keepalive=On <span class="c"># If websocket is in use</span>

<span class="nc">ProxyPass</span> / http://localhost[:port_number_if_any]/[path_if_any]
<span class="nc">ProxyPassReverse</span> / http://localhost[:port_number_if_any]/[path_if_any]

<span class="nc">RedirectMatch</span> ^/$ https://www.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pour un site en HTTPS :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># redirect from server</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">SSLProxyEngine</span> <span class="ss">On</span> <span class="c"># Comment this out if no https required</span>
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">SSLProxyVerify</span> <span class="ss">none</span>
<span class="nc">SSLProxyCheckPeerCN</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerName</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerExpire</span> <span class="ss">off</span>

<span class="nc">ProxyPass</span> / https://localhost[:port_number_if_any]/[path_if_any]
<span class="nc">ProxyPassReverse</span> / https://localhost[:port_number_if_any]/[path_if_any]

<span class="nc">RedirectMatch</span> ^/$ https://www.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Vous pouvez maintenant tester la qualitÃ© de la  connexion de votre site en allant sur: <a href="https://www.ssllabs.com/ssltest">SSL Server Test</a>. Saisissez votre nom de domaine et cliquez sur <code>Submit</code>. Votre site doit au moins Ãªtre de <code>Grade A</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="subdomain-site">11.7. CrÃ©ation dâun Site Vhost</h3>
<div class="paragraph">
<p>Dans la suite le sous-domaine sera nommÃ© "mail.example.com".</p>
</div>
<div class="paragraph">
<p>Vous devez avoir avant tout dÃ©fini le "record" DNS associÃ© au site.
Vous ne pouvez dÃ©finir un sous-domaine que si vous avez dÃ©fini le site web racine auparavant.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aller dans "Sites"</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu "Subdomain(vhost)" pour dÃ©finir un sous-domaine</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur "Add Subdomain" pour un nouveau sous domaine</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592;  saisir <code>mail</code></p>
</li>
<li>
<p><code>Domain:</code> &#8592; mettre <code>example.com</code></p>
</li>
<li>
<p><code>web folder:</code> &#8592; saisir <code>mail</code></p>
</li>
<li>
<p><code>Auto-subdomain:</code> &#8592; sÃ©lectionner <code>wwww</code> ou <code>*</code> si lâon veut un certificat letâs encrypt wildcard</p>
</li>
<li>
<p><code>SSL:</code> &#8592; yes</p>
</li>
<li>
<p><code>Letâs Encrypt:</code> &#8592; yes</p>
</li>
<li>
<p><code>Php:</code> &#8592; SÃ©lectionez <code>php-fpm</code></p>
</li>
<li>
<p>SÃ©lectionnez Ã©ventuellement aussi les coches <code>Perl</code>, <code>Python</code>, <code>Ruby</code> en fonction des technologies dÃ©ployÃ©es sur votre site. Cela est indiquÃ© dans la procÃ©dure d&#8217;installation du site.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans lâonglet <code>redirect</code> du mÃªme Ã©cran</p>
<div class="ulist">
<ul>
<li>
<p><code>Rewrite http to https:</code> &#8592; yes</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans lâonglet <code>Statistics</code> du mÃªme Ã©cran</p>
<div class="ulist">
<ul>
<li>
<p><code>Set Webstatistics password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; Ressaisissez le mot de passe</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dans l&#8217;onglet <code>Options</code>, il peut Ãªtre utile pour certains types de site qui sont des redirections d&#8217;autres sites (locaux, d&#8217;autres machines ou de container docker) de saisir dans la zone <code>Apache Directives:</code></p>
<div class="ulist">
<ul>
<li>
<p>Pour un site en HTTP (attention dans ce cas, ce site doit Ãªtre local ou dans un container pour des raisons de sÃ©curitÃ©) :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># yacht httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost[:port_number_if_any]/[path_if_any]
<span class="nc">ProxyPassReverse</span> / http://localhost[:port_number_if_any]/[path_if_any]

<span class="nc">RedirectMatch</span> ^/$ https://sub.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pour un site en HTTPS :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># redirect from server</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">SSLProxyEngine</span> <span class="ss">On</span> <span class="c"># Comment this out if no https required</span>
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / https://localhost[:port_number_if_any]/[path_if_any]
<span class="nc">ProxyPassReverse</span> / https://localhost[:port_number_if_any]/[path_if_any]

<span class="nc">RedirectMatch</span> ^/$ https://sub.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Vous pouvez maintenant tester la qualitÃ© de la  connexion de votre site en allant sur: <a href="https://www.ssllabs.com/ssltest">SSL Server Test</a>. Saisissez votre nom de domaine et cliquez sur <code>Submit</code>. Votre site doit au moins Ãªtre de <code>Grade A</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_associer_des_certificats_reconnu_Ã _vos_outils">12. Associer des certificats reconnu Ã  vos outils</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cette action est Ã  effectuer une fois que vous avez crÃ©Ã© votre domaine principal et que vous avez gÃ©nÃ©rÃ© vos premiers certificats let&#8217;s encrypt dans ISPConfig, vous pouvez maintenant, affecter ce certificat aux services de base:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Vous devez avoir crÃ©Ã© au prÃ©alable un site pour les domaines example.com et mail.example.com</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Liez le certificat d&#8217;ISPconfig avec celui du domaine crÃ©e.</p>
<div class="ulist">
<ul>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /usr/local/ispconfig/interface/ssl/
<span class="nb">mv </span>ispserver.crt ispserver.crt-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">mv </span>ispserver.key ispserver.key-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">ln</span> <span class="nt">-s</span> /var/www/clients/&lt;clientx&gt;/&lt;webx&gt;/ssl/&lt;example.com&gt;-le.crt ispserver.crt <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">ln</span> <span class="nt">-s</span> /var/www/clients/&lt;clientx&gt;/&lt;webx&gt;/ssl/&lt;example.com&gt;-le.key ispserver.key <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">cat </span>ispserver.<span class="o">{</span>key,crt<span class="o">}</span> <span class="o">&gt;</span> ispserver.pem
<span class="nb">chmod </span>600 ispserver.pem
systemctl restart apache2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer &lt;example.com&gt; par votre nom de domaine, &lt;clientx&gt; par votre numÃ©ro de client, &lt;webx&gt; par votre numÃ©ro de serveur web. L&#8217;information est facilement retrouvÃ© en cliquant sur l&#8217;interface d&#8217;ISPconfig dans <code>Sites</code>&#8594;`Website`&#8594;`&lt;example.com&gt;`. Le champ <code>Document Root</code> donne le dÃ©but du chemin <code>/var/www/clients/&lt;clientx&gt;/&lt;webx&gt;/</code></td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Liez le certificat Postfix et Dovecot avec celui de let&#8217;s encrypt</p>
<div class="ulist">
<ul>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/postfix/
<span class="nb">mv </span>smtpd.cert smtpd.cert-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">mv </span>smtpd.key smtpd.key-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">ln</span> <span class="nt">-s</span> /var/www/clients/client0/web1/ssl/mail.example.com-le.crt smtpd.cert <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">ln</span> <span class="nt">-s</span> /var/www/clients/client0/web1/ssl/mail.example.com-le.key smtpd.key <i class="conum" data-value="1"></i><b>(1)</b>
service postfix restart
service dovecot restart</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer &lt;example.com&gt; par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Liez le certificat pour Pureftd</p>
<div class="ulist">
<ul>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/ssl/private/
<span class="nb">mv </span>pure-ftpd.pem pure-ftpd.pem-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">ln</span> <span class="nt">-s</span> /usr/local/ispconfig/interface/ssl/ispserver.pem pure-ftpd.pem
<span class="nb">ln</span> <span class="nt">-s</span> /usr/local/ispconfig/interface/ssl/dhparam4096.pem pure-ftpd-dhparams.pem
<span class="nb">chmod </span>600 pure-ftpd.pem
service pure-ftpd-mysql restart</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>CrÃ©ation d&#8217;un script de renouvellement automatique du fichier pem</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Installez la cron. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">crontab <span class="nt">-e</span></code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez la ligne suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">00 02 1 <span class="k">*</span> <span class="k">*</span> /usr/local/bin/certif_update.sh</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez le fichier d&#8217;exÃ©cution pÃ©riodique. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/certif_update.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>et coller dans le fichier le code suivant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="nb">cd</span> /usr/local/ispconfig/interface/ssl/
<span class="nb">mv </span>ispserver.pem ispserver.pem-<span class="si">$(</span><span class="nb">date</span> +<span class="s2">"%y%m%d%H%M%S"</span><span class="si">)</span>.bak
<span class="nb">cat </span>ispserver.<span class="o">{</span>key,crt<span class="o">}</span> <span class="o">&gt;</span> ispserver.pem
<span class="nb">chmod </span>600 ispserver.pem
<span class="nb">chmod </span>600 /etc/ssl/private/pure-ftpd.pem
<span class="nb">cd</span> /etc/postfix
<span class="nb">cat </span>smtpd.<span class="o">{</span>key,cert<span class="o">}</span> <span class="o">&gt;</span> smtpd.pem
<span class="nb">chmod </span>600 smtpd.pem
service pure-ftpd-mysql restart
service monit restart
service postfix restart
service dovecot restart
service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Sauvez et quittez. Tapez ensuite:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod</span> +x /usr/local/bin/certif_update.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_surveillance_du_serveur_avec_munin_et_monit">13. Surveillance du serveur avec Munin et Monit</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_note_prÃ©liminaire">13.1. Note prÃ©liminaire</h3>
<div class="paragraph">
<p>Installez tout d&#8217;abord les paquets indispensables pour faire fonctionner Munin avec Apache puis activez le module fcgid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>apache2 libcgi-fast-perl libapache2-mod-fcgid
a2enmod fcgid</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_de_munin">13.2. Installation et configuration de Munin</h3>
<div class="paragraph">
<p>Suivez les Ã©tapes ci-aprÃ¨s:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installer le paquet Munin:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>munin munin-node munin-plugins-extra logtail libcache-cache-perl</code></pre>
</div>
</div>
</li>
<li>
<p>Votre configuration de Munin va utiliser une base de donnÃ©es MariaDB. Vous devez activer quelques plugins. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/munin/plugins
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_ mysql_
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_bytes mysql_bytes
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_innodb mysql_innodb
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_isam_space_ mysql_isam_space_
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_queries mysql_queries
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_slowqueries mysql_slowqueries
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/mysql_threads mysql_threads</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez la base de donnÃ©es MariaDB de Munin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql <span class="nt">-p</span></code></pre>
</div>
</div>
</li>
<li>
<p>Tapez le mot de passe mysql de root , puis dans mysql tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="mysql">CREATE SCHEMA munin_innodb;
USE munin_innodb
CREATE TABLE something (anything int) ENGINE=InnoDB;
GRANT SELECT ON munin_innodb.* TO 'munin'@'localhost' IDENTIFIED BY 'munin';
FLUSH PRIVILEGES;
EXIT;</code></pre>
</div>
</div>
</li>
<li>
<p>Editez ensuite le fichier de configuration de Munin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/munin/munin.conf</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©commentez les lignes dÃ©butant par: <code>dbdir</code>, <code>htmldir</code>, <code>logdir</code>, <code>rundir</code>, and <code>tmpldir</code>. Les valeurs par dÃ©faut sont correctes.</p>
</li>
<li>
<p>Munin utilisera l&#8217;adresse <code>munin.example.com</code>. Toujours dans le fichier de configuration de munin, remplacer la directive <code>[localhost.localdomain]</code> par <code>[munin.example.com]</code>.</p>
</li>
<li>
<p>Un fois les commentaires enlevÃ©s et la ligne modifiÃ©e, le fichier de configuration doit ressembler Ã  celui-ci:</p>
<div class="listingblock">
<div class="content">
<pre># Example configuration file for Munin, generated by 'make build'
# The next three variables specifies where the location of the RRD
# databases, the HTML output, logs and the lock/pid files. They all
# must be writable by the user running munin-cron. They are all
# defaulted to the values you see here.
#
dbdir /var/lib/munin
htmldir /var/cache/munin/www
logdir /var/log/munin
rundir /var/run/munin
# Where to look for the HTML templates
#
tmpldir /etc/munin/templates
# Where to look for the static www files
#
#staticdir /etc/munin/static
# temporary cgi files are here. note that it has to be writable by
# the cgi user (usually nobody or httpd).
#
# cgitmpdir /var/lib/munin/cgi-tmp

# (Exactly one) directory to include all files from.
includedir /etc/munin/munin-conf.d
[...]
# a simple host tree
[munin.example.com] <i class="conum" data-value="1"></i><b>(1)</b>
 address 127.0.0.1
 use_node_name yes
[...]</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Activez Munin dans Apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2enconf munin</code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier munin.conf d&#8217;Apache:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/apache2/conf-enabled/munin.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Nous allons maintenant activer le module Munin dans Apache et dÃ©finir une authentification basique.</p>
</li>
<li>
<p>Modifiez le fichier pour qu&#8217;il ressemble Ã  celui ci-dessous:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="nc">ScriptAlias</span> /munin-cgi/munin-cgi-graph /usr/lib/munin/cgi/munin-cgi-graph
<span class="nc">Alias</span> /munin/static/ /var/cache/munin/www/static/

<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /var/cache/munin/www</span><span class="p">&gt;
</span>    <span class="nc">Options</span> <span class="ss">FollowSymLinks</span> <span class="ss">SymLinksIfOwnerMatch</span>
    <span class="nc">AuthUserFile</span> /etc/munin/munin-htpasswd
    <span class="nc">AuthName</span> "Munin"
    <span class="nc">AuthType</span> <span class="ss">Basic</span>
    <span class="nc">Require</span> valid-user

<span class="p">&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span>
<span class="p">&lt;</span><span class="nl">Directory</span><span class="sr"> /usr/lib/munin/cgi</span><span class="p">&gt;
</span>    <span class="nc">AuthUserFile</span> /etc/munin/munin-htpasswd
    <span class="nc">AuthName</span> "Munin"
    <span class="nc">AuthType</span> <span class="ss">Basic</span>
    <span class="nc">Require</span> valid-user
    <span class="nc">Options</span> <span class="ss">FollowSymLinks</span> <span class="ss">SymLinksIfOwnerMatch</span>
    <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_fcgid.c</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> fcgid-script
    <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
</span>    <span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> !mod_fcgid.c</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> cgi-script
    <span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;
&lt;/</span><span class="nl">Directory</span><span class="p">&gt;
</span>
<span class="c"># ***** SETTINGS FOR CGI/CRON STRATEGIES *****</span>

<span class="c"># pick _one_ of the following lines depending on your "html_strategy"</span>
<span class="c"># html_strategy: cron (default)</span>
<span class="nc">Alias</span> /munin /var/cache/munin/www
<span class="c"># html_strategy: cgi (requires the apache module "cgid" or "fcgid")</span>
<span class="c">#ScriptAlias /munin /usr/lib/munin/cgi/munin-cgi-html</span></code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite le fichier de mot de passe de munin:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">htpasswd <span class="nt">-c</span> /etc/munin/munin-htpasswd admin</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p>RedÃ©marrez apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez bien que IPV6 est activÃ©. Si ce n&#8217;est pas le cas, le redÃ©marrage de Munin peut survenir.</p>
</li>
<li>
<p>RedÃ©marrez Munin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service munin-node restart</code></pre>
</div>
</div>
</li>
<li>
<p>Attendez quelques minutes afin que Munin produise ses premiers fichiers de sortie. et allez ensuite sur l&#8217;URL: <a href="http://example.com/munin/" class="bare">http://example.com/munin/</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_activez_les_plugins_de_munin">13.3. Activez les plugins de Munin</h3>
<div class="paragraph">
<p>Dans Debian 10, tous les plugins complÃ©mentaires sont dÃ©jÃ  activÃ©s.Vous pouvez Ãªtre tentÃ© de vÃ©rifier:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pour vÃ©rifier que la configuration est correcte. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">munin-node-configure <span class="nt">--suggest</span></code></pre>
</div>
</div>
</li>
<li>
<p>Une liste de plugins doit s&#8217;afficher Ã  l&#8217;Ã©cran. La colonne <code>used</code> indique que le plugins est activÃ©. La colonne <code>Suggestions</code> indique que le serveur fait fonctionner un service qui peut Ãªtre monitorÃ© par ce module. Il faut crÃ©er un lien symbolique du module de <code>/usr/share/munin/plugins</code> dans <code>/etc/munin/plugins</code> pour l&#8217;activer.</p>
</li>
<li>
<p>Par exemple pour activer les modules apache_*:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/munin/plugins
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/apache_accesses
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/apache_processes
<span class="nb">ln</span> <span class="nt">-s</span> /usr/share/munin/plugins/apache_volume
<span class="nb">rm</span> /usr/share/munin/plugins/mysql_</code></pre>
</div>
</div>
</li>
<li>
<p>Une autre maniÃ¨re simple de configurer munin est de taper:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /etc/munin/plugins
munin-node-configure <span class="nt">--shell</span> <span class="nt">--families</span><span class="o">=</span>contrib,auto | sh <span class="nt">-x</span></code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez ensuite le service Munin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service munin-node restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installer_et_configurer_monit">13.4. Installer et configurer Monit</h3>
<div class="paragraph">
<p>Pour installer et configurer Monit, vous devez appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>monit</code></pre>
</div>
</div>
</li>
<li>
<p>Maintenant nous devons Ã©diter le fichier <code>monitrc</code> qui dÃ©finira les services que l&#8217;on souhaite monitorer. Il existe de nombreux exemples sur le web et vous pourrez trouver de nombreuses configuration sur <a href="http://mmonit.com/monit/documentation/" class="bare">http://mmonit.com/monit/documentation/</a>.</p>
</li>
<li>
<p>Changez la configuration de Monit. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf.d/monitrc.local</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>set daemon 60
set logfile syslog facility log_daemon
set mailserver localhost
set mail-format { from: monit@example.com } <i class="conum" data-value="2"></i><b>(2)</b>
set alert nom@example.com <i class="conum" data-value="2"></i><b>(2)</b>
set httpd port 2812 and
 SSL ENABLE
 PEMFILE /usr/local/ispconfig/interface/ssl/ispserver.pem
 allow admin:"my_password" <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez my_password par <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacer example.com par votre domaine et <a href="mailto:nom@example.com">nom@example.com</a> par votre email</td>
</tr>
</table>
</div>
</li>
<li>
<p>Activez les modules standards :</p>
<div class="listingblock">
<div class="content">
<pre>cd /etc/monit/conf-enabled</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour Mariadb. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/mariadb</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre> check process mysqld with pidfile /var/run/mysqld/mysqld.pid
   group database
   group mysql
   start program = "/etc/init.d/mariadb start"
   stop  program = "/etc/init.d/mariadb stop"
   if failed host localhost port 3306 protocol mysql with timeout 15 seconds for 3 times within 4 cycles then restart
   if failed unixsocket /var/run/mysqld/mysqld.sock protocol mysql for 3 times within 4 cycles then restart
   if 5 restarts with 5 cycles then timeout
   depend mysql_bin
   depend mysql_rc

 check file mysql_bin with path /usr/sbin/mysqld
   group mysql
   include /etc/monit/templates/rootbin

 check file mysql_rc with path /etc/init.d/mariadb
   group mysql
   include /etc/monit/templates/rootbin</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour Pureftpd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/pureftpd</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>check process pureftpd with pidfile /var/run/pure-ftpd/pure-ftpd.pid
 start program = "/usr/sbin/service pure-ftpd-mysql start"
 stop program = "/usr/sbin/service pure-ftpd-mysql stop"
 if failed port 21 protocol ftp then restart
 if 5 restarts within 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour named. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/named</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>check process named with pidfile /var/run/named/named.pid
 start program = "/usr/sbin/service bind9 start"
 stop program = "/usr/sbin/service bind9 stop"
 if failed host 127.0.0.1 port 53 type tcp protocol dns then restart
 if failed host 127.0.0.1 port 53 type udp protocol dns then restart
 if 5 restarts within 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour sshd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/sshd</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre> check process sshd with pidfile /var/run/sshd.pid
  start program = "/etc/init.d/ssh start"
  stop program = "/etc/init.d/ssh stop"
  if failed host localhost port 22 with proto ssh then restart
  if 5 restarts within 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/apache2</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre> check process apache with pidfile /var/run/apache2/apache2.pid
   start program = "/etc/init.d/apache2 start"
   stop program  = "/etc/init.d/apache2 stop"
   if 4 restarts within 20 cycles then timeout
   if failed host localhost port 80 with protocol http and request "/server-status" with timeout 25 seconds for 4 times within 5 cycles then restart</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour memcached. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/memcached</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre> check process memcached with pidfile /var/run/memcached/memcached.pid
   start program = "/etc/init.d/memcached start"
   stop program  = "/etc/init.d/memcached stop"
   if failed host 127.0.0.1 port 11211 and protocol memcache then restart
   if cpu &gt; 60% for 2 cycles then alert
   if cpu &gt; 98% for 5 cycles then restart
   if 5 restarts within 20 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour ntpd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/ntpd</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>check process ntpd with pidfile /var/run/ntpd.pid
 start program = "/usr/sbin/service ntp start"
 stop program = "/usr/sbin/service ntp stop"
 if failed host 127.0.0.1 port 123 type udp then restart
 if 5 restarts within 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour dovecot. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/dovecot</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>check process dovecot with pidfile /var/run/dovecot/master.pid
 group mail
 start program = "/usr/sbin/service dovecot start"
 stop program = "/usr/sbin/service dovecot stop"
 if failed host localhost port 993 type tcpssl sslauto protocol imap then restart
 if 5 restarts within 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour postfix. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/postfix</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre> check process postfix with pidfile /var/spool/postfix/pid/master.pid
   start program = "/etc/init.d/postfix start"
   stop  program = "/etc/init.d/postfix stop"
   if failed host localhost port 25 with protocol smtp for 2 times within 3 cycles then restart
   if 5 restarts with 5 cycles then timeout</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez ensuite un fichier pour redis. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/monit/conf-enabled/redis</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier cette configuration :</p>
<div class="listingblock">
<div class="content">
<pre>check process redis with pidfile /var/run/redis/redis-server.pid
  start program = "/usr/sbin/service redis-server start" with timeout 60 seconds
  stop program  = "/usr/sbin/service redis-server stop" with timeout 60 seconds
  if failed host 127.0.0.1 port 6379 then restart
  if totalmem &gt; 500 Mb then alert
  if cpu &gt; 60% for 2 cycles then alert
  if cpu &gt; 98% for 5 cycles then restart
  if 2 restarts within 2 cycles then alert</pre>
</div>
</div>
</li>
<li>
<p>La configuration est assez claire Ã  lire. pour obtenir des prÃ©cisions, rÃ©fÃ©rez vous Ã  la documentation de monit <a href="http://mmonit.com/monit/documentation/monit.html" class="bare">http://mmonit.com/monit/documentation/monit.html</a>.</p>
</li>
<li>
<p>RedÃ©marrez apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Dans la configuration pour apache, la configuration indique que monit doit allez chercher sur le port 80 un fichier dans <code>/monit/token</code>. Nous devons donc crÃ©er ce fichier. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> /var/www/html/monit
<span class="nb">echo</span> <span class="s2">"hello"</span> <span class="o">&gt;</span> /var/www/html/monit/token</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service monit restart</code></pre>
</div>
</div>
</li>
<li>
<p>Pour monitorer le statut des process en ligne de commande, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">monit status</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 2812 sur votre firewall</a></p>
</li>
<li>
<p>Maintenant naviguez sur le site <a href="https://example.com:2812/" class="bare">https://example.com:2812/</a></p>
</li>
<li>
<p>Rentrez le login <code>admin</code> et votre mot de passe <code>my_password</code>. Monit affiche alors les informations de monitoring du serveur.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_de_la_messagerie">14. Configuration de la messagerie</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_configuration_de_lantispam_rspamd">14.1. Configuration de l&#8217;antispam rspamd</h3>
<div class="paragraph">
<p><code>rspamd</code> est rÃ©putÃ© de meilleure qualitÃ© que <code>Amavis</code> dans la chasse aux spams. Vous pouvez dÃ©cider de l&#8217;installer Ã  la place d&#8217;Amavis. Cette installation reste optionnelle.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez les paquets debian. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>rspamd redis-server</code></pre>
</div>
</div>
</li>
<li>
<p>Loguez vous dans ISPConfig</p>
</li>
<li>
<p>Activer Rspamd dans ISPConfig</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Allez dans la rubrique <code>system</code> &#8594; menu <code>Server Config</code> &#8594; SÃ©lectionnez votre serveur &#8594; Onglet <code>Mail</code></p>
</li>
<li>
<p>Dans le champ <code>Content Filter</code>, sÃ©lectionnez <code>Rspamd</code></p>
</li>
<li>
<p>Dans le champ <code>Rspamd Password</code>, tapez votre mot de passe</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>Revenez dans la rubrique <code>system</code> &#8594; menu <code>Server Config</code> &#8594; SÃ©lectionnez votre serveur &#8594; Onglet <code>Mail</code></p>
</li>
<li>
<p>Vous pouvez voir le mot de passe de connexion au serveur web Rspamd.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Activez l&#8217;apprentissage automatique. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/classifier-bayes.conf</code></pre>
</div>
</div>
</li>
<li>
<p>insÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>backend = "redis";
servers = "127.0.0.1";
expire = 8640000;
autolearn {
  spam_threshold = 6.0; # When to learn spam (score &gt;= threshold and action is reject)
  junk_threshold = 4.0; # When to learn spam (score &gt;= threshold and action is rewrite subject or add header, and has two or more positive results)
  ham_threshold = -0.5; # When to learn ham (score &lt;= threshold and action is no action, and score is negative or has three or more negative results)
  check_balance = true; # Check spam and ham balance
  min_balance = 0.9; # Keep diff for spam/ham learns for at least this value
}

per_user = false;
per_language = true;</code></pre>
</div>
</div>
</li>
<li>
<p>Activez Redis dans la configuration de Rspamd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s1">'write_servers = "127.0.0.1";'</span> <span class="o">&gt;</span> /etc/rspamd/local.d/redis.conf
<span class="nb">echo</span> <span class="s1">'read_servers = "127.0.0.1";'</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/redis.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Fixer des mÃ©triques assez Ã©levÃ©es pour analyser les spams</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"actions {"</span> <span class="o">&gt;</span> /etc/rspamd/local.d/metrics.conf
<span class="nb">echo</span> <span class="s1">'add_header = 5;'</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/metrics.conf
<span class="nb">echo</span> <span class="s2">"greylist = 25;"</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/metrics.conf
<span class="nb">echo</span> <span class="s2">"reject = 50;"</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/metrics.conf
<span class="nb">echo</span> <span class="s2">"}"</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/metrics.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Augmentez la taille de l&#8217;historique de Rspamd, activez la compression.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"nrows = 2500;"</span> <span class="o">&gt;</span> /etc/rspamd/local.d/history_redis.conf
<span class="nb">echo</span> <span class="s2">"compress = true;"</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/history_redis.conf
<span class="nb">echo</span> <span class="s2">"subject_privacy = false;"</span> <span class="o">&gt;&gt;</span> /etc/rspamd/local.d/history_redis.conf <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ã  basculer Ã  <code>true</code> si vous avez des utilisateurs de votre serveur de mail souhaitant une compatibilitÃ© RGPD.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Assignez un calcul automatique de rÃ©putation aux URLs</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s1">'enabled = true;'</span> <span class="o">&gt;</span> /etc/rspamd/local.d/url_reputation.conf</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez si l&#8217;Ã©metteur est bien un serveur de mail. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/mx_check.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>enabled = true;
key_prefix = "rmx";
symbol_bad_mx = "MX_INVALID";
symbol_no_mx = "MX_MISSING";
symbol_good_mx = "MX_GOOD";
expire = 86400;
expire_novalid = 7200;
greylist_invalid = false;</code></pre>
</div>
</div>
</li>
<li>
<p>Activez l&#8217;analyse par rÃ©seau de neurone. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/neural.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>enabled = true;

rules {
  "LONG" {
    train {
      max_trains = 5000;
      max_usages = 200;
      max_iterations = 25;
      learning_rate = 0.01,
      spam_score = 10;
      ham_score = -2;
    }
    symbol_spam = "NEURAL_SPAM_LONG";
    symbol_ham = "NEURAL_HAM_LONG";
    ann_expire = 100d;
  }
  "SHORT" {
    train {
      max_trains = 100;
      max_usages = 2;
      max_iterations = 25;
      learning_rate = 0.01,
      spam_score = 10;
      ham_score = -2;
    }
    symbol_spam = "NEURAL_SPAM_SHORT";
    symbol_ham = "NEURAL_HAM_SHORT";
    ann_expire = 1d;
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez les groupes associÃ©s. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/neural_group.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>symbols = {
  "NEURAL_SPAM_LONG" {
    weight = 1.0; # sample weight
    description = "Neural network spam (long)";
  }
  "NEURAL_HAM_LONG" {
    weight = -2.0; # sample weight
    description = "Neural network ham (long)";
  }
  "NEURAL_SPAM_SHORT" {
    weight = 0.5; # sample weight
    description = "Neural network spam (short)";
  }
  "NEURAL_HAM_SHORT" {
    weight = -1.0; # sample weight
    description = "Neural network ham (short)";
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Enrichissez les headers des mails spams. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/milter_headers.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code># local.d/milter_headers.conf:

# Options

# Add "extended Rspamd headers" (default false) (enables x-spamd-result, x-rspamd-server &amp; x-rspamd-queue-id routines)
extended_spam_headers = true;

# List of headers to be enabled for authenticated users (default empty)
authenticated_headers = ["authentication-results"];

# List of headers to be enabled for local IPs (default empty)
local_headers = ["x-spamd-bar"];

# Set false to always add headers for local IPs (default true)
# skip_local = true;

# Set false to always add headers for authenticated users (default true)
# skip_authenticated = true;

# Routines to use- this is the only required setting (may be omitted if using extended_spam_headers)
use = ["x-spamd-bar", "x-spam-level", "x-spam-status", "authentication-results", "remove-headers"];

# this is where we may configure our selected routines
routines {
  remove-headers {
    headers {
      "X-Spam" = 0;
      "X-Spamd-Bar" = 0;
      "X-Spam-Level" = 0;
      "X-Spam-Status" = 0;
      "X-Spam-Flag" = 0;
    }
  }
  # other routines...
}
custom {
  # user-defined routines: more on these later
}</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez une configuration pour le protocole arc. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/arc.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>sign_authenticated = false;
sign_inbound = true;
sign_local = false;
use_domain = "header";
try_fallback = false;
use_esld = false;
path_map = "/etc/rspamd/local.d/dkim_domains.map";
selector_map = "/etc/rspamd/local.d/dkim_selectors.map";</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez un mot de passe. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">rspamadm pw</code></pre>
</div>
</div>
</li>
<li>
<p>Entrez <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a>. Une hash phrase est gÃ©nÃ©rÃ©e.</p>
</li>
<li>
<p>Copiez la.</p>
</li>
<li>
<p>Remplacez celle dÃ©jÃ  prÃ©sente dans <code>/etc/rspamd/local.d/worker-controller.inc</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/worker-controller.inc</code></pre>
</div>
</div>
</li>
<li>
<p>Remplacez le texte entre guillemets sur la ligne <code>password = "$2$g95yw&#8230;&#8203;&#8230;&#8203;dq3c5byy";</code> par le texte copiÃ©.</p>
</li>
<li>
<p>Si vous avez installÃ© l&#8217;antivirus Clamav, CrÃ©ez un fichier pour la configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/antivirus.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>clamav {
    # If set force this action if any virus is found (default unset: no action is forced)
    #action = "reject";
    # Scan mime_parts separately - otherwise the complete mail will be transferred to AV Scanner
    scan_mime_parts = true;
    # Scanning Text is suitable for some av scanner databases (e.g. Sanesecurity)
    scan_text_mime = true;
    scan_image_mime = true;
    # If `max_size` is set, messages &gt; n bytes in size are not scanned
    #max_size = 20000000;
    # symbol to add (add it to metric if you want non-zero weight)
    symbol = "CLAM_VIRUS";
    # type of scanner: "clamav", "fprot", "sophos" or "savapi"
    type = "clamav";
    # For "savapi" you must also specify the following variable
    #product_id = 12345;
    # You can enable logging for clean messages
    #log_clean = true;
    # servers to query (if port is unspecified, scanner-specific default is used)
    # can be specified multiple times to pool servers
    # can be set to a path to a unix socket
    # Enable this in local.d/antivirus.conf
    #servers = "127.0.0.1:3310";
    servers = "/var/run/clamav/clamd.ctl";
    # if `patterns` is specified virus name will be matched against provided regexes and the related
    # symbol will be yielded if a match is found. If no match is found, default symbol is yielded.
    patterns {
      # symbol_name = "pattern";
      JUST_EICAR = "^Eicar-Test-Signature$";
    }
    patterns_fail {
      # symbol_name = "pattern";
      CLAM_PROTOCOL_ERROR = '^unhandled response';
    }
    # `whitelist` points to a map of IP addresses. Mail from these addresses is not scanned.
    whitelist = "/etc/rspamd/antivirus.wl";
}</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©finissez des groupes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/groups.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>group "antivirus" {
    .include(try=true; priority=1; duplicate=merge) "$LOCAL_CONFDIR/local.d/antivirus_group.conf"
    .include(try=true; priority=10) "$LOCAL_CONFDIR/override.d/antivirus_group.conf"
}</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©finissez les dÃ©tections de virus :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/rspamd/local.d/antivirus_group.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>subject = "***SPAM*** %s";
symbols = {
        "CLAM_VIRUS" {
                weight = 50;
                description = "Clamav has found a virus.";
        }
        "JUST_EICAR" {
                weight = 50;
                description = "Clamav has found a virus.";
        }
        "R_DUMMY" {
                weight = 0.0;
                description = "Dummy symbol";
        }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Ajuster les permissions. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>755 /etc/rspamd/local.d/maps.d</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez Rspamd</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart rspamd</code></pre>
</div>
</div>
</li>
<li>
<p>Rendre le site rspamd accessible dans un host</p>
</li>
<li>
<p>Activez le module proxy dans apache</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">a2enmod proxy
systemctl restart apache2</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>rspamd</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de <code>sites</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>rspamd</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>rspamd</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># redirect from server</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">SSLProxyEngine</span> <span class="ss">On</span> <span class="c"># Comment this out if no https required</span>
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">SSLProxyVerify</span> <span class="ss">none</span>
<span class="nc">SSLProxyCheckPeerCN</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerName</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerExpire</span> <span class="ss">off</span>

<span class="nc">ProxyPass</span> /rspamd https://example.com:8081/rspamd/ <i class="conum" data-value="1"></i><b>(1)</b>
<span class="ss">ProxyPass</span> / https://example.com:8081/rspamd/ <i class="conum" data-value="1"></i><b>(1)</b>
<span class="ss">ProxyPassReverse</span> / https://example.com:8081/rspamd/ <i class="conum" data-value="1"></i><b>(1)</b>

<span class="ss">RedirectMatch</span> ^/$ https://rspamd.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>en pointant sur le site <code>rspampd.example.com</code> , et en utilisant le mot de passe saisi plus haut vous pouvez accÃ©der aux fonctions de l&#8217;outil.</p>
</li>
<li>
<p>Activer l&#8217;apprentissage par dÃ©placement</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CouplÃ© avec Dovecot, Rspamd nous propose de pouvoir apprendre Ã©galement en fonction des actions des utilisateurs. Si un mail est dÃ©placÃ© vers le rÃ©pertoire Junk, il sera appris comme tel et au contraire, sâil est sorti du rÃ©pertoire Junk vers autre chose que la corbeille, il sera appris comme Ham.</p>
</li>
<li>
<p>Editez le fichier Dovecot.conf (remarques ISPConfig n&#8217;utilise pas aujourd&#8217;hui le contenu du rÃ©pertoire conf.d). Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/dovecot/conf.d/99-ispconfig-custom-config.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez le texte suivant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>plugin {
  sieve_plugins = sieve_imapsieve sieve_extprograms

  imapsieve_mailbox1_name = Junk
  imapsieve_mailbox1_causes = COPY
  imapsieve_mailbox1_before = file:/etc/dovecot/sieve/report-spam.sieve

  imapsieve_mailbox2_name = *
  imapsieve_mailbox2_from = Junk
  imapsieve_mailbox2_causes = COPY
  imapsieve_mailbox2_before = file:/etc/dovecot/sieve/report-ham.sieve

  sieve_pipe_bin_dir = /etc/dovecot/sieve

  sieve_global_extensions = +vnd.dovecot.pipe
}

protocol imap {
  mail_plugins = quota imap_quota imap_sieve
}</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez dovecot. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service dovecot restart</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez un rÃ©pertoire sieve et Ã©ditez report-ham.sieve. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/dovecot/sieve/
vi /etc/dovecot/sieve/report-ham.sieve</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>require ["vnd.dovecot.pipe", "copy", "imapsieve", "environment", "variables"];

if environment :matches "imap.mailbox" "*" {
set "mailbox" "${1}";
}

if string "${mailbox}" "Trash" {
stop;
}

if environment :matches "imap.email" "*" {
set "email" "${1}";
}

pipe :copy "train-ham.sh" [ "${email}" ];</code></pre>
</div>
</div>
</li>
<li>
<p>Editez report-spam.sieve. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/dovecot/sieve/report-spam.sieve</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>require ["vnd.dovecot.pipe", "copy", "imapsieve", "environment", "variables"];

if environment :matches "imap.email" "*" {
set "email" "${1}";
}

pipe :copy "train-spam.sh" [ "${email}" ];</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez les scripts et rÃ©tablissez les droits et permissions. Compilez les rÃ¨gles. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"exec /usr/bin/rspamc learn_ham"</span> <span class="o">&gt;</span> /etc/dovecot/sieve/train-ham.sh
<span class="nb">echo</span> <span class="s2">"exec /usr/bin/rspamc learn_spam"</span> <span class="o">&gt;</span> /etc/dovecot/sieve/train-spam.sh
sievec /etc/dovecot/sieve/report-ham.sieve
sievec /etc/dovecot/sieve/report-spam.sieve
<span class="nb">chmod</span> +x /etc/dovecot/sieve/train-<span class="k">*</span>
<span class="nb">chown</span> <span class="nt">-R</span> vmail:vmail /etc/dovecot/sieve</code></pre>
</div>
</div>
</li>
<li>
<p>On en profite pour ajouter un petit script qui informe l&#8217;utilisateur de l&#8217;atteinte de son quota. On Ã©dite le fichier <code>90-quota.conf</code> :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/dovecot/conf.d/90-quota.conf</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>plugin {
  quota = maildir:User quota
  quota_warning = storage=90%% quota-warning 90 %u
}

service quota-warning {
  executable = script /usr/local/bin/quota-warning.sh
  user = vmail
  unix_listener quota-warning {
    user = vmail
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©er le fichier de script :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/quota-warning.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/usr/bin/env bash</span>

<span class="nv">PERCENT</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">}</span>
<span class="nv">USER</span><span class="o">=</span><span class="k">${</span><span class="nv">2</span><span class="k">}</span>

<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> | /usr/sbin/sendmail </span><span class="nv">$USER</span><span class="sh"> -O "plugin/quota=maildir:User quota:noenforcing"
From: postmaster@example.com <i class="conum" data-value="1"></i><b>(1)</b>

Votre Boite est plein Ã  plus de </span><span class="k">${</span><span class="nv">PERCENT</span><span class="k">}</span><span class="sh">. Faut faire du mÃ©nage mon ami !
EOF</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer example.com par votre nom de domaine.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Changez les permissions :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod</span> +x /usr/local/bin/quota-warning.sh
<span class="nb">chown </span>vmail /usr/local/bin/quota-warning.sh</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez dovecot. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service dovecot restart</code></pre>
</div>
</div>
</li>
<li>
<p>Lorsque vous dÃ©placer un mail du rÃ©pertoire Inbox vers le rÃ©pertoire Junk ou vice-versa, les fichiers <code>/var/log/mail.log</code> et <code>/var/log/rspamd/rspamd.log</code> doivent montrer les actions de recalcul des spams.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enfin, vous pouvez dÃ©sactiver amavisd si vous le souhaitez et s&#8217;il est installÃ© sur votre systÃ¨me. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl stop amavisd-new
systemctl disable amavisd-new</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_serveur_de_messagerie">14.2. CrÃ©ation du serveur de messagerie</h3>
<div class="paragraph">
<p>Pour crÃ©er un serveur de messagerie:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assurez vous d&#8217;avoir crÃ©Ã© le domaine DNS. Si ce n&#8217;est pas le cas dÃ©roulez tout d&#8217;abord la procÃ©dure de <a href="#domain-config">crÃ©ation de domaines</a></p>
</li>
<li>
<p>Aller dans la rubrique <code>Email</code>. SÃ©lectionnez ensuite le menu <code>Domain</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Domain</code></p>
</li>
<li>
<p>Saisissez le nom de domaine.</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>Attendez quelques secondes la fin de configuration puis rouvrez la configuration de votre serveur de mail et</p>
</li>
<li>
<p>Cliquez sur <code>DomainKeys Indentified Mail (DKIM)</code></p>
</li>
<li>
<p>Cliquez sur <code>enable DKIM</code></p>
</li>
<li>
<p>Cliquez sur <code>Generate DKIM Private-key</code></p>
</li>
<li>
<p>Une fois cela fait, retourner dans la gestion des <code>Records</code> de domaine et activer le type DMARC</p>
</li>
<li>
<p>Garder le paramÃ©trage par dÃ©faut et sauvegardez.</p>
</li>
<li>
<p>Faites de mÃªme pour les enregistrements SPF mais sÃ©lectionnez le mÃ©canisme softfail.</p>
</li>
<li>
<p>Votre serveur est crÃ©Ã© et protÃ©gÃ© Contre les spams (entrants et sortants).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_finaliser_la_sÃ©curisation_de_votre_serveur_de_mail">14.3. Finaliser la sÃ©curisation de votre serveur de mail</h3>
<div class="paragraph">
<p>Afin de mieux sÃ©curiser votre serveur de mail, appliquez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>editez le fichier main.cf</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/postfix/main.cf</code></pre>
</div>
</div>
</li>
<li>
<p>Rechercher <code>myhostname</code> et replacer le texte par:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="py">myhostname</span> <span class="p">=</span> <span class="s">mail.example.com </span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacer <code>example.com</code> par votre nom de domaine.</td>
</tr>
</table>
</div>
</li>
<li>
<p>RedÃ©marrez Postfix. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service postfix restart</code></pre>
</div>
</div>
</li>
<li>
<p>Vous pouvez ajouter une signature DKIM. Si vous utilisez ISPConfig, cette opÃ©ration est effectuÃ©e automatiquement et cette Ã©tape est Ã  sauter :</p>
<div class="ulist">
<ul>
<li>
<p>DKIM est une mÃ©thode d&#8217;authentification du courrier Ã©lectronique conÃ§ue pour dÃ©tecter l&#8217;usurpation d&#8217;adresse Ã©lectronique. Elle permet au serveur de rÃ©ception de vÃ©rifier l&#8217;origine d&#8217;un courrier Ã©lectronique en y apposant une signature numÃ©rique. La vÃ©rification de la signature est effectuÃ©e Ã  l&#8217;aide de la clÃ© publique du signataire publiÃ©e dans le DNS. Elle peut Ãªtre utilisÃ©e pour dÃ©tecter les courriels frauduleux.</p>
</li>
<li>
<p>CrÃ©ez un nouveau rÃ©pertoire pour stocker la clÃ© DKIM et gÃ©nÃ©rez une nouvelle paire de clÃ©s DKIM Ã  l&#8217;aide de l&#8217;utilitaire <code>rspamadm</code>. Dans l&#8217;exemple suivant, nous utilisons mail comme sÃ©lecteur DKIM. Il gÃ©nÃ©rera une paire de clÃ©s qui pourra Ãªtre utilisÃ©e pour tous les domaines gÃ©rÃ©s par le serveur de messagerie:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> /var/lib/rspamd/dkim/
rspamadm dkim_keygen <span class="nt">-d</span> example.com <span class="nt">-s</span> default <span class="nt">-k</span> toto <span class="nt">-b</span> 2048 /var/lib/rspamd/dkim/example.com.dkim.key <span class="o">&gt;</span> /var/lib/rspamd/dkim/example.com.dkim.key.pub <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Vous trouverez deux fichiers dans le rÃ©pertoire :</p>
<div class="ulist">
<ul>
<li>
<p><code>mail.key</code> - Le fichier de clÃ© privÃ©e</p>
</li>
<li>
<p><code>mail.pub</code> - Le fichier de clÃ© publique</p>
</li>
</ul>
</div>
</li>
<li>
<p>Editez le fichier dkim_domains.map et ajoutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>example.com /var/lib/rspamd/dkim/example.com.dkim.key <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Editez le fichier <code>dkim_selectors.map</code> et ajoutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>example.com default <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ajoutez une entrÃ©e DNS avec le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>default._domainkey.example.com. 3600  IN  TXT   "v=DKIM1; t=s; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtBdWvMUlDmlAzZWTMhyheOmcewA4DFx+nMHI+3baOuJWt3/v7CdrX+egisWD5jwRzi/wN18kWR4kG/5rQKpIQLjurQrzqPO9i1Bub9O+VZWw0ldCAVNjKtkoFfgEErePMnKX/9Qjje+rqrH9oHSC+RK0z2Dvj3+WQIDAQAB" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine et remplacez le contenu derriÃ¨re p= par le contenu derriÃ¨re p= prÃ©sent dans le fichier /var/lib/rspamd/dkim/exaple.com.dkim.key.pub</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ajouter si ce n&#8217;est pas le cas une entrÃ©e DNS pour le SPF:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>v=spf1 mx a a:mail.example.com a:mail.other.example.com  include:mail.toto.com -all <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez example.com par votre nom de domaine. Vous pouvez
rajouter autant d&#8217;entrÃ©e <code>a:</code> ou <code>include:</code> que nÃ©cessaires si
vous avez des serveur de mail secondaires qui peuvent relayer des
mails pour ce domaine. La valeur -all interdira tout autre domaine
ou addresse IP Ã  envoyer des mails</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Vous pouvez le tester en allant sur le site <a href="https://mxtoolbox.com/diagnostic.aspx">MxToolbox</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Entrez le nom de host de votre serveur de mail: <code>mail.example.com</code> .</p>
</li>
<li>
<p>cliquez sur <code>test Email Server</code></p>
</li>
<li>
<p>Tout doit Ãªtre correct sauf Ã©ventuellement le reverse DNS qui doit Ãªtre configurÃ© pour pointer vers <code>mail.example.com</code> .</p>
</li>
</ul>
</div>
</li>
<li>
<p>Testez votre email sur le site <a href="https://www.phishingscorecard.com/">Phishing Scoreboard</a></p>
<div class="ulist">
<ul>
<li>
<p>Entrez votre adresse mail: <code>admin@example.com</code></p>
</li>
<li>
<p>Entrez votre nom de domaine: <code>example.com</code></p>
</li>
<li>
<p>Entrez votre clÃ© dkim: <code>default</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Enfin, vous pouvez tester votre statut de spammer potentiel en envoyant allant sur le site <a href="https://www.mail-tester.com/">Newsletter Spam test</a></p>
<div class="ulist">
<ul>
<li>
<p>suivez les instructions (envoi d&#8217;un email Ã  l&#8217;adresse donnÃ©e)</p>
</li>
<li>
<p>le site vous donnera des informations intÃ©ressantes sur la configuration du serveur et des informations complÃ©mentaires liÃ©es au contenu du mail. Pour ces derniÃ¨res ne pas en tenir compte.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_surveillance_du_statut_de_spammer">14.4. Surveillance du statut de Spammer</h3>
<div class="paragraph">
<p>Il est nÃ©cessaire aujourd&#8217;hui de surveiller le statut de votre serveur de mail et de vÃ©rifier notamment si votre configuration SPF, DKIM et DMARC est correctement comprise par les serveurs de mails les plus connus comme Gmail, Yahoo, Hotmail &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Pour cela un peu de configuration est nÃ©cessaire.</p>
</div>
<div class="paragraph">
<p>En premier, il faut crÃ©er un compte:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez sur le site <a href="https://dmarcian.com">Dmarcian</a></p>
</li>
<li>
<p>Cliquez sur <code>Sign up Free</code></p>
</li>
<li>
<p>Choisissez votre rÃ©gion, <code>Europe</code> par exemple.</p>
</li>
<li>
<p>Enregistrez votre compte (mail, mot de passe) et votre nom de domaine <code>example.com</code></p>
</li>
<li>
<p>notez bien l&#8217;adresse email qui va vous Ãªtre donnÃ©e par dmarcian de la forme <code>xyzabcd@ag.dmarcian.eu</code> pour la rÃ©ception de messages de type abuse te de la forme <code>xyzabcd@fr.dmarcian.eu</code> pour des forensic. Notez bien ces deux adresses.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ensuite, vous devez modifier votre configuration DMARC:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans <code>DNS</code> de votre serveur de domaine principal</p>
</li>
<li>
<p>SÃ©lectionnez le menu <code>Zones</code> puis le domaine <code>example.com</code></p>
</li>
<li>
<p>Choisissez l&#8217;onglet <code>Records</code> et Ã©ditez l&#8217;entrÃ©e <code>TXT</code> nommÃ©e _dmarc</p>
</li>
<li>
<p>modifiez le champ <code>Text</code> avec : <code>v=DMARC1;p=reject;sp=quarantine;pct=100;rua=mailto:abuse@example.com;ruf=mailto:forensic@example.com</code>. On remplacera bien le domaine <code>example.com</code> par son propre domaine.</p>
</li>
<li>
<p>Allez ensuite dans <code>Email</code></p>
</li>
<li>
<p>Allez dans le menu <code>Email Forward</code></p>
</li>
<li>
<p>cliquez sur  <code>Add new Email Forward</code></p>
</li>
<li>
<p>Saisissez dans <code>Email</code> la valeur <code>abuse</code></p>
</li>
<li>
<p>Saisissez dans Destination Email sur 2 lignes l&#8217;adresse de votre mail de rÃ©ception interne et l&#8217;adresse mail qui vous a Ã©tÃ© fournie par <code>dmarcian.com</code> pour l&#8217;adresse abuse ( de la forme <code>xyzabcd@ag.dmarcian.eu</code> )</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>cliquez sur  <code>Add new Email Forward</code></p>
</li>
<li>
<p>Saisissez dans <code>Email</code> la valeur <code>forensic</code></p>
</li>
<li>
<p>Saisissez dans Destination Email sur 2 lignes l&#8217;adresse de votre mail de rÃ©ception interne et l&#8217;adresse mail qui vous a Ã©tÃ© fournie par <code>dmarcian.com</code> pour l&#8217;adresse forensic ( de la forme <code>xyzabcd@fr.dmarcian.eu</code> )</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
<li>
<p>le site <code>dmarcian.com</code> va commencer Ã  recevoir tous les comptes rendus de mails refusÃ©s par les destinataires de messagerie et Ã©laborer des statistiques ainsi que des comptes rendus que vous pourrez consulter sur votre compte.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Il est intÃ©ressant de vÃ©rifier votre statut de spammer en vÃ©rifiant les diffÃ©rentes blacklist qui existent.</p>
</div>
<div class="paragraph">
<p>Pour cela allez sur le site <a href="https://mxtoolbox.com/blacklists.aspx">Email Blacklist Check</a> entrez votre nom de domaine <code>example.com</code> et cliquez sur le bouton <code>Blacklist Check</code>.</p>
</div>
<div class="paragraph">
<p>Tous les sites doivent indiquer que votre domaine n&#8217;est pas blacklistÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_lautoconfig_pour_thunderbird_et_android">14.5. CrÃ©ation de lâautoconfig pour Thunderbird et Android</h3>
<div class="paragraph">
<p>La procÃ©dure est utilisÃ© par Thunderbird et Android pour configurer automatiquement les paramÃ¨tres de la messagerie.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>autoconfig</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>autoconfig</code>.</p>
</li>
<li>
<p>Mettre dans <code>Auto-SubDomain</code> la valeur <code>None</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">FilesMatch</span><span class="sr"> "^.+\.xml$"</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> "proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost" <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/FilesMatch&gt;

<span class="p">&lt;</span><span class="nl">FilesMatch</span><span class="sr"> "^.+\.json$"</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> "proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost" <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/FilesMatch&gt;

<span class="nc">AddHandler</span> application/x-httpd-php .php .xml .json

<span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_speling.c</span><span class="p">&gt;
</span>    <span class="nc">CheckCaseOnly</span> <span class="ss">on</span>
    <span class="nc">CheckSpelling</span> <span class="ss">on</span>
<span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mettez bien ici la version de PHP que vous avez choisi. Dans l&#8217;exemple c&#8217;est la 8.2</td>
</tr>
</table>
</div>
</li>
<li>
<p>Sauver.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier le fichier <code>/etc/php/8.2/fpm/pool.d/www.conf</code> (mettez votre version choisie Ã  la place de 8.2).</p>
</li>
<li>
<p>Dans le fichier, recherchez <code>security.limit_extension</code> et ajoutez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>security.limit_extensions = .php .php3 .php4 .php5 .php7 .xml .json</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dans le rÃ©pertoire <code>/var/www/autoconfig.&lt;example.com&gt;/autoconfig/</code> crÃ©er un rÃ©pertoire mail. Lui donner les permissions 755 et affecter les mÃªmes possesseurs que pour autres fichiers du rÃ©pertoire. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/www/autoconfig.example.com <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">mkdir</span> <span class="nt">-p</span> autoconfig/mail
<span class="nb">chmod </span>755 autoconfig/mail
<span class="nb">chown </span>web1:client0 autoconfig/mail <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer web1:client0 par les permissions du rÃ©pertoire <code>/var/www/autoconfig.example.com</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>A lâintÃ©rieur de ce rÃ©pertoire, Editez un fichier <code>config-v1.1.xml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi autoconfig/mail/config-v1.1.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Y coller:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="err">&lt;</span>?php
header('Content-Type: application/xml');
?&gt;
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;clientConfig</span> <span class="na">version=</span><span class="s">"1.1"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;emailProvider</span> <span class="na">id=</span><span class="s">"example.com"</span><span class="nt">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="nt">&lt;domain&gt;</span>example.com<span class="nt">&lt;/domain&gt;</span>  <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="nt">&lt;displayName&gt;</span>Example Mail<span class="nt">&lt;/displayName&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="nt">&lt;displayShortName&gt;</span>Example<span class="nt">&lt;/displayShortName&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="nt">&lt;incomingServer</span> <span class="na">type=</span><span class="s">"imap"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;hostname&gt;</span>mail.example.com<span class="nt">&lt;/hostname&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="nt">&lt;port&gt;</span>993<span class="nt">&lt;/port&gt;</span>
     <span class="nt">&lt;socketType&gt;</span>SSL<span class="nt">&lt;/socketType&gt;</span>
     <span class="nt">&lt;authentication&gt;</span>password-cleartext<span class="nt">&lt;/authentication&gt;</span>
     <span class="nt">&lt;username&gt;</span>%EMAILADDRESS%<span class="nt">&lt;/username&gt;</span>
   <span class="nt">&lt;/incomingServer&gt;</span>
   <span class="nt">&lt;incomingServer</span> <span class="na">type=</span><span class="s">"pop3"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;hostname&gt;</span>mail.example.com<span class="nt">&lt;/hostname&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="nt">&lt;port&gt;</span>995<span class="nt">&lt;/port&gt;</span>
     <span class="nt">&lt;socketType&gt;</span>SSL<span class="nt">&lt;/socketType&gt;</span>
     <span class="nt">&lt;authentication&gt;</span>password-cleartext<span class="nt">&lt;/authentication&gt;</span>
     <span class="nt">&lt;username&gt;</span>%EMAILADDRESS%<span class="nt">&lt;/username&gt;</span>
   <span class="nt">&lt;/incomingServer&gt;</span>
   <span class="nt">&lt;outgoingServer</span> <span class="na">type=</span><span class="s">"smtp"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;hostname&gt;</span>mail.example.com<span class="nt">&lt;/hostname&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="nt">&lt;port&gt;</span>465<span class="nt">&lt;/port&gt;</span>
     <span class="nt">&lt;socketType&gt;</span>SSL<span class="nt">&lt;/socketType&gt;</span>
     <span class="nt">&lt;authentication&gt;</span>password-cleartext<span class="nt">&lt;/authentication&gt;</span>
     <span class="nt">&lt;username&gt;</span>%EMAILADDRESS%<span class="nt">&lt;/username&gt;</span>
   <span class="nt">&lt;/outgoingServer&gt;</span>
   <span class="nt">&lt;outgoingServer</span> <span class="na">type=</span><span class="s">"smtp"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;hostname&gt;</span>mail.example.com<span class="nt">&lt;/hostname&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
     <span class="nt">&lt;port&gt;</span>587<span class="nt">&lt;/port&gt;</span>
     <span class="nt">&lt;socketType&gt;</span>STARTTLS<span class="nt">&lt;/socketType&gt;</span>
     <span class="nt">&lt;authentication&gt;</span>password-cleartext<span class="nt">&lt;/authentication&gt;</span>
     <span class="nt">&lt;username&gt;</span>%EMAILADDRESS%<span class="nt">&lt;/username&gt;</span>
   <span class="nt">&lt;/outgoingServer&gt;</span>
 <span class="nt">&lt;/emailProvider&gt;</span>
<span class="nt">&lt;/clientConfig&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre libellÃ© long pour votre nom de messagerie</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>mettre ici un libellÃ© court pour votre nom de messagerie</td>
</tr>
</table>
</div>
</li>
<li>
<p>Donner la permission en lecture seule et affecter les groupes d&#8217;appartenance. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>644 autoconfig/mail/config-v1.1.xml
<span class="nb">chown </span>web1:client0 autoconfig/mail/config-v1.1.xml <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer web1:client0 par les permissions du rÃ©pertoire <code>/var/www/autoconfig.example.com</code></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dautodiscover_pour_outlook">14.6. CrÃ©ation dâautodiscover pour Outlook</h3>
<div class="paragraph">
<p>Outlook utilise un autre mÃ©canisme pour se configurer automatiquement. Il est basÃ© sur l&#8217;utilisation du nom de sous-domaine <code>autodiscover</code>. Cette methode ne fonctionne pas avec les versions rÃ©centes de Outlook.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>autodiscover</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>autoconfig</code>.</p>
</li>
<li>
<p>Mettre dans <code>Auto-SubDomain</code> la valeur <code>None</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">FilesMatch</span><span class="sr"> "^.+\.xml$"</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> "proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost" <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/FilesMatch&gt;

<span class="p">&lt;</span><span class="nl">FilesMatch</span><span class="sr"> "^.+\.json$"</span><span class="p">&gt;
</span>        <span class="nc">SetHandler</span> "proxy:unix:/run/php/php8.2-fpm.sock|fcgi://localhost" <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/FilesMatch&gt;

<span class="nc">AddHandler</span> application/x-httpd-php .php .xml .json

<span class="p">&lt;</span><span class="nl">IfModule</span><span class="sr"> mod_speling.c</span><span class="p">&gt;
</span>    <span class="nc">CheckCaseOnly</span> <span class="ss">on</span>
    <span class="nc">CheckSpelling</span> <span class="ss">on</span>
<span class="p">&lt;/</span><span class="nl">IfModule</span><span class="p">&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Mettez bien ici la version de PHP que vous avez choisi. Dans l&#8217;exemple c&#8217;est la 8.2</td>
</tr>
</table>
</div>
</li>
<li>
<p>Sauver.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Editez le fichier le fichier <code>/etc/php/8.2/fpm/pool.d/www.conf</code> (mettez votre version choisie Ã  la place de 8.2).</p>
</li>
<li>
<p>Dans le fichier, recherchez <code>security.limit_extension</code> et ajoutez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>security.limit_extensions = .php .php3 .php4 .php5 .php7 .xml .json</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dans le rÃ©pertoire <code>/var/www/autoconfig.&lt;example.com&gt;/autoconfig/</code>, crÃ©er un rÃ©pertoire <code>Autodiscover</code>. Lui donner les permissions 755 et affecter les mÃªmes possesseurs que pour autres fichiers du rÃ©pertoire. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/www/autoconfig.example.com <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">mkdir</span> <span class="nt">-p</span> autoconfig/Autodiscover/
<span class="nb">chmod </span>755 autoconfig/Autodiscover/
<span class="nb">chown </span>web1:client0 autoconfig/Autodiscover/ <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer web1:client0 par les permissions du rÃ©pertoire <code>/var/www/autoconfig.example.com</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>remplacez <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>A lâintÃ©rieur de ce rÃ©pertoire, Editez un fichier <code>Autodiscover.xml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi autoconfig/Autodiscover/Autodiscover.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Y coller:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="err">&lt;</span>?php
$postData = file_get_contents('php://input'); //Autodiscover requests are HTTP posts with XML content
$xml = simplexml_load_string($postData);
$user = $xml-&gt;Request-&gt;EMailAddress; //copy the email address from the request into a variable

//set Content-Type
header("Content-Type: application/xml");
?&gt;
<span class="cp">&lt;?php echo '&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>'; ?&gt;
<span class="nt">&lt;Autodiscover</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/exchange/autodiscover/responseschema/2006"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Response</span> <span class="na">xmlns=</span><span class="s">"http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Account&gt;</span>
            <span class="nt">&lt;AccountType&gt;</span>email<span class="nt">&lt;/AccountType&gt;</span>
            <span class="nt">&lt;Action&gt;</span>settings<span class="nt">&lt;/Action&gt;</span>
            <span class="nt">&lt;Protocol&gt;</span>
                <span class="nt">&lt;Type&gt;</span>POP3<span class="nt">&lt;/Type&gt;</span>
                <span class="nt">&lt;Server&gt;</span>mail.example.com<span class="nt">&lt;/Server&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="nt">&lt;Port&gt;</span>995<span class="nt">&lt;/Port&gt;</span>
                <span class="nt">&lt;LoginName&gt;</span><span class="cp">&lt;?php echo $user; ?&gt;</span><span class="nt">&lt;/LoginName&gt;</span>
                <span class="nt">&lt;DomainRequired&gt;</span>off<span class="nt">&lt;/DomainRequired&gt;</span>
                <span class="nt">&lt;SPA&gt;</span>off<span class="nt">&lt;/SPA&gt;</span>
                <span class="nt">&lt;SSL&gt;</span>on<span class="nt">&lt;/SSL&gt;</span>
                <span class="nt">&lt;AuthRequired&gt;</span>on<span class="nt">&lt;/AuthRequired&gt;</span>
                <span class="nt">&lt;DomainRequired&gt;</span>on<span class="nt">&lt;/DomainRequired&gt;</span>
            <span class="nt">&lt;/Protocol&gt;</span>
            <span class="nt">&lt;Protocol&gt;</span>
                <span class="nt">&lt;Type&gt;</span>IMAP<span class="nt">&lt;/Type&gt;</span>
                <span class="nt">&lt;Server&gt;</span>mail.example.com<span class="nt">&lt;/Server&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="nt">&lt;Port&gt;</span>993<span class="nt">&lt;/Port&gt;</span>
                <span class="nt">&lt;DomainRequired&gt;</span>on<span class="nt">&lt;/DomainRequired&gt;</span>
                <span class="nt">&lt;LoginName&gt;</span><span class="cp">&lt;?php echo $user; ?&gt;</span><span class="nt">&lt;/LoginName&gt;</span>
                <span class="nt">&lt;SPA&gt;</span>off<span class="nt">&lt;/SPA&gt;</span>
                <span class="nt">&lt;SSL&gt;</span>on<span class="nt">&lt;/SSL&gt;</span>
                <span class="nt">&lt;Encryption&gt;</span>Auto<span class="nt">&lt;/Encryption&gt;</span>
                <span class="nt">&lt;AuthRequired&gt;</span>on<span class="nt">&lt;/AuthRequired&gt;</span>
            <span class="nt">&lt;/Protocol&gt;</span>
            <span class="nt">&lt;Protocol&gt;</span>
                <span class="nt">&lt;Type&gt;</span>SMTP<span class="nt">&lt;/Type&gt;</span>
                <span class="nt">&lt;Server&gt;</span>mail.example.com<span class="nt">&lt;/Server&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="nt">&lt;Port&gt;</span>465<span class="nt">&lt;/Port&gt;</span>
                <span class="nt">&lt;DomainRequired&gt;</span>on<span class="nt">&lt;/DomainRequired&gt;</span>
                <span class="nt">&lt;LoginName&gt;</span><span class="cp">&lt;?php echo $user; ?&gt;</span><span class="nt">&lt;/LoginName&gt;</span>
                <span class="nt">&lt;SPA&gt;</span>off<span class="nt">&lt;/SPA&gt;</span>
                <span class="nt">&lt;Encryption&gt;</span>Auto<span class="nt">&lt;/Encryption&gt;</span>
                <span class="c">&lt;!-- if your server requires encryption other than SSL --&gt;</span>
                <span class="nt">&lt;AuthRequired&gt;</span>on<span class="nt">&lt;/AuthRequired&gt;</span>
                <span class="nt">&lt;UsePOPAuth&gt;</span>on<span class="nt">&lt;/UsePOPAuth&gt;</span>
                <span class="nt">&lt;SMTPLast&gt;</span>off<span class="nt">&lt;/SMTPLast&gt;</span>
            <span class="nt">&lt;/Protocol&gt;</span>
        <span class="nt">&lt;/Account&gt;</span>
    <span class="nt">&lt;/Response&gt;</span>
<span class="nt">&lt;/Autodiscover&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Changez les permissions comme pour le rÃ©pertoire</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>644 autoconfig/Autodiscover/Autodiscover.xml
<span class="nb">chown </span>web1:client0 autoconfig/Autodiscover/Autodiscover.xml <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer web1:client0 par les permissions du rÃ©pertoire <code>/var/www/autoconfig.example.com</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointer votre navigateur sur le site <a href="https://autodiscover.example.com/Autodiscover/Autodiscover.xml" class="bare">https://autodiscover.example.com/Autodiscover/Autodiscover.xml</a>.</p>
</li>
<li>
<p>Le contenu du fichier xml doit s&#8217;afficher</p>
</li>
<li>
<p>Dans le rÃ©pertoire <code>/var/www/autoconfig.&lt;example.com&gt;/autoconfig/</code>, Editez un fichier <code>autodiscover.json</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi autoconfig/Autodiscover/autodiscover.json</code></pre>
</div>
</div>
</li>
<li>
<p>Y coller:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: application/json'</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">'{"Protocol":"AutodiscoverV1","Url":"https://autodiscover.example.com/Autodiscover/Autodiscover.xml"}'</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Changez les permissions comme pour le rÃ©pertoire</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>644 autoconfig/Autodiscover/autodiscover.json
<span class="nb">chown </span>web1:client0 autoconfig/Autodiscover/autodiscover.json <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">cp</span> <span class="nt">-pr</span> autoconfig/Autodiscover autoconfig/autodiscover</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer web1:client0 par les permissions du rÃ©pertoire <code>/var/www/autoconfig.example.com</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointer votre navigateur sur le site <a href="https://autodiscover.example.com/autodiscover/autodiscover.json" class="bare">https://autodiscover.example.com/autodiscover/autodiscover.json</a></p>
</li>
<li>
<p>Le contenu du fichier json doit s&#8217;afficher</p>
</li>
<li>
<p>Vous pouvez faire aussi un test sur le <a href="https://testconnectivity.microsoft.com">Testeur de connectivitÃ© Microsoft</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>choisissez: <code>DÃ©couverte automatique Outlook</code></p>
</li>
<li>
<p>cliquez sur <code>suivant</code></p>
</li>
<li>
<p>Entrez votre adresse de courrier: <code>user@example.com</code>, un domain: <code>example\user</code>, un mot de passe tirÃ© au hazard, Cochez les deux cases en dessous.</p>
</li>
<li>
<p>Cliquez sur <code>effectuer un test</code></p>
</li>
<li>
<p>Le rÃ©sultat doit Ãªtre: <code>Test de connectivitÃ© rÃ©ussi</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_dune_boite_mail">14.7. CrÃ©ation dâune boite mail</h3>
<div class="paragraph">
<p>Pour crÃ©er une boite de messagerie:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aller dans la rubrique <code>Email</code>. SÃ©lectionnez ensuite le menu <code>Email Mailbox</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Mailbox</code></p>
</li>
<li>
<p>Remplissez les champs suivants:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Name:</code> &#8592; mettez votre prÃ©nom et votre nom</p>
</li>
<li>
<p><code>`Email:</code> &#8592; saisir le &lt;mail_name&gt; <code>mail_name@example.com</code></p>
</li>
<li>
<p><code>Password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a> ou gÃ©nÃ©rez en un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password</code> &#8592; saisissez une deuxiÃ¨me fois votre mot de passe</p>
</li>
<li>
<p><code>Quota (0 for unlimited):</code> &#8592; mettez Ã©ventuellement un quota ou laissez 0 pour illimitÃ©.</p>
</li>
<li>
<p><code>Spamfilter:</code> &#8592; SÃ©lectionnez <code>Normal</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Dans lâonglet Backup:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>Backup interval:</code> SÃ©lectionnez <code>Daily</code></p>
</li>
<li>
<p><code>Number of backup copies:</code> SÃ©lectionnez 1</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notez que si vous crÃ©ez une adresse mail nommÃ©e <code>mail_name@example.com</code>, vous pouvez utilisez toutes les variantes (nommÃ©es tag) derriÃ¨re le caractÃ¨re "+". Ainsi <code>mail_name+nospam@example.com</code> sera bien redirigÃ© vers votre boite et l&#8217;extension <code>+nospam</code> vous permettre de trier automatiquement les mails que vous ne voulez pas recevoir.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est possible de changer ce caractÃ¨re spÃ©cial en le modifiant dans le fichier <code>/etc/postfix/main.cf</code> sur la ligne commenÃ§ant par <code>recipient_delimiter</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_de_votre_client_de_messagerie">14.8. Configuration de votre client de messagerie.</h3>
<div class="paragraph">
<p>Saisir l&#8217;adresse mail et votre mot de passe doit suffire pour configurer automatiquement votre client de messagerie.</p>
</div>
<div class="paragraph">
<p>Si vous avez besoin de configurer votre client manuellement, voici les informations Ã  saisir:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ParamÃ¨tre</th>
<th class="tableblock halign-left valign-top">Valeur</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type de serveur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nom de serveur IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nom d&#8217;utilisateur IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:user@example.com">user@example.com</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ©curitÃ© IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentification IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal Password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nom de serveur SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nom d&#8217;utilisateur SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:user@example.com">user@example.com</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">465</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SÃ©curitÃ© SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL/TLS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentification SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal Password</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_mise_en_oeuvre_du_site_web_de_webmail">14.9. Mise en oeuvre du site web de webmail</h3>
<div class="paragraph">
<p>On suppose que vous avez install roundcube lors de la procÃ©dure d&#8217;installation initiale et que vous avez dÃ©jÃ  crÃ©Ã© le host <code>mail.example.com</code> .</p>
</div>
<div class="paragraph">
<p>Il vous reste Ã  appliquer la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>mail</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>mail</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># redirect from server</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">SSLProxyEngine</span> <span class="ss">On</span> <span class="c"># Comment this out if no https required</span>
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">SSLProxyVerify</span> <span class="ss">none</span>
<span class="nc">SSLProxyCheckPeerCN</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerName</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerExpire</span> <span class="ss">off</span>

<span class="nc">ProxyPass</span> /webmail https://localhost:8080/webmail/
<span class="nc">ProxyPass</span> / https://localhost:8080/webmail/
<span class="nc">ProxyPassReverse</span> / https://localhost:8080/webmail/

<span class="nc">RedirectMatch</span> ^/$ https://mail.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>C&#8217;est fait, vous pouvez accÃ©der Ã  Roundcube directement sur <a href="https://mail.example.com" class="bare">https://mail.example.com</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_transfert_de_vos_boites_mails_imap">14.10. Transfert de vos boites mails IMAP</h3>
<div class="paragraph">
<p>Si vous faites une migration d&#8217;un ancien serveur vers un nouveau serveur vous souhaiterez probablement migrer aussi vos boites mail.</p>
</div>
<div class="paragraph">
<p>La procÃ©dure ci dessous est Ã  appliquer pour chaque compte mail IMAP. Elle peut facilement Ãªtre scriptÃ©e.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>TÃ©lÃ©chargez imapsync du repository. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre>wget https://raw.githubusercontent.com/imapsync/imapsync/master/imapsync
chmod 755 imapsync</pre>
</div>
</div>
</li>
<li>
<p>Installez les packages perls Ã©ventuellement manquants:</p>
<div class="listingblock">
<div class="content">
<pre>apt install libregexp-common-perl libfile-tail-perl libsys-meminfo-perl libunicode-string-perl libmail-imapclient-perl libio-tee-perl libio-socket-inet6-perl libfile-copy-recursive-perl libencode-imaputf7-perl</pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez deux fichiers temporaires qui contiennent les mots de passe du 1er et  2eme serveur. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre>echo "passwdsrc" &gt; secretsrc <i class="conum" data-value="1"></i><b>(1)</b>
echo "passwddst" &gt; secretdst <i class="conum" data-value="2"></i><b>(2)</b>
chmod 600 secretsrc
chmod 600 secretdst</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>passwdsrc est Ã  remplacer par le mot de passe du compte sur le serveur source</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>passwddst est Ã  remplacer par le mot de passe du compte sur le serveur destination</td>
</tr>
</table>
</div>
</li>
<li>
<p>Nous pouvons maintenant lancer la commande. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre>./imapsync --host1 imap.examplesrc.com --user1 usersrc@examplesrc.com --passfile1 secretsrc --host2 imap.exampledst.com --user2 userdst@exampledst.com --passfile2 secretdst --addheader</pre>
</div>
</div>
</li>
<li>
<p>Un fois la synchronisation effectuÃ©e, vous pouvez supprimer le fichier des mots de passe. tapez:</p>
<div class="listingblock">
<div class="content">
<pre>rm secretsrc
rm secretdst</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_docker_et_des_outils_associÃ©s">15. Installation de Docker et des outils associÃ©s</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le logiciel <code>Docker</code> est une technologie de conteneurisation qui permet la crÃ©ation et l&#8217;utilisation de conteneurs Linux.
En clair, <code>Docker</code> permet d&#8217;installer et de configurer rapidement toute une appli web complexe dans un environnement isolÃ© et avec tout son Ã©chosystÃ¨me de bibliothÃ¨ques logicielles spÃ©cifiques.</p>
</div>
<div class="paragraph">
<p>Il est ainsi possible d&#8217;effectuer rapidement des installations, de suivre des mises Ã  jours et d&#8217;isoler ces environnements du systÃ¨me principal.</p>
</div>
<div class="sect2">
<h3 id="_a_propos_des_raspberry_pi">15.1. A propos des Raspberry Pi</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Les raspberry utilisent une architecture ARM, tous les containeurs ne seront pas forcÃ©ment compatibles "out of the box" ( Exemple pour MySQL). Sur le <a href="https://hub.docker.com/">Docker Hub</a>, il faut choisir par un Raspberry Pi 4 ou 5 en Ubuntu une architecture de type ARM64 et pour un Raspberry Pi 3 en Raspbian une architecture de type ARM.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_docker">15.2. Installation de Docker</h3>
<div class="paragraph">
<p>L&#8217;installation de Docker est relativement simple.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>DÃ©sinstallez les Ã©ventuelles anciennes versions de docker. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt remove <span class="nt">--purge</span> docker docker.io containerd runc docker-doc docker-compose podman-docker <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>docker-engine n&#8217;existe pas dans une distribution ubuntu. C&#8217;est Ã  enlever.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Add Docker's official GPG key:</span>
apt-get update
apt-get <span class="nb">install </span>ca-certificates curl
<span class="nb">install</span> <span class="nt">-m</span> 0755 <span class="nt">-d</span> /etc/apt/keyrings
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/debian/gpg <span class="nt">-o</span> /etc/apt/keyrings/docker.asc
<span class="nb">chmod </span>a+r /etc/apt/keyrings/docker.asc

<span class="c"># Add the repository to Apt sources:</span>
<span class="nb">echo</span> <span class="se">\</span>
  <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian </span><span class="se">\</span><span class="s2">
  </span><span class="si">$(</span><span class="nb">.</span> /etc/os-release <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$VERSION_CODENAME</span><span class="s2">"</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="se">\</span>
  <span class="nb">tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null</code></pre>
</div>
</div>
</li>
<li>
<p>Une fois installÃ© avec succÃ¨s, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Si vous obtenez une erreur c&#8217;est que vous avez ajoutÃ© un repository qui n&#8217;est pas suppportÃ© par Docker. VÃ©rifiez les fichier <code>/etc/apt/sources.list</code>.</p>
</li>
<li>
<p>Une fois mis Ã  jour avec succÃ¨s, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install </span>docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></pre>
</div>
</div>
</li>
<li>
<p>vÃ©rifiez que votre installation de <code>Docker</code> est fonctionnelle. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run hello-world</code></pre>
</div>
</div>
</li>
<li>
<p>Cette commande exÃ©cute un conteneur simple. Si aucune erreur nâapparaÃ®t c&#8217;est que l&#8217;installation est rÃ©ussie.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_docker_swarm">15.3. Installation de docker swarm</h3>
<div class="paragraph">
<p>Docker contient nativement le mode Swarm afin de gÃ©rer un ensemble de Docker Engines.
Cette installation est optionnelle puisque l&#8217;on peut faire fonctionner Docker sans cette Option.</p>
</div>
<div class="paragraph">
<p>Il y a deux types de machines: les <strong>Managers</strong> et les <strong>Workers</strong>.</p>
</div>
<div class="paragraph">
<p>Les managers : Ce sont les nodes gestionnaires de votre cluster. Ils distribuent les tÃ¢ches aux nodes workers et ils effectuent Ã©galement les fonctions d&#8217;orchestration et de gestion.</p>
</div>
<div class="paragraph">
<p>Les workers : Ils vont exÃ©cuter les tÃ¢ches confiÃ©es par les managers. Un agent s&#8217;exÃ©cute sur chaque nÅud et rend compte des tÃ¢ches qui lui sont affectÃ©es. Il informe ainsi les nodes managers de l&#8217;Ã©tat des tÃ¢ches affectÃ©es.</p>
</div>
<div class="paragraph">
<p>Il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker swarm init</code></pre>
</div>
</div>
</li>
<li>
<p>Le rÃ©sultat de la commande donne la commande <code>docker swarm join</code> a exÃ©cuter sur un "worker"  pour lui faire rejoindre le "swarm". A noter que le "manager" que nous venons de creer est aussi un worker. De ce fait, un swarm peut Ãªtre installÃ© de faÃ§on standalone sur un VPS.</p>
</li>
<li>
<p>Vous pouvez maintenant vÃ©rifier l&#8217;Ã©tat de votre cluster. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker node <span class="nb">ls</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_choix_des_images_docker">15.4. Choix des images docker</h3>
<div class="paragraph">
<p>Les images docker sont accessibles sur le <a href="https://hub.docker.com/">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>Mais voilÃ , c&#8217;est un peu la jungle. Un bon moyen de trouver des images Ã  jour d&#8217;un point de vue sÃ©curitÃ© et non compromises est de ne sÃ©lectionner que des images "Docker Certified" ou "Verified Publisher" ou "Official Images".</p>
</div>
<div class="paragraph">
<p>Du moins on est sÃ»r que ces images ont Ã©tÃ© Ã  minima vÃ©rifiÃ©es par les Ã©quipes Docker.</p>
</div>
<div class="paragraph">
<p>Pour mÃ©moire: <strong>Le nombre de chargement d&#8217;une image n&#8217;est pas un gage de qualitÃ© !</strong></p>
</div>
<div class="paragraph">
<p>Si vous n&#8217;utilisez pas une image du type mentionnÃ© ci dessus, l&#8217;accÃ¨s facile au fichier Dockerfile est un gage de qualitÃ© et de transparence. En tout cas, il vous sera facilement possible de regarder comment l&#8217;image est construite et quels sont les package dockers de base et si ces packages dockers de base sont rÃ©cents et certifiÃ©s.</p>
</div>
<div class="paragraph">
<p>Pour les plateformes de type Raspberry, il faut bien vÃ©rifier que l&#8217;image docker que vous chargez est compatible de votre plateforme. Sur Docker Hub, vous devez allez sur l&#8217;onglet Tag de votre package et vÃ©rifier que le champ OS/ARCH contient bien votre plateforme.</p>
</div>
<div class="paragraph">
<p>Pour un Raspberry Pi 4 ou 5 ce doit Ãªtre: <code>Linux/arm64</code></p>
</div>
<div class="paragraph">
<p>Pour un Raspberry Pi 3 ce doit Ãªtre: <code>Linux/arm</code></p>
</div>
<div class="paragraph">
<p>Par exemple pour les docker de <code>Yacht</code> et de <code>Portainer</code> dÃ©crits ci aprÃ¨s, on peut voir que les containers sont multiplateforme et conviennent trÃ¨s bien pour de l&#8217;Intel ou de l&#8217;ARM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_considÃ©rations_de_sÃ©curitÃ©">15.5. ConsidÃ©rations de sÃ©curitÃ©</h3>
<div class="paragraph">
<p>A propos de l&#8217;export des ports sous docker.</p>
</div>
<div class="paragraph">
<p>Par dÃ©faut lorsque vous lancez un container docker, l&#8217;option pour exporter un port de votre docker vers votre machine est <code>-p dst_port:src_port</code>.
Si vous indiquez uniquement le port de destination comme par exemple dans <code>-p 80:8080</code> qui exporte le port 8080 de votre docker vers le port 80 de votre machine rÃ©elle, vous exporter vers le port 80 de l&#8217;adresse IP 0.0.0.0 ce qui en pratique indique que vous n&#8217;utilisez pas les rÃ¨gles du firewall; le port est exportÃ© automatiquement sur toutes les interfaces.</p>
</div>
<div class="paragraph">
<p>De ce fait, vous exposez tous les ports interne de votre systÃ¨me docker Ã  tout internet et le firewall ne bloque rien pour ces ports.</p>
</div>
<div class="paragraph">
<p>Il est donc indispensable pour une machine directement exposÃ©e sur internet d&#8217;indiquer l&#8217;adresse du loopback en indiquant systÃ©matiquement l&#8217;adresse IP soit <code>-p 127.0.0.1:80:8080</code>. Ainsi les rÃ¨gles du firewall sont appliquÃ©es et vous pourrez par votre configuration d&#8217;ISPconfig n&#8217;exposer que les ports et noms de domaines nÃ©cessaires.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Dans tout ce qui suit nous omettrons d&#8217;utiliser cette adresse en 127.0.0.1 . Pensez bien donc Ã  ajouter cette adresse systÃ©matiquement pour un serveur prÃ©sent sur le web !
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mise_Ã _jour_automatique_des_images">15.6. Mise Ã  jour automatique des images</h3>
<div class="paragraph">
<p>Vos images docker peuvent Ãªtre mise Ã  jour automatiquement si vous les avez installÃ©s Ã  partir du docker hub ou de n&#8217;importe quel autre repository compatible.</p>
</div>
<div class="paragraph">
<p>Un outil automatise cette mise Ã  jour c&#8217;est <a href="https://github.com/containrrr/watchtower">watchtower</a>.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;installer, rien de plus simple:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> watchtower <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower <span class="nt">--cleanup</span> <span class="nt">--interval</span> 86400</code></pre>
</div>
</div>
</li>
<li>
<p>l&#8217;option cleanup effectue le mÃ©nage des images inutiles et interval indique en secondes le temps Ã  attendre entre deux vÃ©rifications (ici 24h)</p>
</li>
<li>
<p>si vous voulez vous connecter Ã  un repository avec un login et un mot de passe, vous pouvez ajouter au lancement du docker les options suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nt">-e</span> <span class="nv">REPO_USER</span><span class="o">=</span>username <span class="nt">-e</span> <span class="nv">REPO_PASS</span><span class="o">=</span>password</code></pre>
</div>
</div>
</li>
<li>
<p>Si vous dÃ©sirez ne mettre Ã  jour que certains containers, vous pouvez passer l&#8217;option <code>--label-enable</code> et ensuite dÃ©signer les container Ã  mettre Ã  jour en leur passant le label <code>-l com.centurylinklabs.watchtower.enable=true</code></p>
</li>
<li>
<p>Enfin derniÃ¨re option trÃ¨s utile la possibilitÃ© de dÃ©cider de la pÃ©riode de mise Ã  jour Ã  l&#8217;aide d&#8217;une expression de type cron. Comme exemple: <code>--schedule "0 0 4 * * *"</code> mettra Ã  jour Ã  0h0 tous les 4 de chaque mois.</p>
</li>
<li>
<p>Enfin lorsqu&#8217;une mise Ã  jour s&#8217;effectue vous pouvez Ãªtre notifiÃ© par mail, slack ou d&#8217;autres outils tels que shoutrrr. Se rÃ©fÃ©rer Ã  la <a href="https://containrrr.dev/watchtower/notifications/">documentation</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_surveillance_et_redÃ©marrage_de_container">15.7. Surveillance et redÃ©marrage de container</h3>
<div class="paragraph">
<p>Il peut arriver que certains container s&#8217;arrÃªtent brusquement suite Ã  un bug.</p>
</div>
<div class="paragraph">
<p>Autoheal est unn outil qui redÃ©marre ces container automatiquement en se basant sur l&#8217;attribut healthcheck des containers.</p>
</div>
<div class="paragraph">
<p>La documentation est <a href="https://github.com/willfarrell/docker-autoheal">ici</a>.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;installer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--name</span> autoheal <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-e</span> <span class="nv">AUTOHEAL_CONTAINER_LABEL</span><span class="o">=</span>all <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock willfarrell/autoheal</code></pre>
</div>
</div>
</li>
<li>
<p>La variable d&#8217;environnement AUTOHEAL_CONTAINER_LABEL indique que tous les containers seront vÃ©rifiÃ©s. Si vous souhaitez uniquement indiquer les container Ã  vÃ©rifier, il vous faut ajouter pour les container concernÃ©s l&#8217;otion <code>-l autoheal=true</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_de_docker_mirror">16. Configuration de Docker-mirror</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;outil Docker-mirror est un systÃ¨me de cache de fichier Dockers.</p>
</div>
<div class="paragraph">
<p>Si vous avez plusieurs machines utilisant docker sur votre rÃ©seau, les dÃ©ploiements et les mises Ã  jour seront considÃ©rablement accÃ©lÃ©rÃ©es par l&#8217;utilisation de ce systÃ¨me de cache.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Obtenez une configuration initiale pour le fichier <code>config.yml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--entrypoint</span> <span class="nb">cat </span>registry:2 /etc/docker/registry/config.yml <span class="o">&gt;</span> /etc/docker-mirror.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ceci dans le fichier <code>config.yml</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/docker-mirror-1.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Dans ce fichier, ajoutez les lignes suivantes :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>proxy:
      remoteurl: https://registry-1.docker.io</code></pre>
</div>
</div>
</li>
<li>
<p>DÃ©marrez ensuite le service docker. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-p</span> 5000:5000 <span class="nt">--name</span> docker-registry-proxy-1 <span class="nt">-v</span> /etc/docker-mirror-1.yml:/etc/docker/registry/config.yml registry:2</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si vous avez plusieurs miroirs Ã  configurer, il faut crÃ©er un proxy sur chaque. Ainsi si vous voulez crÃ©er un miroir pour ghcr.io il vous faudra crÃ©er une autre fichier docker-mirror-2.yml avec la deuxiÃ¨me adresse remote et lancer le tout par:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-p</span> 5001:5000 <span class="nt">--name</span> docker-registry-proxy-2 <span class="nt">-v</span> /etc/docker-mirror-2.yml:/etc/docker/registry/config.yml registry:2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Et ainsi de suite pour chaque proxy que vous voulez mettre en place.</p>
</div>
<div class="paragraph">
<p>Sur le poste client, soit passez l&#8217;option --registry-mirror lorsque vous lancez le dÃ©mon <code>dockerd</code> ou sinon Ã©ditez le fichier <code>/etc/docker/daemon.json</code> et ajoutez la clÃ© <code>registry-mirrors</code> pour rendre le changement persistant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le poste client</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/docker/daemon.json</code></pre>
</div>
</div>
</li>
<li>
<p>Dans le fichier, ajoutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>{
  "insecure-registries" : ["docker.example.com:5000" ], <i class="conum" data-value="1"></i><b>(1)</b>
  "registry-mirrors": ["http://docker.example.com:5000"] <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>docker.example.com</code> par le nom ou l&#8217;adresse ip de votre cache docker. Si vous en avez plusieurs vous devez tous les lister en les sÃ©parant par des virgules.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Sauvegarder le fichier et redÃ©marrez le dÃ©mon docker. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart docker</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outils_web_de_gestion_des_containers">17. Outils web de gestion des containers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_de_yacht">17.1. Installation de Yacht</h3>
<div class="paragraph">
<p>Yacht est un outil d&#8217;administration de vos instances docker sous forme de site web. Yacht est trÃ¨s facile d&#8217;utilisation mais manque de possibilitÃ©s du moins dans la version actuelle. Si vous souhaitez administrer de faÃ§on plus avancÃ©e vos instances docker, il est conseillÃ© d&#8217;utiliser Portainer.</p>
</div>
<div class="paragraph">
<p>Yacht sâinstalle comme un conteneur docker pour simplifier son dÃ©ploiement.</p>
</div>
<div class="paragraph">
<p>Pour la crÃ©ation du site web, il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans ISPConfig dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>yacht</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>yacht</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>yacht</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># yacht httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:8061/
<span class="nc">ProxyPassReverse</span> / http://localhost:8061/

<span class="nc">RedirectMatch</span> ^/$ https://yacht.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Puis sur votre serveur, <a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create yacht_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 8061:8000 <span class="nt">--name</span><span class="o">=</span>yacht <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> yacht_data:/config selfhostedpro/yacht</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://yacht.example.com" class="bare">http://yacht.example.com</a></p>
</li>
<li>
<p>L&#8217;utilisateur par dÃ©faut est login: <code>admin@yacht.local</code> et mot de passe: <code>pass</code>.</p>
</li>
<li>
<p>Une fois logguÃ©, Cliquez sur l&#8217;utilisateur en haut Ã  droite et <code>user</code>.</p>
</li>
<li>
<p>Cliquez sur <code>change password</code></p>
</li>
<li>
<p>Modifier votre Email de login et saisissez un nouveau mot de passe.</p>
</li>
<li>
<p>Cliquez ensuite sur <code>Templates</code> dans la barre vertical de gauche puis sur <code>New templates</code></p>
</li>
<li>
<p>Copiez la suggestion de template proposÃ©e.</p>
</li>
<li>
<p>Saisissez un titre <code>Yacht</code> dans le champ <code>Title</code> puis collez l&#8217;URL du json dans le champ <code>URL</code></p>
</li>
<li>
<p>Cliquez sur Submit.</p>
</li>
<li>
<p>Allez dans <code>Templates</code> &#8594; <code>View Templates</code>.</p>
</li>
<li>
<p>cliquez sur <code>Yacht</code>; vous avez maintenant accÃ¨s Ã  une foule de templates.</p>
</li>
<li>
<p>Vous pouvez maintenant administrer vos machines docker. RÃ©fÃ©rez vous Ã  la documentation de <a href="https://yacht.sh/Pages/dashboard/">Yacht</a> pour installer de nouvelles machines docker</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="yacht_container_updt">17.2. Upgrade d&#8217;un container dans Yacht</h3>
<div class="paragraph">
<p>PlutÃ´t que dâeffectuer des mises Ã  jour automatiques avec Watchtower, vous prÃ©fÃ©rerez mettre Ã  jour manuellement avec Yacht.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://yacht.example.com" class="bare">http://yacht.example.com</a></p>
</li>
<li>
<p>Logguez vous en tant qu'`admin`</p>
</li>
<li>
<p>Allez  dans l&#8217;onglet <code>Applications</code></p>
</li>
<li>
<p>Cliquez sur le bouton <code>Updates</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_yacht">17.3. Upgrade de Yacht</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des <a href="#port_container_updt">containers Ã  l&#8217;aide de <code>Portainer</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Yacht. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull selfhostedpro/yacht
docker stop yacht
docker <span class="nb">rm </span>yacht
docker run <span class="nt">-d</span> <span class="nt">-p</span> 8061:8000 <span class="nt">--name</span><span class="o">=</span>yacht <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> yacht_data:/config selfhostedpro/yacht</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_portainer">17.4. Installation de Portainer</h3>
<div class="paragraph">
<p>Portainer est un outil d&#8217;administration de vos instances docker sous forme de site web. Portainer est plus complexe Ã  utiliser que Yacht, mais offre cependant beaucoup plus de possibilitÃ©s.</p>
</div>
<div class="paragraph">
<p>Portainer sâinstalle comme un conteneur docker pour simplifier son dÃ©ploiement. Portainer gÃ¨re une bonne partie des Ã©lÃ©ments de docker : conteneurs, images, volumes, rÃ©seaux, utilisateurs</p>
</div>
<div class="paragraph">
<p>Pour la crÃ©ation du site web, il faut suivre les Ã©tapes suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans ISPConfig dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>portainer</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>portainer</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>portainer</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># portainer httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:9050/
<span class="nc">ProxyPassReverse</span> / http://localhost:9050/

<span class="nc">RedirectMatch</span> ^/$ https://portainer.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Puis sur votre serveur, <a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create portainer_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 9050:9000 <span class="nt">--name</span><span class="o">=</span>portainer <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> portainer_data:/data portainer/portainer-ce</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://portainer.example.com" class="bare">http://portainer.example.com</a></p>
</li>
<li>
<p>CrÃ©ez votre utilisateur de <code>admin</code> avec un mot de passe sÃ©curisÃ©.</p>
</li>
<li>
<p>Ajoutez un endpoint <code>Local</code></p>
</li>
<li>
<p>Vous pouvez maintenant administrer vos machines docker. RÃ©fÃ©rez vous Ã  la documentation de <a href="https://documentation.portainer.io/v2.0/stacks/create/">portainer</a> pour installer de nouvelles machines docker</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Portainer offre la possibilitÃ© d&#8217;installer des templates par dÃ©faut. Vous pouvez soit garder le repository par dÃ©fault : <code><a href="https://raw.githubusercontent.com/portainer/templates/master/templates-2.0.json" class="bare">https://raw.githubusercontent.com/portainer/templates/master/templates-2.0.json</a></code> ou utiliser un autre repository comme: <code><a href="https://raw.githubusercontent.com/Qballjos/portainer_templates/master/Template/template.json" class="bare">https://raw.githubusercontent.com/Qballjos/portainer_templates/master/Template/template.json</a></code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>allez sur votre site web portainer.</p>
</li>
<li>
<p>puis dans le menu Settings</p>
</li>
<li>
<p>Dans la zone <code>App Templates</code> saisissez le repository de votre choix dans le champ <code>URL</code></p>
</li>
<li>
<p>Cliquez sur <code>Save Settings</code></p>
</li>
<li>
<p>retournez dans le menu <code>App Templates</code>; vos nouveau templates sont maintenant affichÃ©s.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="port_container_updt">17.5. Upgrade d&#8217;un container dans Portainer</h3>
<div class="paragraph">
<p>PlutÃ´t que dâeffectuer des mises Ã  jour automatiques avec Watchtower, vous prÃ©fÃ©rerez mettre Ã  jour manuellement avec Portainer.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ouvrez un navigateur et pointez sur <a href="http://portainer.example.com" class="bare">http://portainer.example.com</a></p>
</li>
<li>
<p>Logguez vous en tant qu' <code>admin</code></p>
</li>
<li>
<p>Allez  dans l&#8217;onglet <code>Containers</code></p>
</li>
<li>
<p>Double-cliquez sur le container Ã  mettre Ã  jour</p>
</li>
<li>
<p>Dans le nouvel Ã©cran <code>Container details</code> cliquez sur l&#8217;icone <code>recreate</code></p>
</li>
<li>
<p>SÃ©lectionnez <code>Pull latest image</code> et cliquez <code>recreate</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_portainer">17.6. Upgrade de Portainer</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Yacht. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull portainer/portainer-ce
docker stop portainer
docker <span class="nb">rm </span>portainer
docker run <span class="nt">-d</span> <span class="nt">-p</span> 9050:9000 <span class="nt">--name</span><span class="o">=</span>portainer <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="nt">-v</span> portainer_data:/data portainer/portainer-ce</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_des_cms_joomla">18. Installation des CMS Joomla</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Joomla est un CMS trÃ¨s connu Ã©crit en PHP. Il est frÃ©quemment mis Ã  jour et inclut une foule de plugins</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_joomla">18.1. CrÃ©ation du site web de Joomla</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>joomla</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>joomla</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>joomla</code>.</p>
</li>
<li>
<p>Pour <code>Auto-Subdomain</code> sÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es">18.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>joomla</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>joomla</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxjoomla</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_lapplication_joomla">18.3. CrÃ©ation de l&#8217;application Joomla</h3>
<div class="paragraph">
<p>La procÃ©dure d&#8217;installation officielle de Joomla se trouve <a href="https://docs.joomla.org/J3.x:Installing_Joomla">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://downloads.joomla.org/">Joomla</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil en format tarball.</p>
</li>
<li>
<p>Installez Joomla. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
wget <span class="nt">-O</span> joomla.tar.gz https://downloads.joomla.org/cms/joomla3/3-9-26/Joomla_3-9-26-Stable-Full_Package.tar.gz?format<span class="o">=</span>gz <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">cd</span> /var/www/joomla.example.com/joomla/ <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">tar</span> <span class="nt">-xvzf</span> /tmp/joomla.tar.gz
<span class="nb">rm</span> /tmp/joomla.tar.gz
<span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/joomla.example.com/joomla  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de joomla.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de joomla</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>coller ici l&#8217;adresse de tÃ©lÃ©chargement rÃ©cupÃ©rÃ©e sur le site de Joomla.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://joomla.example.com" class="bare">https://joomla.example.com</a>.</p>
</li>
<li>
<p>Dans l&#8217;onglet <code>configuration</code> :</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Choisissez votre langue <code>fr</code>.</p>
</li>
<li>
<p><code>Nom du site</code> &#8592; mettez le nom de votre site web</p>
</li>
<li>
<p><code>Description</code> &#8592; mettez une description courte de votre site</p>
</li>
<li>
<p><code>Email</code> &#8592; indiquez votre email d&#8217;admin</p>
</li>
<li>
<p>Saisissez le <code>identifiant</code> du compte administrateur</p>
</li>
<li>
<p>Saisissez 2 fois <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> dans <code>mot de passe</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez <code>suivant</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Choisissez une base <code>MySQLi</code></p>
</li>
<li>
<p>mettez <code>Localhost</code> comme <code>Nom du serveur</code></p>
</li>
<li>
<p>Dans le <code>nom d&#8217;utilisateur</code>  mettez <code>cxjoomla</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>mot de passe</code> saisissez le mot de passe de crÃ©Ã© pour la base.</p>
</li>
<li>
<p>Dans le <code>nom de la base de donnÃ©es</code> mettez <code>cxjoomla</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Vous pouvez laisser le prefixe des tables ou mettre Ã  vide si votre base est dÃ©diÃ©e.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez <code>suivant</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Dans l&#8217;Ã©cran suivant, vous choisissez le <code>type de site</code></p>
</li>
<li>
<p>VÃ©rifiez votre configuration</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez <code>suivant</code></p>
</li>
<li>
<p>L&#8217;installation s&#8217;effectue. Une fois terminÃ©e avec succÃ¨s, vous pouvez dÃ©cider d&#8217;installer des langues</p>
</li>
<li>
<p>N&#8217;oubliez pas ensuite de supprimer le rÃ©pertoire <code>installation</code> en cliquant sur le bouton <code>Supprimer le rÃ©pertoire</code></p>
</li>
<li>
<p>Cliquez ensuite sur le bouton <code>Administration</code> pour continuer Ã  configurer votre site ou sur <code>Site</code> pour voir votre installation par dÃ©faut</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_joomla">18.4. Update de Joomla</h3>
<div class="paragraph">
<p>La mise Ã  jour de Joomla s&#8217;effectue au travers du portail d&#8217;administration
Joomla vous prÃ©vient d&#8217;un mise Ã  jour du moteur et vous propose de le mettre Ã  jour.
CLiquez sur le lien qui vous est prÃ©sentÃ© dans l&#8217;interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_des_cms_concrete5">19. Installation des CMS Concrete5</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Concrete5 est un CMS trÃ¨s connu Ã©crit en PHP. Il est frÃ©quemment mis Ã  jour et permet une configuration wysiwyg</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_concrete5">19.1. CrÃ©ation du site web de Concrete5</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>Concrete5</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>Concrete5</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>Concrete5</code>.</p>
</li>
<li>
<p>Pour <code>Auto-Subdomain</code> sÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_2">19.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>Concrete5</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>Concrete5</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxConcrete5</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_lapplication_concrete5">19.3. CrÃ©ation de l&#8217;application Concrete5</h3>
<div class="paragraph">
<p>La procÃ©dure d&#8217;installation officielle de Concrete5 se trouve <a href="https://documentation.concrete5.org/developers/introduction/installation">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://www.concrete5.org/download">Concrete5</a> et tÃ©lÃ©chargez la derniÃ¨re version de l&#8217;outil en format zip.</p>
</li>
<li>
<p>Uploader ce fichier dans votre rÃ©pertoire /tmp de votre serveur au moyen de filezilla</p>
</li>
<li>
<p>Installez Concrete5. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
unzip concrete5-8.5.5.zip <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">mv </span>concrete5-8.5.5/<span class="k">*</span> /var/www/concrete5.example.com/concrete5/  <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">rm</span> <span class="nt">-rf</span> concrete5-8.5.5 <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">rm </span>concrete5-8.5.5.zip <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/concrete5.example.com/concrete5  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de concrete5.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de concrete5</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>le nom du fichier zip dÃ©pend de la version que vous avez tÃ©lÃ©chargÃ©. De mÃªme le nom du rÃ©pertoire est dÃ©pendant de la version.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://concrete5.example.com" class="bare">https://concrete5.example.com</a>.</p>
</li>
<li>
<p>Choisissez votre langue <code>franÃ§ais</code>.</p>
</li>
<li>
<p>Le systÃ¨me check que la configuration est correcte.</p>
</li>
<li>
<p>Cliquez sur <code>continuer l&#8217;installation</code></p>
</li>
<li>
<p><code>Nom</code> &#8592; saisissez le nom de votre site</p>
</li>
<li>
<p><code>Adresse de courriel administrateur</code> &#8592; indiquez votre email d&#8217;admin</p>
</li>
<li>
<p>Saisissez 2 fois <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> dans <code>Mot de passe administrateur</code></p>
</li>
<li>
<p>Choisissez le <code>point de dÃ©part</code></p>
</li>
<li>
<p>mettez <code>Localhost</code> comme <code>Serveur</code></p>
</li>
<li>
<p>Dans le <code>Utilisateur MySQL</code>  mettez <code>cxconcrete5</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>Mot de passe MySQL</code> saisissez le mot de passe de crÃ©Ã© pour la base.</p>
</li>
<li>
<p>Dans le <code>nom de la base de donnÃ©es</code> mettez <code>cxconcrete5</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Cliquez sur la case Ã  cocher de la <code>politique de confidentialitÃ©</code></p>
</li>
<li>
<p>Cliquez <code>Installer Concrete5</code></p>
</li>
<li>
<p>L&#8217;installation s&#8217;effectue. Une fois terminÃ©e avec succÃ¨s, Cliquez sur <code>Modifier votre site</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_concrete5">19.4. Update de concrete5</h3>
<div class="paragraph">
<p>La mise Ã  jour de concrete5 s&#8217;effectue au travers du portail d&#8217;administration
concrete5 vous prÃ©vient d&#8217;un mise Ã  jour du moteur et vous propose de le mettre Ã  jour.
Cliquez sur le lien qui vous est prÃ©sentÃ© dans l&#8217;interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_portail_wiki_mediawiki">20. Installation du portail wiki Mediawiki</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mediawiki est le portail wiki mondialement connu et utilisÃ© notamment pour le site wikipedia.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_mediawiki">20.1. CrÃ©ation du site web de Mediawiki</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>mediawiki</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>mediawiki</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>mediawiki</code>.</p>
</li>
<li>
<p>Pour <code>Auto-Subdomain</code> sÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_3">20.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>mediawiki</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>mediawiki</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxmediawiki</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_lapplication_mediawiki">20.3. CrÃ©ation de l&#8217;application Mediawiki</h3>
<div class="paragraph">
<p>La procÃ©dure d&#8217;installation officielle de Mediawiki se trouve <a href="https://www.mediawiki.org/wiki/Manual:Installation_guide">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://www.mediawiki.org/wiki/Download">Mediawiki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil en format tarball.</p>
</li>
<li>
<p>Installez Mediawiki. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
wget <span class="nt">-O</span> mediawiki.tar.gz https://releases.wikimedia.org/mediawiki/1.35/mediawiki-1.35.2.tar.gz <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">tar</span> <span class="nt">-xvzf</span> mediawiki.tar.gz <i class="conum" data-value="4"></i><b>(4)</b>
<span class="nb">mv </span>mediawiki-1.35.2/<span class="k">*</span> /var/www/mediawiki.example.com/mediawiki/  <i class="conum" data-value="4"></i><b>(4)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">rm </span>mediawiki.tar.gz
<span class="nb">rm</span> <span class="nt">-rf</span> mediawiki-1.35.2 <i class="conum" data-value="4"></i><b>(4)</b>
<span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/mediawiki.example.com/mediawiki  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de mediawiki.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de mediawiki</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>coller ici l&#8217;adresse de tÃ©lÃ©chargement rÃ©cupÃ©rÃ©e sur le site de Mediawiki.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>le nom du fichier tar.gz dÃ©pend de la version que vous avez tÃ©lÃ©chargÃ©. De mÃªme le nom du rÃ©pertoire est dÃ©pendant de la version.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://mediawiki.example.com" class="bare">https://mediawiki.example.com</a>.</p>
</li>
<li>
<p>Cliquez sur <code>set up the wiki</code>.La procÃ©dure d&#8217;installation se dÃ©clenche :</p>
</li>
<li>
<p>Choisissez votre langue <code>fr</code>. Cliquez sur <code>continuer</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>L&#8217;environnement est vÃ©rifiÃ©. Assurez vous que le texte <code>Lâenvironnement a Ã©tÃ© vÃ©rifiÃ©. Vous pouvez installer MediaWiki.</code> s&#8217;affiche.</p>
</li>
<li>
<p>Choisissez une base <code>MariaDB</code></p>
</li>
<li>
<p>mettez <code>Localhost</code> comme nom d&#8217;hote de la Base</p>
</li>
<li>
<p>Dans le <code>nom de la base de donnÃ©es</code> mettez <code>cxmediawiki</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>nom d&#8217;utilisateur de la base de donnÃ©es</code> mettez <code>cxmediawiki</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>mot de passe</code> saisissez le mot de passe de crÃ©Ã© pour la base.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>continuer</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Dans l&#8217;Ã©cran suivant, cliquez <code>continuer</code> sans rien changer</p>
</li>
<li>
<p>Saisissez le <code>nom du wiki</code></p>
</li>
<li>
<p>Saisissez le <code>nom d&#8217;utilisateur</code> du compte administrateur</p>
</li>
<li>
<p>Saisissez 2 fois <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p>Saisissez <code>Adresse de courriel</code> &#8592; votre Email.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>continuer</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>RÃ©pondez en fonction de vos besoins aux questions suivantes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>continuer</code></p>
</li>
<li>
<p>Lisez le texte et cliquez sur <code>continuer</code></p>
</li>
<li>
<p>L&#8217;installation s&#8217;effectue et se termine avec succÃ¨s. Cliquez sur <code>continuer</code></p>
</li>
<li>
<p>le fichier LocalSettings.php vous est proposÃ© au tÃ©lÃ©chargement. Enregistrez le et ouvrez le dans un Ã©diteur. Copier tout le contenu du fichier dans le presse papier</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>CrÃ©ez le fichier LocalSettings.php. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /var/www/mediawiki.example.com/mediawiki/LocalSettings.php <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre ici votre site web Ã  la place de mediawiki.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de mediawiki</td>
</tr>
</table>
</div>
</li>
<li>
<p>Coller tout le texte dans le fichier Ã©ditÃ©. Sauvegardez et quittez.</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/mediawiki.example.com/mediawiki/LocalSettings.php  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">chmod </span>644 /var/www/mediawiki.example.com/mediawiki/LocalSettings.php <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de mediawiki.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de mediawiki</td>
</tr>
</table>
</div>
</li>
<li>
<p>Dans votre navigateur cliquez sur <code>accÃ©der Ã  votre wiki</code></p>
</li>
<li>
<p>C&#8217;est fait</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_du_serveur_mediawiki">20.4. Update du serveur Mediawiki</h3>
<div class="paragraph">
<p>La procÃ©dure de mise Ã  jour officielle de Mediawiki se trouve <a href="https://www.mediawiki.org/wiki/Manual:Upgrading">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://www.mediawiki.org/wiki/Download">Mediawiki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil en format tarball.</p>
</li>
<li>
<p>Mettez Ã  jour Mediawiki. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> /tmp/mediawiki.old
<span class="nb">mv</span> /var/www/mediawiki.example.com/mediawiki/<span class="k">*</span> /tmp/mediawiki.old <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">cd</span> /tmp
wget <span class="nt">-O</span> mediawiki.tar.gz https://releases.wikimedia.org/mediawiki/1.35/mediawiki-1.35.2.tar.gz <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">tar</span> <span class="nt">-xvzf</span> mediawiki.tar.gz
<span class="nb">mv </span>mediawiki-1.35.2/<span class="k">*</span> /var/www/mediawiki.example.com/mediawiki/  <i class="conum" data-value="4"></i><b>(4)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">rm </span>mediawiki.tar.gz
<span class="nb">rm</span> <span class="nt">-rf</span> mediawiki-1.35.2 <i class="conum" data-value="4"></i><b>(4)</b>
<span class="nb">cp</span> /tmp/mediawiki.old/LocalSettings.php  /var/www/mediawiki.example.com/mediawiki/LocalSettings.php <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">cp</span> <span class="nt">-r</span> /tmp/mediawiki.old/images/<span class="k">*</span>  /var/www/mediawiki.example.com/mediawiki/images/ <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/mediawiki.example.com/mediawiki  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de mediawiki.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de mediawiki</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>coller ici l&#8217;adresse de tÃ©lÃ©chargement rÃ©cupÃ©rÃ©e sur le site de Mediawiki.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>le nom du fichier tar.gz dÃ©pend de la version que vous avez tÃ©lÃ©chargÃ©. De mÃªme le nom du rÃ©pertoire est dÃ©pendant de la version.</td>
</tr>
</table>
</div>
</li>
<li>
<p>vous pouvez aussi copier vos logos du rÃ©pertoire resources/assets de l&#8217;ancien mediawiki.</p>
</li>
<li>
<p>Mettez Ã  jour vos extensions avec les derniÃ¨res versions compatibles.</p>
</li>
<li>
<p>Suivez les recommandations de mise Ã  jour de Mediawiki pour le fichier <code>LocalSettings.php</code></p>
</li>
<li>
<p>exÃ©cuter le script d&#8217;update. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/www/mediawiki.example.com/mediawiki/maintenance
php update.php</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez que tout s&#8217;est bien passÃ©. Se rÃ©fÃ©rer Ã  la documentation de Mediawiki pour rÃ©soudre les problÃ¨mes.</p>
</li>
<li>
<p>RedÃ©marrez apache. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart apache2</code></pre>
</div>
</div>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne correctement sur le site phpmyadmin</p>
</li>
<li>
<p>Supprimez l&#8217;ancien rÃ©pertoire</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">rm</span> <span class="nt">-rf</span> /tmp/mediawiki.old</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_dun_gestionnaire_de_blog_wordpress">21. Installation d&#8217;un gestionnaire de Blog Wordpress</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wordpress est un CMS trÃ¨s connu Ã©crit en PHP. Il est frÃ©quemment mis Ã  jour.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_wordpress">21.1. CrÃ©ation du site web de Wordpress</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>wordpress</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>wordpress</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>wordpress</code>.</p>
</li>
<li>
<p>Pour <code>Auto-Subdomain</code> sÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_4">21.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>wordpress</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>wordpress</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxwordpress</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_lapplication_wordpress">21.3. CrÃ©ation de l&#8217;application Wordpress</h3>
<div class="paragraph">
<p>La procÃ©dure d&#8217;installation officielle de Wordpress se trouve <a href="https://fr.wordpress.org/support/article/how-to-install-wordpress/">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://fr.wordpress.org/download/">Wordpress</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de l&#8217;outil en format tarball.</p>
</li>
<li>
<p>Installez Wordpress. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
wget <span class="nt">-O</span> wordpress.tar.gz https://wordpress.org/latest.tar.gz
<span class="nb">tar</span> <span class="nt">-xvzf</span> wordpress.tar.gz
<span class="nb">mv </span>wordpress/<span class="k">*</span> /var/www/wordpress.example.com/wordpress/ <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">rm </span>wordpress.tar.gz
<span class="nb">rm</span> <span class="nt">-rf</span> wordpress
<span class="nb">chown</span> <span class="nt">-R</span> web[x]:client[y] /var/www/wordpress.example.com/wordpress  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remplacez [x] et [y] par les numÃ©ros de site web et de client. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>mettre ici votre site web Ã  la place de wordpress.example.com et le rÃ©pertoire d&#8217;installation Ã  la place de wordpress</td>
</tr>
</table>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://wordpress.example.com" class="bare">https://wordpress.example.com</a>.</p>
</li>
<li>
<p>Choisissez votre langue <code>franÃ§ais</code>. Cliquez sur <code>continuer</code>.</p>
</li>
<li>
<p>Lisez le texte et cliquez sur <code>C&#8217;est parti !</code></p>
</li>
<li>
<p>Dans le <code>nom de la base de donnÃ©es</code> mettez <code>cxwordpress</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>Identifiant</code>  mettez <code>cxwordpress</code> comme crÃ©Ã© plus haut</p>
</li>
<li>
<p>Dans le <code>Mot de passe</code> saisissez le mot de passe de crÃ©Ã© pour la base.</p>
</li>
<li>
<p>mettez <code>Localhost</code> comme <code>Adresse de la base de donnÃ©es</code></p>
</li>
<li>
<p>Vous pouvez laisser le <code>prÃ©fixe des tables</code> ou mettre Ã  vide si votre base est dÃ©diÃ©e.</p>
</li>
<li>
<p>Cliquez sur <code>Envoyer</code>.</p>
</li>
<li>
<p>Cliquez ensuite sur <code>Lancer l&#8217;installation</code></p>
</li>
<li>
<p><code>Titre du site</code> &#8592; mettez le nom de votre site web</p>
</li>
<li>
<p>Saisissez le <code>identifiant</code> du compte administrateur</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Saisissez <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> dans <code>mot de passe</code></p>
</li>
<li>
<p><code>Votre e-mail</code> &#8592; indiquez votre email d&#8217;admin</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez <code>Installer Wordpress</code></p>
</li>
<li>
<p>C&#8217;est fini.</p>
</li>
<li>
<p>Vous pouvez ensuite cliquer sur <code>Se connecter</code> pour administrer votre site</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_wordpress">21.4. Update de wordpress</h3>
<div class="paragraph">
<p>La mise Ã  jour de wordpress s&#8217;effectue directement dans le site web en allant sur <code>Dashboard</code> et l&#8217;item <code>updates</code>. Il n&#8217;y a rien d&#8217;autre Ã  faire.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_cms_micro_weber">22. Installation du CMS Micro Weber</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Microweber est un systÃ¨me de gestion de contenu et un constructeur de sites web Open Source. Il est basÃ© sur le langage de programmation PHP et le framework web Laravel 5, utilisant le glisser-dÃ©poser et permettant aux utilisateurs de crÃ©er rapidement du contenu, tout en programmant et en gÃ©rant plusieurs affichages. Il dispose d&#8217;une fonction d&#8217;Ã©dition en direct qui permet aux utilisateurs de visualiser leurs modifications telles qu&#8217;elles apparaÃ®traient.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_microweber">22.1. CrÃ©ation du site web de Microweber</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>microweber</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>microweber</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>microweber</code>.</p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_5">22.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>microweber</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>microweber</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxmicroweber</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_microweber">22.3. Installation de Microweber</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="command">cd /var/www/microweber.example.com/microweber <i class="conum" data-value="1"></i><b>(1)</b>
wget https://raw.githubusercontent.com/microweber-dev/webinstall/master/webinstall.php</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Un fois tÃ©lÃ©chargÃ©, faites pointer votre navigateur vers <a href="http://microweber.example.com/netinstall.php" class="bare">http://microweber.example.com/netinstall.php</a></p>
</li>
<li>
<p>Indique <code>.</code> comme rÃ©pertoire d&#8217;installation et cliquez sur <code>TÃ©lÃ©charger et dÃ©compresser microweber</code></p>
</li>
<li>
<p>Une fois le tÃ©lÃ©chargement terminÃ© cliquez sur <code>Installer Microweber</code>. Rechargez la page si besoin.</p>
</li>
<li>
<p>RÃ©pondez aux questions suivantes:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database Engine</code> &#8592; <code>MySQL</code></p>
</li>
<li>
<p><code>Hostname</code> &#8592; Laissez <code>localhost</code></p>
</li>
<li>
<p><code>Username</code> &#8592; entrez <code>cxmicroweber</code>. x est le numÃ©ro de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>Password</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p><code>Database</code> &#8592; entrez <code>cxmicroweber</code>. x est le numÃ©ro de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>PrÃ©fix des noms de tables</code> &#8592; Laissez le champ vide</p>
</li>
<li>
<p><code>Website Default Language</code> &#8592; <code>French</code></p>
</li>
<li>
<p><code>Admin username</code> &#8592; tapez <code>admin</code></p>
</li>
<li>
<p><code>Admin password</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p><code>Repeat password</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p><code>Admin email</code> &#8592; Tapez votre adresse mail d&#8217;administrateur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tapez <code>Install</code></p>
</li>
<li>
<p>Vous Ãªtes redirigÃ© sur le site Microweber ou vous pourrez vous loguer et commencer Ã  utiliser l&#8217;outil</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_microweber">22.4. Update de Microweber</h3>
<div class="paragraph">
<p>La mise Ã  jour de Microweber s&#8217;effectue directement dans le site web en allant sur <code>Dashboard</code> et l&#8217;item <code>updates</code>. Il n&#8217;y a rien d&#8217;autre Ã  faire.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_mealie">23. Installation de Mealie</h2>
<div class="sectionbody">
<div class="paragraph">
<p>le logiciel <code>Mealie</code> est un gestionnaire de recettes et un planificateur de repas auto-hÃ©bergÃ©s avec un backend RestAPI et une application frontale responsive construite en Vue pour une expÃ©rience utilisateur agrÃ©able pour toute la famille.</p>
</div>
<div class="sect2">
<h3 id="_prÃ©requis">23.1. PrÃ©requis</h3>
<div class="paragraph">
<p>Il vous faudra tout d&#8217;abord installer <code>docker</code> en vous rÃ©fÃ©rant au chapitre qui y est consacrÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_mealie">23.2. Installation du serveur Mealie</h3>
<div class="paragraph">
<p>Nous allons installer Mealie Ã  partir de son container Docker.</p>
</div>
<div class="paragraph">
<p>Ouvrez un terminal et suivez la procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>CrÃ©ez le docker de Mealie. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create mealie_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1282:9000 <span class="nt">--name</span><span class="o">=</span>mealie <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> mealie_data:<span class="s1">'/app/data/'</span> <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000  ghcr.io/mealie-recipes/mealie:latest</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_mealie">23.3. CrÃ©ation du site web de mealie</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>mealie</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>mealie</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>mealie</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># mealie httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:1282/
<span class="nc">ProxyPassReverse</span> / http://localhost:1282/

<span class="nc">RedirectMatch</span> ^/$ https://mealie.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_site_mealie">23.4. Configuration du site mealie</h3>
<div class="paragraph">
<p>Votre site web <code>mealie</code> est installÃ© et opÃ©rationnel.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pointez votre navigateur sur votre site web <code>mealie</code></p>
</li>
<li>
<p>Loggez vous avec le mail <code>changeme@email.com</code> et le mot de passe <code>MyPassword</code></p>
</li>
<li>
<p>Vous devez ensuite aller dans le menu de configuration de l&#8217;utilisateur pour changer ce mail et ce mot de passe par dÃ©faut</p>
</li>
<li>
<p>Vous pouvez maintenant ajouter des utilisateurs et des recettes de cuisine.</p>
</li>
<li>
<p>C&#8217;est prÃªt !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_mealie">23.5. Upgrade de Mealie</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#port_container_updt"><code>Portainer</code></a> ou Ã  l&#8217;aide <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Mealie. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull hkotel/mealie:latest
docker stop mealie
docker <span class="nb">rm </span>mealie
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1282:9000 <span class="nt">--name</span><span class="o">=</span>mealie <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> mealie_data:<span class="s1">'/app/data/'</span> <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000  ghcr.io/mealie-recipes/mealie:latest</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_gestionnaire_de_photos_piwigo">24. Installation du gestionnaire de photos Piwigo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Piwigo est une application web pour gÃ©rer votre collection de photos, et autres mÃ©dias. DotÃ© de puissantes fonctionnalitÃ©s, il gÃ¨re des galeries partout dans le monde. Elle est Ã©crite en PHP et nÃ©cessite une base de donnÃ©es MySQL.</p>
</div>
<div class="paragraph">
<p>Piwigo Ã©tait auparavant connu sous le nom PhpWebGallery.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_piwigo">24.1. CrÃ©ation du site web de Piwigo</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>piwigo</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>piwigo</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>piwigo</code>.</p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_6">24.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>piwigo</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir  <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>piwigo</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxpiwigo</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_piwigo">24.3. Installation de Piwigo</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez la commande suivante:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="command">cd /var/www/piwigo.example.com/piwigo <i class="conum" data-value="1"></i><b>(1)</b>
wget http://piwigo.org/download/dlcounter.php?code=netinstall -O piwigo-netinstall.php</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Un fois tÃ©lÃ©chargÃ©, faites pointer votre navigateur vers <a href="http://piwigo.example.com/piwigo-netinstall.php" class="bare">http://piwigo.example.com/piwigo-netinstall.php</a></p>
</li>
<li>
<p>Choisissez votre <code>Langue</code> Ã  <code>FranÃ§ais</code></p>
</li>
<li>
<p>Indique <code>.</code> comme rÃ©pertoire d&#8217;installation et cliquez sur <code>TÃ©lÃ©charger et dÃ©compresser Piwigo</code></p>
</li>
<li>
<p>Une fois le tÃ©lÃ©chargement terminÃ© cliquez sur <code>Installer Piwigo</code>. Rechargez la page si besoin.</p>
</li>
<li>
<p>RÃ©pondez aux questions suivantes:</p>
<div class="ulist">
<ul>
<li>
<p><code>Langue par dÃ©faut de la galerie</code> &#8592; <code>FranÃ§ais</code></p>
</li>
<li>
<p><code>Hote</code> &#8592; Laissez <code>localhost</code></p>
</li>
<li>
<p><code>Utilisateur</code> &#8592; entrez <code>cxpiwigo</code>. x est le numero de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>Mot de passe</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p><code>Nom de la Base de donnÃ©es</code> &#8592; entrez <code>cxpiwigo</code>. x est le numero de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>PrÃ©fix des noms de tables</code> &#8592; Laissez le champ vide</p>
</li>
<li>
<p><code>Nom d&#8217;Utilisateur</code> &#8592; tapez <code>admin</code></p>
</li>
<li>
<p><code>Mot de passe</code> &#8592; Tapez <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p><code>Mot de passe [confirmer]</code> &#8592; Retapez votre mot de passe</p>
</li>
<li>
<p><code>Adresse e-mail</code> &#8592; Tapez votre adresse mail d&#8217;administrateur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tapez <code>DÃ©marrer l&#8217;installation</code></p>
</li>
<li>
<p>Vous Ãªtes redirigÃ© sur le site piwigo ou vous pourrez vous loguer et commencer Ã  utiliser l&#8217;outil</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_piwigo">24.4. Update de Piwigo</h3>
<div class="paragraph">
<p>La mise Ã  jour de Piwigo s&#8217;effectue directement dans le site web en allant sur <code>Dashboard Admin</code> et l&#8217;item <code>Mises Ã  jour</code>. Il n&#8217;y a rien d&#8217;autre Ã  faire.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_collaboratif_nextcloud">25. Installation du systÃ¨me collaboratif Nextcloud</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NextCloud est un serveur d&#8217;hÃ©bergement et de partage de fichiers gratuit et open source, fork du projet ownCloud.
Il est trÃ¨s similaire aux autres systÃ¨mes de partage de fichiers des services comme Google Drive, Dropbox et iCloud ou Seafile.
NextCloud vous permet de stocker des fichiers, des documents, des photos, des films et des vidÃ©os Ã  partir de la centrale l&#8217;emplacement.
Avec NextCloud, vous pouvez partager des fichiers, des contacts et tout autre les mÃ©dias avec vos amis et vos clients.
NextCloud s&#8217;intÃ¨gre avec le courrier, calendrier, contacts et autres fonctionnalitÃ©s qui aideront vos Ã©quipes Ã  obtenir leur travail est plus rapide et plus facile.
Vous pouvez installer le client NextCloud sur un  ou plusieurs PC pour synchroniser les fichiers avec votre serveur Nextcloud.
Des clients sont disponibles pour la plupart des systÃ¨mes d&#8217;exploitation, y compris Windows, macOS, FreeBSD, et Linux.</p>
</div>
<div class="sect2">
<h3 id="_installation_initiale">25.1. Installation initiale</h3>
<div class="paragraph">
<p>NextCloud est Ã©crit en PHP et utilise une base de donnÃ©es MariaDB pour stocker ses donnÃ©es.</p>
</div>
<div class="paragraph">
<p>Pour installer, Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez quelques paquets de base. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt-get <span class="nb">install  </span>php-cgi php-curl</code></pre>
</div>
</div>
</li>
<li>
<p>Une fois installÃ©, Ã©ditez le fichier php.ini pour changer quelques limitations. Tapez:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>vi /etc/php/8.2/fpm/php.ini <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer 8.2 par votre version de php
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cherchez les champs ci dessous et changez les valeurs comme suit:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="py">memory_limit</span> <span class="p">=</span> <span class="s">512M</span>
<span class="py">upload_max_filesize</span> <span class="p">=</span> <span class="s">500M</span>
<span class="py">post_max_size</span> <span class="p">=</span> <span class="s">500M</span>
<span class="py">max_execution_time</span> <span class="p">=</span> <span class="s">300</span></code></pre>
</div>
</div>
</li>
<li>
<p>Sauvez et redÃ©marrez apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="command">systemctl restart apache2</code></pre>
</div>
</div>
</li>
</ol>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_nextcloud">25.2. CrÃ©ation du site web de Nextcloud</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>nextcloud</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>nextcloud</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>nextcloud</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Aller dans l&#8217;onglet <code>Statistics</code> pour <code>Webstatistics program</code> sÃ©lectionnez <code>None</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_7">25.3. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>nextcloud</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>nextcloud</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxnextcloud</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_nextcloud">25.4. Installation de Nextcloud</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez la commande suivante:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>cd /var/www/nextcloud.example.com/nextcloud <i class="conum" data-value="1"></i><b>(1)</b>
wget https://download.nextcloud.com/server/installer/setup-nextcloud.php</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Un fois tÃ©lÃ©chargÃ©, faites pointer votre navigateur vers <a href="http://nextcloud.example.com/setup-nextcloud.php" class="bare">http://nextcloud.example.com/setup-nextcloud.php</a></p>
</li>
<li>
<p>Indique <code>.</code> comme rÃ©pertoire d&#8217;installation et cliquez sur <code>Next</code></p>
</li>
<li>
<p>Une fois le tÃ©lÃ©chargement terminÃ© cliquez sur <code>Next</code>. Rechargez la page si besoin.</p>
</li>
<li>
<p>RÃ©pondez aux questions suivantes:</p>
<div class="ulist">
<ul>
<li>
<p><code>Login Admin</code> &#8592; tapez <code>admin</code></p>
</li>
<li>
<p><code>Password Admin</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p>ouvrez <code>Stockage et base de donnÃ©es</code></p>
</li>
<li>
<p><code>Configurer la base de donnÃ©es</code> &#8592; cliquez sur <code>MariaDB</code></p>
</li>
<li>
<p><code>Utilisateur de la Base de donnÃ©es</code> &#8592; entrez <code>cxnextcloud</code>. x est le numero de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>Password de la Base de donnÃ©es</code> &#8592; Tapez votre mot de passe</p>
</li>
<li>
<p><code>Nom de la Base de donnÃ©es</code> &#8592; entrez <code>cxnextcloud</code>. x est le numÃ©ro de client; habituellement c&#8217;est 0</p>
</li>
<li>
<p><code>nom du serveur</code> &#8592; Laissez <code>Localhost</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Tapez <code>Next</code></p>
</li>
<li>
<p>Vous Ãªtes redirigÃ© sur le site nextcloud ou vous pourrez vous loguer et commencer Ã  utiliser l&#8217;outil</p>
</li>
</ol>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_nextcloud">25.5. Upgrade de Nextcloud</h3>
<div class="paragraph">
<p>La mise Ã  jour de nextcloud se fait directement dans nextcloud avec l&#8217;outil de mise Ã  jour intÃ©grÃ© Ã  l&#8217;interface.
Il faut se connecter en mode Admin</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_gestionnaire_de_projet_gitea">26. Installation du gestionnaire de projet Gitea</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gitea est un systÃ¨me simple d&#8217;hÃ©bergement de code basÃ© sur Git. C&#8217;est un fork de Gogs.
Il montre des fonctionnalitÃ©s similaires Ã  gitlab ou github tout en gardant un code plus simple.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_gitea">26.1. CrÃ©ation du site web de Gitea</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>gitea</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>gitea</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>gitea</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># gitea httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:3000/
<span class="nc">ProxyPassReverse</span> / http://localhost:3000/

<span class="nc">RedirectMatch</span> ^/$ https://gitea.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>CrÃ©ez un utilisateur <code>Gitea</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adduser <span class="nt">--system</span> <span class="nt">--disabled-password</span> <span class="nt">--group</span> <span class="nt">--shell</span> /bin/bash <span class="nt">--home</span> /home/gitea gitea</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez la structure de rÃ©pertoire de <code>Gitea</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/lib/gitea/<span class="o">{</span>data,log<span class="o">}</span> /etc/gitea /run/gitea</code></pre>
</div>
</div>
</li>
<li>
<p>Donnez les bonnes permissions aux rÃ©pertoires. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chown</span> <span class="nt">-R</span> gitea:gitea /var/lib/gitea
<span class="nb">chown</span> <span class="nt">-R</span> gitea:gitea /run/gitea
<span class="nb">chown</span> <span class="nt">-R</span> root:gitea /etc/gitea
<span class="nb">chmod</span> <span class="nt">-R</span> 750 /var/lib/gitea
<span class="nb">chmod </span>770 /etc/gitea</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_8">26.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>gitea</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>gitea</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxgitea</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_tÃ©lÃ©chargez_et_installez_gitea">26.3. TÃ©lÃ©chargez et installez Gitea</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>TÃ©lÃ©chargez gitea du <a href="https://dl.gitea.io/gitea/">site de chargement</a>. Tapez pour un systÃ¨me 64 bits:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget https://dl.gitea.io/gitea/main/gitea-main-linux-amd64 <span class="nt">-O</span> /usr/local/bin/gitea
<span class="nb">chmod </span>755 /usr/local/bin/gitea</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez maintenant une entrÃ©e pour le launcher systemd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/gitea.service</code></pre>
</div>
</div>
</li>
<li>
<p>y Coller le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Gitea (Git with a cup of tea)</span>
<span class="py">After</span><span class="p">=</span><span class="s">syslog.target</span>
<span class="py">After</span><span class="p">=</span><span class="s">network.target</span>
<span class="py">Requires</span><span class="p">=</span><span class="s">mysqld.service</span>
<span class="nn">[Service]</span>
<span class="py">Type</span><span class="p">=</span><span class="s">simple</span>
<span class="py">User</span><span class="p">=</span><span class="s">gitea</span>
<span class="py">Group</span><span class="p">=</span><span class="s">gitea</span>
<span class="py">WorkingDirectory</span><span class="p">=</span><span class="s">/var/lib/gitea/</span>
<span class="py">RuntimeDirectory</span><span class="p">=</span><span class="s">gitea</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/usr/local/bin/gitea web -c /etc/gitea/app.ini</span>
<span class="py">Restart</span><span class="p">=</span><span class="s">always</span>
<span class="py">Environment</span><span class="p">=</span><span class="s">USER=gitea HOME=/home/gitea GITEA_WORK_DIR=/var/lib/gitea</span>
<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span></code></pre>
</div>
</div>
</li>
<li>
<p>Recharge la base de systemd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl daemon-reload</code></pre>
</div>
</div>
</li>
<li>
<p>Activez et dÃ©marrez <code>Gitea</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl <span class="nb">enable </span>gitea.service
systemctl start gitea.service</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez votre navigateur sur l&#8217;url: <a href="https://gitea.example.com/install" class="bare">https://gitea.example.com/install</a> et remplissez les paramÃ¨tres comme ci-aprÃ¨s :</p>
<div class="ulist">
<ul>
<li>
<p><code>Type de base de donnÃ©es:</code> &#8592; SÃ©lectionnez <code>MySQL</code></p>
</li>
<li>
<p><code>Nom d&#8217;utilisateur:</code> &#8592; Tapez <code>c0gitea</code></p>
</li>
<li>
<p><code>Mot de passe:</code> &#8592;  Tapez le mot de passe saisi lors de la crÃ©ation de la base</p>
</li>
<li>
<p><code>Nom de base de donnÃ©es:</code> &#8592; Tapez <code>c0gitea</code></p>
</li>
<li>
<p><code>Titre du site:</code> &#8592; mettez une titre de votre choix</p>
</li>
<li>
<p><code>Emplacement racine des dÃ©pÃ´ts:</code> &#8592; saisissez <code>/home/gitea/gitea-repositories</code></p>
</li>
<li>
<p><code>RÃ©pertoire racine Git LFS:</code> &#8592; Tapez <code>/var/lib/gitea/data/lfs</code></p>
</li>
<li>
<p><code>ExÃ©cuter avec le compte d&#8217;un autre utilisateur :</code> &#8592; Tapez <code>gitea</code></p>
</li>
<li>
<p><code>Domaine du serveur SSH:</code> &#8592; Tapez votre domaine. exemple : <code>gitea.example.com</code></p>
</li>
<li>
<p><code>Port du serveur SSH:</code> &#8592; Tapez 22</p>
</li>
<li>
<p><code>Port d&#8217;Ã©coute HTTP de Gitea:</code> &#8592; Tapez 3000</p>
</li>
<li>
<p><code>URL de base de Gitea:</code> &#8592; Tapez l&#8217;URL de votre domaine. Exemple: <code><a href="https://gitea.example.com" class="bare">https://gitea.example.com</a></code></p>
</li>
<li>
<p><code>Chemin des fichiers log:</code> &#8592; Tapez  <code>/var/lib/gitea/log</code></p>
</li>
<li>
<p><code>HÃ´te SMTP:</code> &#8592; Tapez <code>localhost</code></p>
</li>
<li>
<p><code>Envoyer les e-mails en tant que:</code> &#8592; Tapez <code>gitea@gitea.example.com</code></p>
</li>
<li>
<p><code>Exiger la confirmation de l&#8217;e-mail lors de l&#8217;inscription:</code> &#8592; cochez la case</p>
</li>
<li>
<p><code>Activez les notifications par e-mail:</code> &#8592; cochez la case</p>
</li>
<li>
<p><code>DÃ©sactiver le formulaire d&#8217;inscription:</code> &#8592; cochez la case</p>
</li>
<li>
<p><code>Masquer les adresses e-mail par dÃ©faut:</code> &#8592; cochez la case</p>
</li>
</ul>
</div>
</li>
<li>
<p>Laissez le reste et cliquez sur <code>Install Gitea</code>.</p>
</li>
<li>
<p>Restreignez les permissions sur le fichier de configuration de gitea. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>750 /etc/gitea
<span class="nb">chown </span>root:gitea /etc/gitea/app.ini
<span class="nb">chmod </span>640 /etc/gitea/app.ini</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez <code>gitea</code>.</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart gitea.service</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_activer_une_connexion_ssh_dÃ©diÃ©e">26.4. Activer une connexion SSH dÃ©diÃ©e</h3>
<div class="paragraph">
<p>En option, vous pouvez avoir envie de dÃ©dier une connexion SSH pour Gitea:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Ãditez le fichier de configuration. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/gitea/app.ini</code></pre>
</div>
</div>
</li>
<li>
<p>Trouvez les lignes suivantes et les remplacer dans le fichier. Chercher et remplacez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">START_SSH_SERVER <span class="o">=</span> <span class="nb">true
</span>SSH_PORT <span class="o">=</span> 2222 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici le numÃ©ro de port que vous souhaitez</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 2222 sur votre firewall</a></p>
</li>
<li>
<p>RedÃ©marrez <code>gitea</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart gitea.service</code></pre>
</div>
</div>
</li>
<li>
<p>Enjoy !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_gitea">26.5. Update de Gitea</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>TÃ©lÃ©chargez gitea du <a href="https://dl.gitea.io/gitea/">site de chargement</a>. Tapez pour un systÃ¨me 64 bits:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service gitea stop
wget https://dl.gitea.io/gitea/main/gitea-main-linux-amd64 <span class="nt">-O</span> /usr/local/bin/gitea
<span class="nb">chmod </span>755 /usr/local/bin/gitea
service gitea start</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_vaultwarden">27. Installation de vaultwarden</h2>
<div class="sectionbody">
<div class="paragraph">
<p>le logiciel <code>vaultwarden</code> est un gestionnaire de mots de passe relativement complet et gratuit. Il peut Ãªtre installÃ© sur votre serveur VPS de maniÃ¨re indÃ©pendante de l&#8217;Ã©diteur vaultwarden.</p>
</div>
<div class="paragraph">
<p>Il reste cependant un bÃ©mol puisque l&#8217;installation s&#8217;effectue Ã  l&#8217;aide de containers dockers qui sont eux gÃ©nÃ©rÃ©s par l&#8217;Ã©diteur de <code>vaultwarden</code>.</p>
</div>
<div class="sect2">
<h3 id="_prÃ©requis_2">27.1. PrÃ©requis</h3>
<div class="paragraph">
<p>Il vous faudra tout d&#8217;abord installer <code>docker</code> en vous rÃ©fÃ©rant au chapitre qui y est consacrÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_vaultwarden">27.2. Installation du serveur vaultwarden</h3>
<div class="paragraph">
<p>Nous allons installer Vaultwarden qui est la version libre de vaultwarden et compatible avec les APIs.
Cette version est plus complÃ¨te que la version officielle, consomme moins de ressources et est plus rapide.</p>
</div>
<div class="paragraph">
<p>Ouvrez un terminal et suivez la procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Installez <code>argon2</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>argon2</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez un <a href="#pass_gen">mot de passe</a></p>
</li>
<li>
<p>CrÃ©ez un code de hashage valide Ã  partir de celui ci et notez le. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"MySecretPassword"</span> | argon2 <span class="s2">"</span><span class="si">$(</span>openssl rand <span class="nt">-base64</span> 32<span class="si">)</span><span class="s2">"</span> <span class="nt">-e</span> <span class="nt">-id</span> <span class="nt">-k</span> 19456 <span class="nt">-t</span> 2 <span class="nt">-p</span> 1</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez le docker de Vaultwarden. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create vaultwarden_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1280:80 <span class="nt">--name</span><span class="o">=</span>vaultwarden <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> vaultwarden_data:/data:rw <span class="nt">-e</span> <span class="nv">ROCKET_ENV</span><span class="o">=</span>staging <span class="nt">-e</span> <span class="nv">ROCKET_PORT</span><span class="o">=</span>80 <span class="nt">-e</span> <span class="nv">ROCKET_WORKERS</span><span class="o">=</span>10 <span class="nt">-e</span> <span class="nv">SMTP_HOST</span><span class="o">=</span>mail.example.com <span class="nt">-e</span> <span class="nv">SMTP_FROM</span><span class="o">=</span>mailname@example.com <span class="nt">-e</span> <span class="nv">SMTP_PORT</span><span class="o">=</span>587 <span class="nt">-e</span> <span class="nv">SMTP_SSL</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-e</span> <span class="nv">SMTP_USERNAME</span><span class="o">=</span>mailname@example.com <span class="nt">-e</span> <span class="nv">SMTP_PASSWORD</span><span class="o">=</span>mailpassword <span class="nt">-e</span> <span class="nv">WEBSOCKET_ENABLED</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-e</span> <span class="nv">ADMIN_TOKEN</span><span class="o">=</span>Hashcode <span class="nt">-e</span> <span class="nv">SIGNUPS_ALLOWED</span><span class="o">=</span><span class="nb">false</span> <span class="nt">-e</span> <span class="nv">DOMAIN</span><span class="o">=</span>https://vaultwarden.example.com vaultwarden/server:latest <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ici il faut remplacer <code>example.com</code> par votre nom de domaine. Il faut aussi remplacer <code>mailname@example.com</code> par une boite mail valide sur le serveur et <code>mailpassword</code> par le mot de passe de cette boite mail valide. <code>Hashcode</code> doit Ãªtre remplacÃ© par le code de hashage gÃ©nÃ©rÃ©. Ce code protÃ¨ge l&#8217;accÃ¨s <code>admin</code> de vaultwarden.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_vaultwarden">27.3. CrÃ©ation du site web de vaultwarden</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>vaultwarden</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>vaultwarden</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>vaultwarden</code>.</p>
</li>
<li>
<p>Mettre <code>None</code> dans <code>Auto-Subdomain</code></p>
</li>
<li>
<p>Activer letâs encrypt ssl</p>
</li>
<li>
<p>Activer <code>PHP-PFM</code> pour PHP</p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># vaultwarden httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:1280/
<span class="nc">ProxyPassReverse</span> / http://localhost:1280/

<span class="nc">RedirectMatch</span> ^/$ https://vaultwarden.example.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_site_vaultwarden">27.4. Configuration du site vaultwarden</h3>
<div class="paragraph">
<p>Votre site web <code>vaultwarden</code> est installÃ© et opÃ©rationnel.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pointez votre navigateur sur votre site web <code>vaultwarden</code></p>
</li>
<li>
<p>CrÃ©ez un compte avec votre login et choisissez un mot de passe.</p>
</li>
<li>
<p>Loggez vous sur le site vous pouvez maintenant crÃ©er des droits d&#8217;accÃ¨s ou importer ceux d&#8217;un autre outil tel que <code>lastpass</code> ou <code>1password</code>.</p>
</li>
<li>
<p>Vous pouvez aussi vous connecter en tant qu&#8217;admin en allant sur l&#8217;url <a href="https://vaultwarden.example.com/admin" class="bare">https://vaultwarden.example.com/admin</a></p>
</li>
<li>
<p>Une fenetre apparait vous demandant le code de hachage que vous avez configurÃ© Ã  l&#8217;installation. Saisissez le.</p>
</li>
<li>
<p>vous pouvez maintenant configurer des options dans vaultwarden.</p>
</li>
<li>
<p>une option qu&#8217;il est important de configurer est la dÃ©sactivation de la crÃ©ation de compte. Pour cela:</p>
<div class="ulist">
<ul>
<li>
<p>allez dans <code>General Settings</code></p>
</li>
<li>
<p>dÃ©sactivez <code>Allow new signups</code>. Cliquez sur <code>Save</code> (en bas Ã  gauche).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Les utilisateurs non invitÃ©s ne pourront plus crÃ©er de compte sur votre serveur.</p>
</li>
<li>
<p>Une autre faÃ§on de faire est de dÃ©marrer le container docker avec l&#8217;option <code>-e SIGNUPS_ALLOWED=false</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sur votre smartphone on dans votre navigateur, configurez vaultwarden pour pointer vers votre serveur en y configurant l&#8217;URL: <code><a href="https://vaultwarden.example.com" class="bare">https://vaultwarden.example.com</a></code>
Logguez vous.</p>
</div>
<div class="paragraph">
<p>Tout est prÃªt!</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_vaultwarden">27.5. Upgrade de vaultwarden</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#port_container_updt"><code>Portainer</code></a> ou Ã  l&#8217;aide <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de Bitwarden_rs. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull vaultwarden/server:latest
docker stop vaultwarden
docker <span class="nb">rm </span>vaultwarden
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1280:80 <span class="nt">--name</span><span class="o">=</span>vaultwarden <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> vaultwarden_data:/data:rw <span class="nt">-e</span> <span class="nv">ROCKET_ENV</span><span class="o">=</span>staging <span class="nt">-e</span> <span class="nv">ROCKET_PORT</span><span class="o">=</span>80 <span class="nt">-e</span> <span class="nv">ROCKET_WORKERS</span><span class="o">=</span>10 <span class="nt">-e</span> <span class="nv">SMTP_HOST</span><span class="o">=</span>mail.example.com <span class="nt">-e</span> <span class="nv">SMTP_FROM</span><span class="o">=</span>mailname@example.com <span class="nt">-e</span> <span class="nv">SMTP_PORT</span><span class="o">=</span>587 <span class="nt">-e</span> <span class="nv">SMTP_SSL</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-e</span> <span class="nv">SMTP_USERNAME</span><span class="o">=</span>mailname@example.com <span class="nt">-e</span> <span class="nv">SMTP_PASSWORD</span><span class="o">=</span>mailpassword <span class="nt">-e</span> <span class="nv">WEBSOCKET_ENABLED</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-e</span> <span class="nv">ADMIN_TOKEN</span><span class="o">=</span>Hashcode <span class="nt">-e</span> <span class="nv">SIGNUPS_ALLOWED</span><span class="o">=</span><span class="nb">false</span> <span class="nt">-e</span> <span class="nv">DOMAIN</span><span class="o">=</span>https://vaultwarden.example.com vaultwarden/server:latest <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>ici il faut remplacer <code>example.com</code> par votre nom de domaine. Il faut aussi remplacer <code>mailname@example.com</code> par une boite mail valide sur le serveur et <code>mailpassword</code> par le mot de passe de cette boite mail valide. <code>Hashcode</code> doit Ãªtre remplacÃ© par le code de hashage gÃ©nÃ©rÃ©. Ce code protÃ¨ge l&#8217;accÃ¨s <code>admin</code> de vaultwarden.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_de_heimdall">28. Installation de Heimdall</h2>
<div class="sectionbody">
<div class="paragraph">
<p>le logiciel <code>Heimdall</code> est un logiciel de portail offrant de nombreuses possibilitÃ©s de configuration.</p>
</div>
<div class="sect2">
<h3 id="_prÃ©requis_3">28.1. PrÃ©requis</h3>
<div class="paragraph">
<p>Il vous faudra tout d&#8217;abord installer <code>docker</code> en vous rÃ©fÃ©rant au chapitre qui y est consacrÃ©.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_heimdall">28.2. Installation du serveur Heimdall</h3>
<div class="paragraph">
<p>Nous allons installer Heimdall Ã  partir de son container Docker.</p>
</div>
<div class="paragraph">
<p>Ouvrez un terminal et suivez la procÃ©dure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>CrÃ©ez le docker de heimdall. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker volume create heimdall_data
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1281:443 <span class="nt">--name</span><span class="o">=</span>heimdall <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> heimdall_data:/config:rw <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000  linuxserver/heimdall</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_heimdall">28.3. CrÃ©ation du site web de heimdall</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>heimdall</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>heimdall</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>heimdall</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># redirect from server</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">SSLProxyEngine</span> <span class="ss">On</span> <span class="c"># Comment this out if no https required</span>
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">SSLProxyVerify</span> <span class="ss">none</span>
<span class="nc">SSLProxyCheckPeerCN</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerName</span> <span class="ss">off</span>
<span class="nc">SSLProxyCheckPeerExpire</span> <span class="ss">off</span>

<span class="nc">ProxyPass</span> / https://localhost:1281/
<span class="nc">ProxyPassReverse</span> / https://localhost:1281/

<span class="nc">RedirectMatch</span> ^/$ https://heimdall.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_du_site_heimdall">28.4. Configuration du site heimdall</h3>
<div class="paragraph">
<p>Votre site web <code>heimdall</code> est installÃ© et opÃ©rationnel.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pointez votre navigateur sur votre site web <code>heimdall</code></p>
</li>
<li>
<p>CrÃ©ez un compte avec votre login et choisissez un mot de passe.</p>
</li>
<li>
<p>SÃ©lectionnez l&#8217;icone User (3 Ã©me icone en forme de portrait Ã  droite).</p>
</li>
<li>
<p>SÃ©lectionnez Admin et cliquez sur l&#8217;icone modifier</p>
</li>
<li>
<p>Tapez un mot de passe, le confirmer. SÃ©lectionnez "Allow logging in from a specific URL". Cliquez sur "Enregistrez"</p>
</li>
<li>
<p>Une URL est maintenant disponible vous pouvez la mettre comme page d&#8217;accueil de votre navigateur</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Tout est prÃªt!</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_heimdall">28.5. Upgrade de Heimdall</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code>
Vous pouvez aussi appliquer la procÃ©dure de mise Ã  jour des containers Ã  l&#8217;aide de <a href="#port_container_updt"><code>Portainer</code></a> ou Ã  l&#8217;aide <a href="#yacht_container_updt"><code>Yacht</code></a></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de heimdall. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull linuxserver/heimdall
docker stop heimdall
docker <span class="nb">rm </span>heimdall
docker run <span class="nt">-d</span> <span class="nt">-p</span> 1281:443 <span class="nt">--name</span><span class="o">=</span>heimdall <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> heimdall_data:/config:rw <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000  linuxserver/heimdall</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_de_partage_de_fichiers_seafile">29. Installation du systÃ¨me de partage de fichiers Seafile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Seafile est un systÃ¨me de partage de fichier simple et efficace Ã©crit en Python. Il existe des clients de connexion pour Windows, Linux, Android, IOS.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_seafile">29.1. CrÃ©ation du site web de Seafile</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>seafile</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>seafile</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>seafile</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># Seafile configuration</span>

<span class="nc">Alias</span> /media {DOCROOT}/private/seafile/seafile-server-latest/seahub/media
<span class="nc">RewriteEngine</span> <span class="ss">On</span>

<span class="p">&lt;</span><span class="nl">Location</span><span class="sr"> /media</span><span class="p">&gt;
</span><span class="nc">Require</span> <span class="ss">all</span> granted
<span class="p">&lt;/</span><span class="nl">Location</span><span class="p">&gt;
</span>
<span class="c"># seafile httpserver</span>
<span class="c">#</span>
<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">ProxyPass</span> /seafhttp http://localhost:8092
<span class="nc">ProxyPassReverse</span> /seafhttp http://localhost:8092
<span class="nc">RewriteRule</span> ^/seafhttp - [QSA,L]

<span class="c"># seahub</span>
<span class="c">#</span>
<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">ProxyPass</span> / http://localhost:8090/
<span class="nc">ProxyPassReverse</span> / http://localhost:8090/</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_de_bases_de_donnÃ©es">29.2. CrÃ©ation de bases de donnÃ©es</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Loguez vous sur ISPConfig</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>seafile</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; Saisir <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; Resaisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Aller dans le menu <code>Database</code> pour dÃ©finir les bases de donnÃ©es</p>
</li>
<li>
<p>Appliquer l&#8217;opÃ©ration ci aprÃ¨s 3 fois d&#8217;affilÃ©e pour crÃ©er les trois bases suivantes: <code>ccnetdb</code>, <code>seafiledb</code>, <code>seahubdb</code></p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es</p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxseafile</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Les trois bases de donnÃ©es doivent apparaÃ®tre dans la liste des bases</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_tÃ©lÃ©chargez_et_installez_seafile">29.3. TÃ©lÃ©chargez et installez Seafile</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez quelques paquets Debian complÃ©mentaires. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3 python3-setuptools python3-pip default-libmysqlclient-dev
pip3 <span class="nb">install</span> <span class="nt">--timeout</span><span class="o">=</span>3600 Pillow pylibmc captcha jinja2 future mysqlclient <span class="nv">sqlalchemy</span><span class="o">==</span>1.4.3 psd-tools django-pylibmc django-simple-captcha python3-ldap</code></pre>
</div>
</div>
</li>
<li>
<p>Allez sur le site de tÃ©lÃ©chargement de <a href="https://www.seafile.com/en/download/">Seafile</a> et copier le lien de tÃ©lÃ©chargement pour <code>Server for generic Linux</code></p>
</li>
<li>
<p>Il est prÃ©fÃ©rable d&#8217;exÃ©cuter les serveurs dans un rÃ©pertoire privÃ© plutÃ´t que dans le rÃ©pertoire web pour des questions de sÃ©curitÃ©. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib
<span class="nb">mkdir </span>seafile
<span class="nb">cd </span>seafile
wget https://s3.eu-central-1.amazonaws.com/download.seadrive.org/seafile-server_7.1.3_x86-64.tar.gz <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">tar </span>zxvf seafile-server_7.1.3_x86-64.tar.gz <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">mkdir </span>installed
<span class="nb">mv </span>seafile-server_<span class="k">*</span> installed
<span class="nb">cd </span>seafile-server-<span class="k">*</span>
./setup-seafile-mysql.sh
<span class="nb">cd</span> ../..
<span class="nb">chown</span> <span class="nt">-R</span> web1:client0 seafile <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>choisissez le user et le groupe de votre site web. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>coller ici l&#8217;adresse de tÃ©lÃ©chargement rÃ©cupÃ©rÃ©e sur le site de Seafile.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>le nom du fichier tar.gz dÃ©pend de la version que vous avez tÃ©lÃ©chargÃ©. De mÃªme le nom du rÃ©pertoire est dÃ©pendant de la version.</td>
</tr>
</table>
</div>
</li>
<li>
<p>A ce moment, vous devez rÃ©pondre Ã  un certain nombre de questions.</p>
</li>
<li>
<p>Choisissez le mode de configuration 2) pour indiquer vous mÃªme les informations sur les bases de donnÃ©es crÃ©Ã©es.</p>
</li>
<li>
<p>Vous devrez ensuite donner le nom d&#8217;utilisateur pour la base de donnÃ©es, le mot de passe ainsi que le nom des 3 bases de donnÃ©es.</p>
</li>
<li>
<p>Si tout est saisi correctement le programme doit donner une synthÃ¨se de ce qui a Ã©tÃ© configurÃ©</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lancement_initial">29.4. Lancement initial</h3>
<div class="paragraph">
<p>Nous allons effectuer un premier lancement du serveur Seafile:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>allez dans le rÃ©pertoire contenant les configurations et Ã©ditez <code>gunicorn.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/seafile/conf
vi gunicorn.conf</code></pre>
</div>
</div>
</li>
<li>
<p>RepÃ¨rez le texte <code>bind=</code> et mettez un numÃ©ro de port 8090 Ã  la place de 8000. Comme ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">bind</span> <span class="o">=</span> <span class="s2">"127.0.0.1:8090"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier <code>seafile.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi seafile.conf</code></pre>
</div>
</div>
</li>
<li>
<p>mettez un port 8092 au lieu du port 8082 saisi pour l&#8217;entrÃ©e <code>fileserver</code>. Le fichier doit contenir ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="nn">[fileserver]</span>
<span class="py">port</span> <span class="p">=</span> <span class="s">8092</span></code></pre>
</div>
</div>
</li>
<li>
<p>Editez le fichier <code>ccnet.conf</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ccnet.conf</code></pre>
</div>
</div>
</li>
<li>
<p>modifier l&#8217;entrÃ©e SERVICE_URL. Le fichier doit contenir ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">SERVICE_URL <span class="o">=</span> https://seafile.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Editez le fichier <code>seahub_settings.py</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi seahub_settings.py</code></pre>
</div>
</div>
</li>
<li>
<p>modifier l&#8217;entrÃ©e FILE_SERVER_ROOT. Le fichier doit contenir ceci:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="n">FILE_SERVER_ROOT</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://seafile.example.com/seafhttp</span><span class="sh">'</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettre Ã  la place de <code>example.com</code> votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>DÃ©marrez Seafile. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/seafile/seafile-server-latest
<span class="nb">sudo</span> <span class="nt">-u</span> web1 ./seafile.sh start <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">sudo</span> <span class="nt">-u</span> web1 ./seahub.sh start 8090 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer le nom de user web1 par celui correspondant Ã  celui du site web installÃ© (indiquÃ© dans le champ <code>Options</code>&#8594;`linux user` du web domain). (Si vous n&#8217;avez qu&#8217;un site, web1 est le bon).</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 8090 et 8092 sur votre firewall</a></p>
</li>
<li>
<p>Faites pointer votre navigateur sur <a href="https://seafile.example.com" class="bare">https://seafile.example.com</a></p>
</li>
<li>
<p>La page de login de Seafile doit s&#8217;afficher</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lancement_automatique_de_seafile">29.5. Lancement automatique de Seafile</h3>
<div class="paragraph">
<p>Afin de s&#8217;assurer que Seafile tourne en permanence, on doit crÃ©er un script de lancement automatique de Seafile:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©er un script de lancement automatique. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/seafile
<span class="nb">touch </span>startseafile.sh
<span class="nb">chmod</span> +x startseafile.sh
vi startseafile.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Coller le texte suivant de le fichier ouvert:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="c"># Change the value of "seafile_dir" to your path of seafile installation</span>
<span class="nv">seafile_dir</span><span class="o">=</span>/var/lib/seafile
<span class="nv">script_path</span><span class="o">=</span><span class="k">${</span><span class="nv">seafile_dir</span><span class="k">}</span>/seafile-server-latest
<span class="nv">seafile_init_log</span><span class="o">=</span><span class="k">${</span><span class="nv">seafile_dir</span><span class="k">}</span>/logs/seafile.init.log
<span class="nv">seahub_init_log</span><span class="o">=</span><span class="k">${</span><span class="nv">seafile_dir</span><span class="k">}</span>/logs/seahub.init.log
<span class="nv">seafgc_init_log</span><span class="o">=</span><span class="k">${</span><span class="nv">seafile_dir</span><span class="k">}</span>/logs/seafgc.init.log

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
</span>start<span class="p">)</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seafile.sh start <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafile_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seahub.sh start 8090 <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seahub_init_log</span><span class="k">}</span>
<span class="p">;;</span>
restart<span class="p">)</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seafile.sh restart <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafile_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seahub.sh restart 8090 <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seahub_init_log</span><span class="k">}</span>
<span class="p">;;</span>
reload<span class="p">)</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seahub.sh stop <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seahub_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seafile.sh stop <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafile_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seaf-gc.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafgc_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seafile.sh start <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafile_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seahub.sh start 8090 <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seahub_init_log</span><span class="k">}</span>
<span class="p">;;</span>
stop<span class="p">)</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seahub.sh stop <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seahub_init_log</span><span class="k">}</span>
<span class="k">${</span><span class="nv">script_path</span><span class="k">}</span>/seafile.sh stop <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">seafile_init_log</span><span class="k">}</span>
<span class="p">;;</span>
<span class="k">*</span><span class="p">)</span>
<span class="nb">echo</span> <span class="s2">"Usage: /etc/init.d/seafile {start|stop|restart|reload}"</span>
<span class="nb">exit </span>1
<span class="p">;;</span>
<span class="k">esac</span></code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©er un job cron dans ISPConfig pour dÃ©marrer Seafile au dÃ©marrage</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Allez dans la rubrique <code>Sites</code> puis dans le menu <code>Cron Jobs</code>. Cliquez sur <code>Add cron Job</code>. Saisisssez les champs:</p>
<div class="ulist">
<ul>
<li>
<p><code>Parent Website:</code> &#8592; mettre <code>example.com</code></p>
</li>
<li>
<p><code>Minutes:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Hours:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Days of month:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Months:</code> &#8592; mettre <code>@reboot</code></p>
</li>
<li>
<p><code>Days of week:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Command to run:</code> &#8592; mettre <code>/var/lib/seafile/startseafile.sh start</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un second job cron dans ISPConfig pour redÃ©marrer Seafile tous les jours</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Allez dans la rubrique <code>Sites</code> puis dans le menu <code>Cron Jobs</code>. Cliquez sur <code>Add cron Job</code>. Saisissez les champs:</p>
<div class="ulist">
<ul>
<li>
<p><code>Parent Website:</code> &#8592; mettre <code>example.com</code></p>
</li>
<li>
<p><code>Minutes:</code> &#8592; mettre 45</p>
</li>
<li>
<p><code>Hours:</code> &#8592; mettre 20</p>
</li>
<li>
<p><code>Days of month:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Months:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Days of week:</code> &#8592; mettre *</p>
</li>
<li>
<p><code>Command to run:</code> &#8592; mettre <code>/var/lib/seafile/startseafile.sh reload</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Arretez le serveur prÃ©cÃ©demment lancÃ© en tant que root. Tapez:</p>
</li>
<li>
<p>Enjoy !</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_de_seafile">30. Upgrade de Seafile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La procÃ©dure de mise Ã  jour officielle de Seafile se trouve <a href="https://manual.seafile.com/upgrade/upgrade/">ici</a></p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez sur le site de tÃ©lÃ©chargement de <a href="https://www.seafile.com/en/download/">Seafile</a> et copier le lien de tÃ©lÃ©chargement pour <code>Server for generic Linux</code></p>
</li>
<li>
<p>Il est prÃ©fÃ©rable d&#8217;exÃ©cuter les serveurs dans un rÃ©pertoire privÃ© plutÃ´t que dans le rÃ©pertoire web pour des questions de sÃ©curitÃ©. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/seafile
wget https://s3.eu-central-1.amazonaws.com/download.seadrive.org/seafile-server_7.1.3_x86-64.tar.gz <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">tar </span>zxvf seafile-server_7.1.3_x86-64.tar.gz <i class="conum" data-value="3"></i><b>(3)</b>
./startseafile.sh stop
<span class="nb">mv </span>seafile-server_<span class="k">*</span> installed
<span class="nb">cd </span>seafile-server-7.1.3 <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nb">cd </span>upgrade
./upgrade_7.1.2.sh <i class="conum" data-value="4"></i><b>(4)</b>
./setup-seafile-mysql.sh
<span class="nb">cd</span> ../../..
<span class="nb">chown</span> <span class="nt">-R</span> web1:client0 seafile <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">cd </span>seafile/seafile-server-latest
<span class="nb">sudo</span> <span class="nt">-u</span> web1 ./seafile.sh start <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">sudo</span> <span class="nt">-u</span> web1 ./seahub.sh start 8090 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>coller ici l&#8217;adresse de tÃ©lÃ©chargement rÃ©cupÃ©rÃ©e sur le site de Seafile.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>choisissez le user et le groupe de votre site web. Ces informations sont consultables dans ISPConfig en consultant les informations du Web Domain&#8594;onglet <code>Options</code>&#8594;champs Linux User et Linux Group.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>le nom du fichier tar.gz dÃ©pend de la version que vous avez tÃ©lÃ©chargÃ©. De mÃªme le nom du rÃ©pertoire est dÃ©pendant de la version.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>exÃ©cutez tous les scripts d&#8217;upgrade dont le numÃ©ro de version est supÃ©rieur ou Ã©gal au numÃ©ro de version du seafile installÃ© prÃ©alablement.</td>
</tr>
</table>
</div>
</li>
<li>
<p>VÃ©rifiez que vous savez accÃ©der Ã  Seafile tant sur le site web qu&#8217;avec vos applis PC et smartphone</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_de_monitoring_grafana">31. Installation du systÃ¨me de monitoring Grafana</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grafana est un logiciel de visualisation et d&#8217;analyse Ã  code source ouvert. Il vous permet d&#8217;interroger, de visualiser, d&#8217;alerter et d&#8217;explorer vos mesures, quel que soit l&#8217;endroit oÃ¹ elles sont stockÃ©es. En clair, il vous fournit des outils pour transformer vos donnÃ©es de base de donnÃ©es de sÃ©ries chronologiques (TSDB) en de magnifiques graphiques et visualisations.
Grafana s&#8217;appuie sur Prometheus afin d&#8217;obtenir des mÃ©triques.
Loki est aussi installÃ© pour rÃ©aliser une analyse prÃ©cise des fichiers de logs.</p>
</div>
<div class="paragraph">
<p>Cette installation est optionnelle puisque Munin est dÃ©jÃ  installÃ© sur votre systÃ¨me.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_grafana">31.1. CrÃ©ation du site web de Grafana</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>grafana</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>grafana</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>grafana</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># grafana httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:3100/
<span class="nc">ProxyPassReverse</span> / http://localhost:3100/

<span class="nc">RedirectMatch</span> ^/$ https://grafana.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_grafana">31.2. Installation de Grafana</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb https://packages.grafana.com/oss/deb stable main"</span> <span class="o">&gt;&gt;</span>/etc/apt/sources.list.d/grafana.list
<span class="nb">cd</span> /etc/apt/trusted.gpg.d
wget https://packages.grafana.com/gpg.key grafana.asc</code></pre>
</div>
</div>
</li>
<li>
<p>Installez les paquets. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt update
apt <span class="nb">install </span>grafana prometheus prometheus-mysqld-exporter prometheus-apache-exporter prometheus-bind-exporter prometheus-process-exporter</code></pre>
</div>
</div>
</li>
<li>
<p>Editez la configuration de Prometheus. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/prometheus/prometheus.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">prometheus'</span>

    <span class="c1"># Override the global default and scrape targets from this job every 5 seconds.</span>
    <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">5s</span>
    <span class="na">scrape_timeout</span><span class="pi">:</span> <span class="s">5s</span>

    <span class="c1"># metrics_path defaults to '/metrics'</span>
    <span class="c1"># scheme defaults to 'http'.</span>

    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9090'</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">node</span>
    <span class="c1"># If prometheus-node-exporter is installed, grab stats about the local</span>
    <span class="c1"># machine by default.</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9100'</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">dns-master</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9119'</span><span class="pi">]</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">alias</span><span class="pi">:</span> <span class="s">dns-master</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">apache</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9117'</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">process</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9256'</span><span class="pi">]</span>

  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">mysql</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9104'</span><span class="pi">]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Editez la configuration de <code>prometheus-process-exporter</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi etc/default/prometheus-process-exporter</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ARGS="-procnames postgres,dovecot,apache2,sshd,php-fpm7.3,rspamd,named,mysqld"</code></pre>
</div>
</div>
</li>
<li>
<p>Editez la configuration de <code>prometheus-mysqld-exporter</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi etc/default/prometheus-mysqld-exporter</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez les lignes suivantes:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>ARGS='--config.my-cnf /etc/mysql/debian.cnf --collect.info_schema.tables.databases="*" --collect.auto_increment.columns --collect.perf_schema.file_instances.filter=".*" --collect.info_schema.tablestats'</code></pre>
</div>
</div>
</li>
<li>
<p>Ajuster les permissions du fichier de conf de mysql pour donner l&#8217;accÃ¨s Ã  prometheus. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>644 /etc/mysql/debian.cnf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajustez la configuration de bind pour servir des statistiques. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/bind/named.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Ajouter dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>statistics-channels {
  inet 127.0.0.1 port 8053 allow { 127.0.0.1; };
};</code></pre>
</div>
</div>
</li>
<li>
<p>Activez dans mysql quelques statistiques. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">mysql <span class="nt">-p</span></code></pre>
</div>
</div>
</li>
<li>
<p>tapez votre mot de passe root pour mysql. puis taper:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="mysql">INSTALL PLUGIN QUERY_RESPONSE_TIME_AUDIT SONAME 'query_response_time.so';
INSTALL PLUGIN QUERY_RESPONSE_TIME SONAME 'query_response_time.so';
INSTALL PLUGIN QUERY_RESPONSE_TIME_READ SONAME 'query_response_time.so';
INSTALL PLUGIN QUERY_RESPONSE_TIME_WRITE SONAME 'query_response_time.so';
SET GLOBAL query_response_time_stats=ON;
SET GLOBAL userstat=ON;</code></pre>
</div>
</div>
</li>
<li>
<p>RedÃ©marrez les services. Taper:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="mysql">service prometheus restart
service prometheus-mysqld-exporter restart
service prometheus-process-exporter restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_de_loki">31.3. Installation et configuration de Loki</h3>
<div class="paragraph">
<p>Pour installer Loki, appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://github.com/grafana/loki/releases/">Loki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de loki-linux-amd64.zip (ou loki-linux-arm.zip pour raspberry pi 3 ou loki-linux-arm64.zip pour raspberry pi 4 ou 5)</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /usr/local/bin
curl <span class="nt">-fSL</span> <span class="nt">-o</span> loki.gz https://github.com/grafana/loki/releases/download/v1.4.1/loki-linux-amd64.zip
<span class="nb">gunzip </span>loki.gz
<span class="nb">chmod </span>a+x loki</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez le fichier de configuration de loki</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/config-loki.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez le texte ci dessous dans le fichier</p>
<div class="listingblock">
<div class="content">
<pre>auth_enabled: false

server:
  http_listen_port: 3100
  log_level: "warn"

ingester:
  lifecycler:
    address: 127.0.0.1
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    final_sleep: 0s
  chunk_idle_period: 5m
  chunk_retain_period: 30s

schema_config:
  configs:
  - from: 2010-01-01
    store: boltdb
    object_store: filesystem
    schema: v9
    index:
      prefix: index_
      period: 168h

storage_config:
  boltdb:
    directory: /tmp/loki/index

  filesystem:
    directory: /tmp/loki/chunks

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h

chunk_store_config:
  max_look_back_period: 0

table_manager:
  chunk_tables_provisioning:
    inactive_read_throughput: 0
    inactive_write_throughput: 0
    provisioned_read_throughput: 0
    provisioned_write_throughput: 0
  index_tables_provisioning:
    inactive_read_throughput: 0
    inactive_write_throughput: 0
    provisioned_read_throughput: 0
    provisioned_write_throughput: 0
  retention_deletes_enabled: false
  retention_period: 0</pre>
</div>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 3100 sur votre firewall</a></p>
</li>
<li>
<p>Testez maintenant la configuration de Loki. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">loki <span class="nt">-config</span>.file /etc/config-loki.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et visitez: <a href="http://example.com:3100/metrics" class="bare">http://example.com:3100/metrics</a></p>
</li>
<li>
<p>Maintenant arrÃªtez Loki en tapant <strong>CTRL-C</strong>.</p>
</li>
<li>
<p><a href="#firewall">Bloquez le port 3100 sur votre firewall</a></p>
</li>
<li>
<p>Configurez un service Loki afin de le faire tourner en arriÃ¨re plan. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/loki.service</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez le texte ci dessous et sauvez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[Unit]
Description=Loki service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/loki -config.file /etc/config-loki.yml

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
</li>
<li>
<p>Maintenant lancez le service et vÃ©rifiez que tout est fonctionnel. Tapez:
Now start and check the service is running.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>service loki start
<span class="nb">sudo </span>service loki status</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_et_configuration_de_promtail">31.4. Installation et configuration de Promtail</h3>
<div class="paragraph">
<p>Installez maintenant Promtail:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>allez sur le site de <a href="https://github.com/grafana/loki/releases/">Loki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de promtail-linux-amd64.zip (ou promtail-linux-arm.zip pour raspberry pi 3 ou promtail-linux-arm64.zip pour raspberry pi 4 ou 5)</p>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /usr/local/bin
curl <span class="nt">-fSL</span> <span class="nt">-o</span> promtail.zip https://github.com/grafana/loki/releases/download/v1.4.1/promtail-linux-amd64.zip
<span class="nb">gunzip </span>promtail.zip
<span class="nb">chmod </span>a+x promtail</code></pre>
</div>
</div>
</li>
<li>
<p>CrÃ©ez la configuration de Promtail. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/log/journal
vi /etc/config-promtail.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Et ajoutez le texte suivant puis sauvez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://127.0.0.1:3100/api/prom/push

scrape_configs:
- job_name: system
  static_configs:
  - targets:
      - localhost
    labels:
      job: varlogs
      __path__: /var/log/{*.log,*/*.log}</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#firewall">Debloquez le port 9800 sur votre firewall</a></p>
</li>
<li>
<p>testez que Promtail fonctionne. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">promtail <span class="nt">-config</span>.file /etc/config-promtail.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Ouvrez un navigateur et visitez: <a href="http://example.com:9080" class="bare">http://example.com:9080</a></p>
</li>
<li>
<p>Maintenant arrÃªtez Promtail en tapant <strong>CTRL-C</strong>.</p>
</li>
<li>
<p><a href="#firewall">Bloquez le port 9800 sur votre firewall</a></p>
</li>
<li>
<p>Configurez un service Promtail afin de le faire tourner en arriÃ¨re plan. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/promtail.service</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez le texte ci dessous et sauvez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[Unit]
Description=Promtail service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/promtail -config.file /etc/config-promtail.yml

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
</li>
<li>
<p>Maintenant lancez le service et vÃ©rifiez que tout est fonctionnel. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>service promtail start
<span class="nb">sudo </span>service promtail status</code></pre>
</div>
</div>
</li>
<li>
<p>Allez sur votre site grafana <a href="http://grafana.example.com" class="bare">http://grafana.example.com</a> et ajoutez une source de donnÃ©es de type loki</p>
</li>
<li>
<p>Mettez l&#8217;URL suivante: <a href="http://127.0.0.1:3100" class="bare">http://127.0.0.1:3100</a> . Laissez tout le reste tel quel.</p>
</li>
<li>
<p>vous pouvez maintenant explorer vos logs en utilisant le menu explore sur la gauche. Dans la zone texte "Log Labels" essayez ces examples un Ã  un:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>{job="varlogs"}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_grafana">31.5. Upgrade de Grafana</h3>
<div class="paragraph">
<p>Comme grafana est installÃ© Ã  partir de paquets Debian, la mise Ã  jour s&#8217;effectue automatiquement avec le systÃ¨me.</p>
</div>
<div class="paragraph">
<p>Il reste cependant Loki et Promtail Ã  mettre Ã  jour.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>allez sur le site de <a href="https://github.com/grafana/loki/releases/">Loki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de loki-linux-amd64.zip (ou loki-linux-arm.zip pour raspberry pi 3 ou loki-linux-arm64.zip pour raspberry pi 4 ou 5)</p>
</li>
<li>
<p>allez sur le site de <a href="https://github.com/grafana/loki/releases/">Loki</a> et copier l&#8217;adresse du lien vers la derniÃ¨re version de promtail-linux-amd64.zip (ou promtail-linux-arm.zip pour raspberry pi 3 ou promtail-linux-arm64.zip pour raspberry pi 4)</p>
</li>
<li>
<p>Mettez Ã  jour Loki et Promtail Ã  jour. ExÃ©cutez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /usr/local/bin
curl <span class="nt">-fSL</span> <span class="nt">-o</span> loki.gz https://github.com/grafana/loki/releases/download/v2.2.1/loki-linux-amd64.zip
<span class="nb">gunzip </span>loki.gz
<span class="nb">chmod </span>a+x loki
curl <span class="nt">-fSL</span> <span class="nt">-o</span> promtail.zip https://github.com/grafana/loki/releases/download/v2.2.1/promtail-linux-amd64.zip
<span class="nb">gunzip </span>promtail.zip
<span class="nb">chmod </span>a+x promtail</code></pre>
</div>
</div>
</li>
<li>
<p>redÃ©marrez les service. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>service loki restart
<span class="nb">sudo </span>service loki status
<span class="nb">sudo </span>service promtail restart
<span class="nb">sudo </span>service promtail status</code></pre>
</div>
</div>
</li>
<li>
<p>Allez sur votre site Grafana <a href="http://grafana.example.com" class="bare">http://grafana.example.com</a></p>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_du_systÃ¨me_de_backup_borgbackup">32. Installation du systÃ¨me de backup BorgBackup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BorgBackup est un systÃ¨me de backup simple mais offrant des fonctionnalitÃ©s avancÃ©es telles que le backup incrÃ©mental, la dÃ©duplication de donnÃ©es, la compression, l&#8217;authentification, l&#8217;encryption.</p>
</div>
<div class="paragraph">
<p>Borg backup est un systÃ¨me de backup offsite. Cela signifie que vous devez avoir accÃ¨s Ã  un espace de stockage sur un autre site pour effectuer cette sauvegarde.</p>
</div>
<div class="paragraph">
<p>Pour le moment, BorgBackup n&#8217;utilise pas de mÃ©canisme de type RClone et il n&#8217;est donc pas encore possible de sauvegarder sur google drive ou autres espaces partagÃ©s.</p>
</div>
<div class="sect2">
<h3 id="_introduction">32.1. Introduction</h3>
<div class="paragraph">
<p>BorgBackup permet de stocker des backups sur un serveur distant.
Nous nommerons le serveur sur lequel les sauvegardes seront stockÃ©es : serveur de stockage et identifiÃ© par &lt;storing_srv&gt;.
Nous nommerons le serveur qu&#8217;il faut sauvegarder: serveur sauvegardÃ© et identifiÃ© par &lt;example.com&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_serveur_de_stockage">32.2. Installation du serveur de stockage</h3>
<div class="paragraph">
<p>Il est prÃ©fÃ©rable pour des questions de sÃ©curitÃ© de crÃ©er un compte utilisateur spÃ©cifique.</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#pass_gen">GÃ©nÃ©rez un mot de passe long</a></p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sauvegardez prÃ©cieusement ce mot de passe. Il vous sera indispensable pour rÃ©cupÃ©rer vos backup aprÃ¨s un crash du serveur. Sans celui-ci, impossible de rÃ©cupÃ©rer votre installation !
</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez un compte utilisateur. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adduser borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>Copiez-collez le mot de passe gÃ©nÃ©rÃ© lorsqu&#8217;il est demandÃ©</p>
</li>
<li>
<p>se loguer comme <code>borgbackup</code></p>
</li>
<li>
<p>CrÃ©er un rÃ©pertoire <code>~/.ssh</code> s&#8217;il n&#8217;existe pas. tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.ssh
<span class="nb">chmod </span>700 ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>Allez dans le rÃ©pertoire. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> ~/.ssh</code></pre>
</div>
</div>
</li>
<li>
<p>GÃ©nÃ©rez vous clÃ©s. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-keygen <span class="nt">-t</span> rsa</code></pre>
</div>
</div>
</li>
<li>
<p>Un ensemble de questions apparaÃ®t. Si un texte vous explique que le fichier existe dÃ©jÃ , arrÃªtez la procÃ©dure. Cela signifie que vous avez dÃ©jÃ  crÃ©Ã© une clÃ© et que vous risquez de perdre la connexion Ã  d&#8217;autres serveurs si vous en gÃ©nÃ©rez une nouvelle. Sinon, appuyez sur EntrÃ©e Ã  chaque fois pour accepter les valeurs par dÃ©faut.</p>
</li>
<li>
<p>CrÃ©ez maintenant le rÃ©pertoire pour recevoir les sauvegardes</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd
mkdir </span>borgbackup
<span class="nb">chmod </span>700 borgbackup</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_sur_le_serveur_sauvegardÃ©">32.3. Installation sur le serveur sauvegardÃ©</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>Copiez la clÃ© publique de root sur le &lt;storing_srv&gt;. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh-copy-id <span class="nt">-i</span> ~/.ssh/id_<span class="k">*</span>.pub borgbackup@&lt;storing_srv&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Coller le mot de passe gÃ©nÃ©rÃ© plus haut lorsqu&#8217;il est demandÃ©</p>
</li>
<li>
<p>Affichez votre adresse IP. tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget <span class="nt">-qO-</span> http://ipecho.net/plain<span class="p">;</span> <span class="nb">echo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Faites un essai de connexion en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ssh borgbackup@&lt;storing_srv&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Aucun mot de passe ne doit Ãªtre demandÃ©e et vous devez Ãªtre connectÃ© en tant que borgbackup sur le &lt;storing_srv&gt;</p>
</li>
<li>
<p>Si vous Ãªtes trÃ¨s attachÃ© Ã  la sÃ©curitÃ©, vous pouvez restreindre l&#8217;accÃ¨s au seul serveur &lt;example.com&gt;. Tapez sur la ligne de commande du &lt;storing_srv&gt; :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi ~/.ssh/authorized_keys</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez en premiÃ¨re ligne du fichier :</p>
<div class="listingblock">
<div class="content">
<pre>from="SERVERIPADDRESS",command="borg serve --restrict-to-path /home/borgbackup/borgbackup/",no-pty,no-agent-forwarding,no-port-forwarding,no-X11-forwarding,no-user-rc <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez SERVERIPADDRESS par l&#8217;adresse IP affichÃ©e plus tÃ´t.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Fusionnez cette ligne avec la suivante qui dÃ©marre par ssh en prenant bien garde de laissez un espace entre no-user-rc et ssh-rsa</p>
</li>
<li>
<p>DÃ©connectez vous en tapant :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">exit</span></code></pre>
</div>
</div>
</li>
<li>
<p>De retour sur le serveur &lt;example.com&gt;</p>
</li>
<li>
<p><a href="#pass_gen">CrÃ©ez un mot de passe pour le dÃ©pot borg backup</a>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sauvegardez prÃ©cieusement ce mot de passe. Il vous sera indispensable pour rÃ©cupÃ©rer vos backup aprÃ¨s un crash du serveur. Sans celui-ci, impossible de rÃ©cupÃ©rer votre installation !
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Puis tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut</td>
</tr>
</table>
</div>
</li>
<li>
<p>Initialisez le dÃ©pot borg. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">borg init <span class="nt">-e</span> repokey-blake2 borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
</li>
<li>
<p>Tout est maintenant prÃªt pour faire un backup</p>
</li>
<li>
<p>avec le mode <code>repokey</code>, une clÃ© de cryptage est stockÃ©e dans le repository de backup. Il est conseillÃ© de la sauvegarder. Pour cela, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">borg key <span class="nb">export </span>borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
</li>
<li>
<p>Notez bien la clÃ© qui sert Ã  dÃ©crypter le repository dans un endroit sÃ©curisÃ©
=== Effectuer un backup</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous allons crÃ©er tout d&#8217;abord un script de backup pour sauvegarder tout le serveur sauf les rÃ©pertoires systÃ¨me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">cd</span> / <span class="o">&amp;&amp;</span> /usr/bin/borg create <span class="nt">--stats</span> <span class="nt">--progress</span> <span class="nt">--compress</span> zstd borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::<span class="sb">`</span><span class="nb">hostname</span><span class="sb">`</span>-<span class="sb">`</span><span class="nb">date</span> +%Y-%m-%d-%H-%M-%S<span class="sb">`</span> ./ <span class="nt">--exclude</span><span class="o">=</span>dev <span class="nt">--exclude</span><span class="o">=</span>proc <span class="nt">--exclude</span><span class="o">=</span>run <span class="nt">--exclude</span><span class="o">=</span>root/.cache/ <span class="nt">--exclude</span><span class="o">=</span>mnt/borgmount <span class="nt">--exclude</span><span class="o">=</span>sys <span class="nt">--exclude</span><span class="o">=</span>swapfile <span class="nt">--exclude</span><span class="o">=</span>tmp <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>en fonction de la puissance de votre machine, vous pouvez remplacer l&#8217;algorithme de compression zstd par un algorithme lz4 (rapide) ou  lzma (trÃ¨s lent mais performant en taille).</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant effectuer une premiÃ¨re sauvegarde en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgbackup.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_lister_les_backups">32.4. Lister les backups</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de listage :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg list <span class="nt">-v</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant lister vos backup en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borglist.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_obtenir_les_infos_sur_un_backup">32.5. Obtenir les infos sur un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de listage :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borginfo.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg info <span class="nt">--progress</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::<span class="nv">$1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borginfo.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant lister vos backup en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borginfo.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_vÃ©rifier_un_backup">32.6. VÃ©rifier un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de vÃ©rification :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgcheck.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg check <span class="nt">--progress</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::<span class="nv">$1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgcheck.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant vÃ©rifier un de vos backup en tapant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgcheck.sh &lt;nom_de_sauvegarde&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>le nom de sauvegarde est rÃ©cupÃ©rÃ© en utilisant la commande borglist.sh</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_restaurer_un_backup">32.7. Restaurer un backup</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de montage sous forme de systÃ¨me de fichier :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/borgbackup
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg mount borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/ /mnt/borgbackup</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant monter vos backups et effectuer des opÃ©rations de fichiers. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgmount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Pour crÃ©er un script pour dÃ©monter les backups. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
umount /mnt/borgbackup
<span class="nb">rmdir</span> /mnt/borgbackup</code></pre>
</div>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant demonter vos backups. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgumount.sh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_supprimer_vos_vieux_backups">32.8. Supprimer vos vieux backups</h3>
<div class="paragraph">
<p>Nous allons crÃ©er un script de mÃ©nage des backups :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;example.com&gt;. </a></p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>

<span class="c"># Nettoyage des anciens backups</span>
<span class="c"># On conserve</span>
<span class="c"># - une archive par jour les 7 derniers jours,</span>
<span class="c"># - une archive par semaine pour les 4 derniÃ¨res semaines,</span>
<span class="c"># - une archive par mois pour les 6 derniers mois.</span>


<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg prune <span class="nt">--stats</span> <span class="nt">--progress</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/ <span class="nt">--prefix</span> <span class="sb">`</span><span class="nb">hostname</span><span class="sb">`</span>- <span class="nt">--keep-daily</span><span class="o">=</span>7 <span class="nt">--keep-weekly</span><span class="o">=</span>4 <span class="nt">--keep-monthly</span><span class="o">=</span>12 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Le nettoyage des sauvegardes va conserver 7 sauvegardes journaliÃ¨res, 4 Ã  la semaine et 12 au mois</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant effectuer du mÃ©nage:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgprune.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Pour rÃ©cupÃ¨rer l&#8217;espace libÃ©rÃ© par la suppression des sauvegardes inutiles, crÃ©ez le script suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /usr/local/bin/borgcompact.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ¨rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>

<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
/usr/bin/borg compact <span class="nt">--progress</span>  borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mot_passe doit Ãªtre remplacÃ© par celui gÃ©nÃ©rÃ© plus haut.</td>
</tr>
</table>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgcompact.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez maintenant effectuer du mÃ©nage:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/usr/local/bin/borgcompact.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>=== Automatisez votre sauvegarde</p>
</div>
</li>
<li>
<p>Pour crÃ©er un script automatisÃ© de backup. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/log/borg
vi /usr/local/bin/borgcron.sh</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c"># Script de sauvegarde.</span>
<span class="c">#</span>

<span class="nb">set</span> <span class="nt">-e</span>

<span class="nv">LOG_PATH</span><span class="o">=</span>/var/log/borg/cron.log

/usr/local/bin/borgbackup.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">LOG_PATH</span><span class="k">}</span> 2&gt;&amp;1
/usr/local/bin/borgprune.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">LOG_PATH</span><span class="k">}</span> 2&gt;&amp;1
/usr/local/bin/borgcompact.sh <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">LOG_PATH</span><span class="k">}</span> 2&gt;&amp;1</code></pre>
</div>
</div>
</li>
<li>
<p>changez les permissions du script. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">chmod </span>700 /usr/local/bin/borgcron.sh</code></pre>
</div>
</div>
</li>
<li>
<p>vous pouvez ensuite planifier votre backup Ã  1h du matin. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">crontab <span class="nt">-e</span></code></pre>
</div>
</div>
</li>
<li>
<p>Inserez ensuite le texte suivant:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre># Backup via Borg to backup server
00 01 * * * /usr/local/bin/borgcron.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restauration_durgence">32.9. Restauration d&#8217;urgence.</h3>
<div class="paragraph">
<p>En cas de crash du serveur, lâintÃ©rÃªt du backup offsite est de pouvoir remonter la derniÃ¨re sauvegarde sans souci.
Pour cela il faut avoir un moyen de booter le serveur dans un mode rescue (boot du VPS en mode rescue, utilisation d&#8217;un clÃ© USB bootable, boot rÃ©seau ou autre moyen).</p>
</div>
<div class="paragraph">
<p>On suppose dans ce qu&#8217;il suit que vous avez bootÃ© sur un linux de type debian ou ubuntu dont la version n&#8217;est pas la toute derniÃ¨re et dans laquelle borg-backup n&#8217;est pas obligatoirement prÃ©sent du moins dans un version suffisamment rÃ©cente.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>loguez vous root sur votre serveur. A noter que, comme vous Ãªtes en mode rescue, l&#8217;accÃ¨s au mode est indiquÃ© par votre hÃ©bergeur ou, si vous avez bootÃ© sur une clÃ© USB en local, l&#8217;accÃ¨s root s&#8217;effectue souvent avec une commande <code>sudo bash</code></p>
</li>
<li>
<p>Montez votre partition racine. Sur un VPS, la partition est souvent dÃ©jÃ  montÃ©e dans le rÃ©pertoire /mnt. Sur un PC c&#8217;est souvent /dev/sda1. Sur un Raspberry Pi cette partition est /dev/mmcblk0p7. Tapez la commande:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/root
mount /dev/mmcblk0p7 /mnt/root</code></pre>
</div>
</div>
</li>
<li>
<p>Installez borgbackup. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-pip libssl-dev cython3 gcc g++ libpython3-dev libacl1-dev python3-llfuse libfuse-dev
pip3 <span class="nb">install</span> <span class="nt">-U</span> pip setuptools wheel
pip3 <span class="nb">install </span>pkgconfig
pip3 <span class="nb">install </span>borgbackup[llfuse]</code></pre>
</div>
</div>
</li>
<li>
<p>Si la compilation Ã©choue, c&#8217;est qu&#8217;il manque des packages. lisez attentivement les logs et installez les packages manquant.</p>
</li>
<li>
<p>Munissez vous du mot de passe &lt;mot_passe&gt; des archives borg et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /mnt/borgbackup
<span class="nb">export </span><span class="nv">BORG_PASSPHRASE</span><span class="o">=</span><span class="s1">'mot_passe'</span> <i class="conum" data-value="1"></i><b>(1)</b>
borg list borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacez mot_passe par votre mot de passe de borg</td>
</tr>
</table>
</div>
</li>
<li>
<p>tapez le mot de passe du compte borgbackup.</p>
</li>
<li>
<p>la liste des sauvegardes est affichÃ©es Ã  l&#8217;Ã©cran.</p>
</li>
<li>
<p>Choisissez l&#8217;archive qui vous convient et tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /mnt/root
borg extract <span class="nt">--list</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::&lt;votre_archive&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>tapez le mot de passe du compte borgbackup.</p>
</li>
<li>
<p>la restauration s&#8217;effectue et peut prendre des heures ! soyez patient.</p>
</li>
<li>
<p>il peut Ãªtre nÃ©cessaire de rÃ©installer le bootloader (non utile sur VPS ou raspberry). Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /mnt/root
<span class="nb">chroot</span> <span class="nb">.</span> bash
<span class="nb">mkdir</span> <span class="nt">-p</span> dev proc run sys tmp
mount <span class="nt">-t</span> devtmpfs dev /dev
mount <span class="nt">-t</span> proc proc /proc
grub_install /dev/sda <i class="conum" data-value="1"></i><b>(1)</b>
umount /proc
umount /dev
<span class="nb">sync
exit</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tapez ici le nom de device de votre disque de boot</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez votre fichier de swap en suivant <a href="#swap_create">la
procÃ©dure</a>. Attention le fichier de swap doit Ãªtre installÃ© dans
<code>/mnt/root/swapfile</code></p>
</li>
<li>
<p>vous pouvez maintenant rebooter votre machine en mode normal.</p>
</li>
<li>
<p>une autre faÃ§on de remonter la sauvegarde est d&#8217;extraire un fichier tar.xz directement du serveur de stockage et de transfÃ©rer cette archive sur la machine en mode rescue puis de dÃ©compresser. La commande de gÃ©nÃ©ration d&#8217;archive est:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">borg export-tar <span class="nt">--list</span> borgbackup@&lt;storing_srv&gt;:/home/borgbackup/borgbackup/::&lt;votre_archive&gt; restore.tar.xz</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_borgweb">32.10. Installation de Borgweb</h3>
<div class="paragraph">
<p>Borgweb existe en version officielle. Cette version n&#8217;a pas trop d&#8217;intÃ©ret pour nous Ã©tant donnÃ©e qu&#8217;elle n&#8217;interroge pas le serveur de stockage pour obtenir les informations des backups rÃ©alisÃ©s. Il existe un clone de repository qui implÃ©mente une fonctionnalitÃ© qui liste tous les backups effectuÃ©s sur le serveur de stockage</p>
</div>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante sur le serveur de stockage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>Installez pip  pour python3 et NPM. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">apt <span class="nb">install </span>python3-pip npm</code></pre>
</div>
</div>
</li>
<li>
<p>Installer le logiciel dans le rÃ©pertoire <code>/var/lib/borgweb</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /var/lib/borgweb
<span class="nb">cd</span> /var/lib/borgweb
git clone https://github.com/vche/borgweb.git</code></pre>
</div>
</div>
</li>
<li>
<p>Dans la version testÃ©e, le fichier <code>README.rst</code> est utilisÃ© par l&#8217;installeur mais plus prÃ©sent dans le repo. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>borgweb
<span class="nb">touch </span>README.rst</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez l&#8217;installation. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">pip3 <span class="nb">install</span> <span class="nt">-e</span> <span class="nb">.</span>
<span class="nb">cd </span>js
npm <span class="nb">install</span></code></pre>
</div>
</div>
</li>
<li>
<p>Editez la configuration. Comme la variable d&#8217;environnement <code>BORG_CONFIG</code> semble n&#8217;avoir aucun effet, Ã©ditez directement le fichier de configuration du repository. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /var/lib/borgweb/borgweb/borgweb
vi config.py</code></pre>
</div>
</div>
</li>
<li>
<p>Mettez ce texte dans le fichier Ã©ditÃ©:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">This is the basic configuration class for BorgWeb.</span><span class="sh">"""</span>

    <span class="c1">#: builtin web server configuration
</span>    <span class="n">HOST</span> <span class="o">=</span> <span class="sh">'</span><span class="s">127.0.0.1</span><span class="sh">'</span>  <span class="c1"># use 0.0.0.0 to bind to all interfaces
</span>    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># ports &lt; 1024 need root
</span>    <span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span>

    <span class="c1">#: borg / borgweb configuration
</span>    <span class="n">LOG_DIR</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/var/log/borg</span><span class="sh">'</span>
    <span class="n">BORG_PATH</span><span class="o">=</span><span class="sh">"</span><span class="s">/usr/bin/borg</span><span class="sh">"</span>

    <span class="c1"># Repo status cache configuration. TTL in secs
</span>    <span class="n">STATUS_CACHE_TTL</span><span class="o">=</span><span class="mi">43200</span>
    <span class="n">STATUS_CACHE_PATH</span><span class="o">=</span><span class="sh">"</span><span class="s">/tmp/borgweb.cache</span><span class="sh">"</span>

    <span class="n">BACKUP_REPOS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># Repo  name
</span>        <span class="sh">"</span><span class="s">example.com</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="c1"># Repo absolute path
</span>            <span class="sh">"</span><span class="s">repo_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/home/borgbackup/borgbackup</span><span class="sh">"</span><span class="p">,</span>

            <span class="c1"># Repo logs absolute path, or relative to the main LOG_DIR
</span>            <span class="sh">"</span><span class="s">log_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/var/log/borg/</span><span class="sh">"</span><span class="p">,</span>

            <span class="c1"># Repo password
</span>            <span class="sh">"</span><span class="s">repo_pwd</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">your_password</span><span class="sh">"</span><span class="p">,</span> <i class="conum" data-value="1"></i><b>(1)</b>

            <span class="c1"># Command/script to run to manually start a backup.
</span>            <span class="c1"># If left empty or not specified, the backup won't be
</span>            <span class="c1"># manually runnable
</span>            <span class="sh">"</span><span class="s">script</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">script</span><span class="sh">"</span><span class="p">,</span>

            <span class="c1"># Filled with discovered backups in the repo
</span>            <span class="sh">"</span><span class="s">backups</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>InsÃ©rez ici le mot de passe du dÃ©pot Borg Backup</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mettez ici le nom de votre domaine sauvegardÃ©</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez un service <code>systemd</code>. Editez le fichier de service. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/systemd/system/borgweb.service</code></pre>
</div>
</div>
</li>
<li>
<p>InsÃ©rez dans le fichier le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>[Unit]
Description=Borgweb Daemon
After=syslog.target network.target

[Service]
WorkingDirectory=/var/lib/borgweb
User=root
Group=root
UMask=0002
Restart=on-failure
RestartSec=5
Type=simple
ExecStart=/usr/local/bin/borgweb
KillSignal=SIGINT
TimeoutStopSec=20
SyslogIdentifier=borgweb

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
</li>
<li>
<p>Recharge la base de systemd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl daemon-reload</code></pre>
</div>
</div>
</li>
<li>
<p>Activez et dÃ©marrez <code>borgweb</code>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl <span class="nb">enable </span>borgweb.service
systemctl start borgweb.service</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_borgweb">32.11. CrÃ©ation du site web de Borgweb</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig de votre serveur de stockage &lt;storing_srv&gt;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>borgweb</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>borgweb</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>borgweb</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="c"># borgweb httpserver</span>
<span class="c">#</span>

<span class="p">&lt;</span><span class="nl">Location</span><span class="sr"> /</span><span class="p">&gt;
</span>    <span class="nc">AllowOverride</span> <span class="ss">AuthConfig</span>
    <span class="nc">AuthUserFile</span> /var/lib/borgweb/borgweb-htpasswd
    <span class="nc">AuthName</span> "Borgweb"
    <span class="nc">AuthType</span> <span class="ss">Basic</span>
    <span class="nc">Require</span> valid-user

<span class="p">&lt;/</span><span class="nl">Location</span><span class="p">&gt;
</span>

<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># borgweb httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>
<span class="nc">ProxyPass</span> / http://localhost:5000/
<span class="nc">ProxyPassReverse</span> / http://localhost:5000/

<span class="nc">RedirectMatch</span> ^/$ https://borgweb.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#root_login">Loguez vous comme root sur &lt;storing_srv&gt;. </a></p>
</li>
<li>
<p>CrÃ©ez ensuite le fichier de mot de passe de borgweb dans votre &lt;storing_srv&gt;:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">htpasswd <span class="nt">-c</span> /var/lib/borgweb/borgweb-htpasswd admin</code></pre>
</div>
</div>
</li>
<li>
<p>Tapez <a href="#pass_gen">votre mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p>RedÃ©marrez apache. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">service apache2 restart</code></pre>
</div>
</div>
</li>
<li>
<p>Pointez votre navigateur sur <a href="https://borgweb.storing_srv" class="bare">https://borgweb.storing_srv</a> , un mot de passe vous est demandÃ©. Tapez <code>admin</code> pour le user et le password saisi. Vous accÃ©dez aux informations de sauvegarde de votre site.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_dun_serveur_de_vpn_wireguard">33. Installation d&#8217;un serveur de VPN Wireguard</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_wireguard">33.1. CrÃ©ation du site web de Wireguard</h3>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>wireguard</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>wireguard</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>wireguard</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># wireguard httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> / http://localhost:51821/
<span class="nc">ProxyPassReverse</span> / http://localhost:51821/

<span class="nc">RedirectMatch</span> ^/$ https://wireguard.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_de_wireguard">33.2. Installation de Wireguard</h3>
<div class="paragraph">
<p>Nous allons installer wg-easy qui est un container qui implÃ©mente wireguard dans un docker.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Installez Wireguard. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span><span class="o">=</span>wg-easy <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">LANG</span><span class="o">=</span>fr <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">WG_HOST</span><span class="o">=</span>Public_IP <span class="se">\ </span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">-e</span> <span class="nv">PASSWORD</span><span class="o">=</span>mot_de_passe <span class="se">\ </span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">-e</span> <span class="nv">PORT</span><span class="o">=</span>51821 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">WG_PORT</span><span class="o">=</span>51820 <span class="se">\</span>
  <span class="nt">-v</span> /etc/wg-easy:/etc/wireguard <span class="se">\</span>
  <span class="nt">-p</span> 51820:51820/udp <span class="se">\</span>
  <span class="nt">-p</span> 51821:51821/tcp <span class="se">\</span>
  <span class="nt">--cap-add</span><span class="o">=</span>NET_ADMIN <span class="se">\</span>
  <span class="nt">--cap-add</span><span class="o">=</span>SYS_MODULE <span class="se">\</span>
  <span class="nt">--sysctl</span><span class="o">=</span><span class="s2">"net.ipv4.conf.all.src_valid_mark=1"</span> <span class="se">\</span>
  <span class="nt">--sysctl</span><span class="o">=</span><span class="s2">"net.ipv4.ip_forward=1"</span> <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  ghcr.io/wg-easy/wg-easy</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>saisir votre adresse IP publique donnÃ©e par exemple sur le site <a href="https://www.showmyip.com/" class="bare">https://www.showmyip.com/</a>. Attention ce doit Ãªtre une IP V4</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a></td>
</tr>
</table>
</div>
</li>
<li>
<p>Configurez votre firewall pour ouvrir le port 51820 en mode UDP</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_update_de_wireguard">33.3. Update de Wireguard</h3>
<div class="paragraph">
<p>Rien a faire pour la mise Ã  jour si vous utilisez <code>Watchtower</code></p>
</div>
<div class="paragraph">
<p>Sinon, effectuez les opÃ©rations suivantes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Allez dans le rÃ©pertoire de root</p>
</li>
<li>
<p>Mettez Ã  jour le docker de wg-easy. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">docker pull ghcr.io/wg-easy/wg-easy
docker stop wg-easy
docker <span class="nb">rm </span>wg-easy
docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span><span class="o">=</span>wg-easy <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">LANG</span><span class="o">=</span>fr <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">WG_HOST</span><span class="o">=</span>Public_IP <span class="se">\ </span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">-e</span> <span class="nv">PASSWORD</span><span class="o">=</span>mot_de_passe <span class="se">\ </span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">-e</span> <span class="nv">PORT</span><span class="o">=</span>51821 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">WG_PORT</span><span class="o">=</span>51820 <span class="se">\</span>
  <span class="nt">-v</span> /etc/wg-easy:/etc/wireguard <span class="se">\</span>
  <span class="nt">-p</span> 51820:51820/udp <span class="se">\</span>
  <span class="nt">-p</span> 51821:51821/tcp <span class="se">\</span>
  <span class="nt">--cap-add</span><span class="o">=</span>NET_ADMIN <span class="se">\</span>
  <span class="nt">--cap-add</span><span class="o">=</span>SYS_MODULE <span class="se">\</span>
  <span class="nt">--sysctl</span><span class="o">=</span><span class="s2">"net.ipv4.conf.all.src_valid_mark=1"</span> <span class="se">\</span>
  <span class="nt">--sysctl</span><span class="o">=</span><span class="s2">"net.ipv4.ip_forward=1"</span> <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  ghcr.io/wg-easy/wg-easy</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>saisir votre adresse IP publique donnÃ©e par exemple sur le site <a href="https://www.showmyip.com/" class="bare">https://www.showmyip.com/</a>. Attention ce doit Ãªtre une IP V4</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>saisir <a href="#pass_gen">un mot de passe gÃ©nÃ©rÃ©</a></td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_dun_serveur_de_bureau_Ã _distance_guacamole">34. Installation d&#8217;un serveur de bureau Ã  distance Guacamole</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Guacamole est un logiciel opensource et une application web de bureau Ã  distance qui vous permet d&#8217;accÃ©der Ã  vos machines de bureau par le biais d&#8217;un navigateur web. Il s&#8217;agit d&#8217;une appli web html5 qui prend en charge des protocoles standard comme VNC, RDP et SSH. Vous n&#8217;avez pas besoin d&#8217;installer et d&#8217;utiliser des logiciels ou des plugins sur le serveur. Avec Guacamole, vous pouvez facilement passer d&#8217;un bureau d&#8217;une machine Ã  l&#8217;autre avec le mÃªme navigateur.</p>
</div>
<div class="paragraph">
<p>Guacamole est assez ancien et d&#8217;un point de vue protocole, il ne saura pas se connecter avec des serveurs VNC utilisants les stack cryptos rÃ©centes. Il faut se mettre en version compatible 3.8 de serveur VNC.</p>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_du_site_web_de_guacamole">34.1. CrÃ©ation du site web de Guacamole</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes Dans ISPConfig:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allez dans la rubrique <code>DNS</code>, sÃ©lectionnez le menu <code>Zones</code>, SÃ©lectionnez votre Zone, Allez dans l&#8217;onglet <code>Records</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Cliquez sur <code>A</code> et saisissez:</p>
<div class="ulist">
<ul>
<li>
<p><code>Hostname:</code> &#8592; Tapez <code>guacamole</code></p>
</li>
<li>
<p><code>IP-Address:</code> &#8592; Double cliquez et sÃ©lectionnez l&#8217;adresse IP de votre serveur</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>CrÃ©er un <a href="#subdomain-site">sub-domain (vhost)</a> dans le configurateur de sites.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Lui donner le nom <code>guacamole</code>.</p>
</li>
<li>
<p>Le faire pointer vers le web folder <code>guacamole</code>.</p>
</li>
<li>
<p>SÃ©lectionnez <code>None</code> dans <code>Auto-subdomain</code></p>
</li>
<li>
<p>Activer <code>letâs encrypt SSL</code></p>
</li>
<li>
<p>Activer <code>PHP-FPM</code> pour PHP</p>
</li>
<li>
<p>Dans l&#8217;onglet Redirect Cochez la case <code>Rewrite HTTP to HTTPS</code></p>
</li>
<li>
<p>Laisser le reste par dÃ©faut.</p>
</li>
<li>
<p>Dans lâonglet Options:</p>
</li>
<li>
<p>Dans la boite <code>Apache Directives:</code> saisir le texte suivant:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="apache"><span class="p">&lt;</span><span class="nl">Proxy</span><span class="sr"> *</span><span class="p">&gt;
</span><span class="nc">Order</span> deny,allow
<span class="nc">Allow</span> <span class="ss">from</span> <span class="ss">all</span>
<span class="p">&lt;/</span><span class="nl">Proxy</span><span class="p">&gt;
</span>
<span class="nc">ProxyRequests</span> <span class="ss">Off</span>
<span class="nc">ProxyPass</span> /stats !
<span class="nc">ProxyPass</span> /.well-known/acme-challenge !

<span class="c"># guacamole httpserver</span>
<span class="c">#</span>

<span class="nc">SetEnvIf</span> Authorization "(.*)" HTTP_AUTHORIZATION=$1
<span class="nc">ProxyPreserveHost</span>    <span class="ss">On</span>

<span class="nc">ProxyPass</span> /guacamole http://localhost:8085/guacamole
<span class="nc">ProxyPassReverse</span> /guacamole http://localhost:8085/guacamole

<span class="nc">RedirectMatch</span> ^/$ https://guacamole.example.com <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>remplacer <code>example.com</code> par votre nom de domaine</td>
</tr>
</table>
</div>
</li>
<li>
<p>Cliquez sur <code>Save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_crÃ©ation_des_bases_de_donnÃ©es_9">34.2. CrÃ©ation des bases de donnÃ©es</h3>
<div class="paragraph">
<p>Appliquez les opÃ©rations suivantes dans ISPConfig :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CrÃ©ez une base de donnÃ©es mysql. Aller dans le menu <code>Database</code> pour dÃ©finir un utilisateur MariaDB</p>
</li>
<li>
<p>Aller dans la rubrique <code>Sites</code></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Aller dans le menu <code>Database users</code> pour dÃ©finir un utilisateur MariaDB</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Cliquez sur <code>Add new User</code> pour crÃ©er un nouvel utilisateur</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Database user:</code> &#8592;  saisir votre nom d&#8217;utilisateur <code>guacamole</code> par exemple</p>
</li>
<li>
<p><code>Database password:</code> &#8592; <a href="#pass_gen">Saisissez un mot de passe gÃ©nÃ©rÃ©</a> ou en gÃ©nÃ©rer un en cliquant sur le bouton</p>
</li>
<li>
<p><code>Repeat Password:</code> &#8592; saisir de nouveau le mot de passe</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
<li>
<p>Cliquez sur <code>Add new Database</code> pour crÃ©er une nouvelle base de donnÃ©es</p>
</li>
<li>
<p>Saisissez les informations:</p>
<div class="ulist">
<ul>
<li>
<p><code>Site:</code> &#8592; sÃ©lectionner le site <code>example.com</code></p>
</li>
<li>
<p><code>Database name:</code> &#8592; Saisissez le nom de la base de donnÃ©es <code>guacamole</code></p>
</li>
<li>
<p><code>Database user:</code> &#8592; Saisir ici le nom d&#8217;utilisateur crÃ©Ã©: <code>cxguacamole</code>. x: est le numÃ©ro de client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>save</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installation_du_guacamole">34.3. Installation du Guacamole</h3>
<div class="paragraph">
<p>Suivez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>Guacamole n&#8217;est pas compatible aujourd&#8217;hui (version 1.5.5) de Tomcat10. Or c&#8217;est la version prÃ©sente dans la derniÃ¨re version de Debian. Je vous conseille donc d&#8217;installer tomcat9 de la version de debian prÃ©cÃ©dente.</p>
</li>
<li>
<p>Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://deb.debian.org/debian/ bullseye main"</span> <span class="o">&gt;</span> /etc/apt/sources.list.d/bullseye.list
apt update
apt <span class="nb">install </span>tomcat9 tomcat9-admin tomcat9-common tomcat9-user
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/^/#/'</span> /etc/apt/sources.list.d/bullseye.list
apt <span class="nb">install </span>gcc g++ libossp-uuid-dev libavcodec-dev libpango1.0-dev libssh2-1-dev libcairo2-dev libjpeg-dev libpng-dev libavutil-dev libavformat-dev libswscale-dev libvncserver-dev libssl-dev libvorbis-dev libwebp-dev freerdp2-dev libtelnet-dev libswscale-dev libossp-uuid-dev libwebsockets-dev libpulse-dev  libmariadb-java</code></pre>
</div>
</div>
</li>
<li>
<p>Par ailleurs, Guacamole pose des problÃ¨mes de compatibilitÃ©s avec IP V6.</p>
</li>
<li>
<p>Editez votre fichier <code>/etc/hosts</code> et commentez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#::1            localhost ip6-localhost ip6-loopback</span></code></pre>
</div>
</div>
</li>
<li>
<p>TÃ©lÃ©chargez la derniÃ¨re version de Guacamole en allant sur le site web et en rÃ©cupÃ©rant le <a href="https://guacamole.apache.org/releases/">lien de tÃ©lÃ©chargement</a>.</p>
</li>
<li>
<p>tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
curl <span class="nt">-fSL</span> <span class="nt">-o</span> guacamole-server.tar.gz <span class="s1">'https://apache.org/dyn/closer.lua/guacamole/1.5.5/source/guacamole-server-1.5.5.tar.gz?action=download'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">tar </span>xfz guacamole-server.tar.gz
<span class="nb">cd </span>guacamole-server-<span class="k">*</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insÃ©rez ici l&#8217;adresse du package serveur Ã  charger</td>
</tr>
</table>
</div>
</li>
<li>
<p>Lancez la configuration. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./configure <span class="nt">--with-init-dir</span><span class="o">=</span>/etc/init.d</code></pre>
</div>
</div>
</li>
<li>
<p>Vous devez obtenir, Ã  la fin de la configuration, une table de ce type:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>------------------------------------------------
guacamole-server version 1.5.5
------------------------------------------------

   Library status:

     freerdp2 ............ yes
     pango ............... yes
     libavcodec .......... yes
     libavformat.......... yes
     libavutil ........... yes
     libssh2 ............. yes
     libssl .............. yes
     libswscale .......... yes
     libtelnet ........... yes
     libVNCServer ........ yes
     libvorbis ........... yes
     libpulse ............ yes
     libwebsockets ....... yes
     libwebp ............. yes
     wsock32 ............. no

   Protocol support:

      Kubernetes .... yes
      RDP ........... yes
      SSH ........... yes
      Telnet ........ yes
      VNC ........... yes

   Services / tools:

      guacd ...... yes
      guacenc .... yes
      guaclog .... yes</code></pre>
</div>
</div>
</li>
<li>
<p>Si ce n&#8217;est pas le cas, c&#8217;est qu&#8217;une bibliothÃ¨que n&#8217;est pas installÃ©e correctement.</p>
</li>
<li>
<p>Lancez la compilation et l&#8217;installation. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">make
make <span class="nb">install
</span>ldconfig</code></pre>
</div>
</div>
</li>
<li>
<p>Activez le dÃ©mon de gestion guacd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl daemon-reload
systemctl <span class="nb">enable </span>guacd
systemctl start guacd</code></pre>
</div>
</div>
</li>
<li>
<p>TÃ©lÃ©chargez le dernier client <code>war</code> de Guacamole en allant sur le site web et en rÃ©cupÃ©rant le <a href="https://guacamole.apache.org/releases/">lien de tÃ©lÃ©chargement</a>. RÃ©cupÃ©rez le lien puis tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /usr/local/share/guacamole
<span class="nb">cd</span> /usr/local/share/guacamole
curl <span class="nt">-fSL</span> <span class="nt">-o</span> guacamole.war <span class="s1">'https://apache.org/dyn/closer.lua/guacamole/1.5.5/binary/guacamole-1.5.5.war?action=download'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">ln</span> <span class="nt">-s</span> /usr/local/share/guacamole/guacamole.war /var/lib/tomcat9/webapps/
systemctl restart tomcat9
systemctl restart guacd</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insÃ©rez ici l&#8217;adresse du war Ã  charger</td>
</tr>
</table>
</div>
</li>
<li>
<p>Editez le fichier server.xml. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/tomcat9/server.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Chercher <code>Connector port="8080" protocol="HTTP/1.1</code> et remplacer partout le port <code>8080</code> par <code>8085</code></p>
</li>
<li>
<p>CrÃ©ez les rÃ©pertoires de configuration de guacamole. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/guacamole
<span class="nb">mkdir</span> <span class="nt">-p</span> /etc/guacamole/<span class="o">{</span>extensions,lib<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>RÃ©cupÃ©rez le driver mysql/mariadb pour java. Sur la plupart des Linux, il est prÃ©sent dans <code>/usr/share/java</code>. Pour le copier, tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">ln</span> <span class="nt">-s</span> /usr/share/java/mariadb-java-client.jar /etc/guacamole/lib/</code></pre>
</div>
</div>
</li>
<li>
<p>Il se peut que ce driver ne soit pas prÃ©sent: allez sur le site <a href="https://dev.mysql.com/downloads/connector/j/">Mysql</a> et tÃ©lÃ©chargez la version Platform independant. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-fSL</span> <span class="nt">-o</span> mysql-java.tar.gz <span class="s1">'https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-j-8.3.0.tar.gz'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">tar </span>xfz mysql-java.tar.gz
<span class="nb">cd </span>mysql-connector-java-<span class="k">*</span>
<span class="nb">cp </span>mysql-connector-java-<span class="k">*</span>.jar /etc/guacamole/lib/mysql-connector-java.jar</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Collez ici le lien rÃ©cupÃ©rÃ© sur le site de Mysql.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Editez le fichier guacamole.properties. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">vi /etc/guacamole/guacamole.properties</code></pre>
</div>
</div>
</li>
<li>
<p>Ajoutez dans le fichier:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>mysql-hostname: localhost
mysql-port: 3306
mysql-database: cxguacamole <i class="conum" data-value="1"></i><b>(1)</b>
mysql-username: cxguacamole <i class="conum" data-value="1"></i><b>(1)</b>
mysql-password: &lt;mot_de_passe&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez ici le nom de la base de donnÃ©es, le nom de l&#8217;utilisateur de la base et son mot_de_passe tels qu&#8217;ils ont Ã©tÃ© saisis dans le chapitre de crÃ©ation de la base de donnÃ©es.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Vous devez maintenant tÃ©lÃ©charger les plugins mysql pour Guacamole. Allez sur le site web de guacamole et rÃ©cupÃ©rez le <a href="https://guacamole.apache.org/releases/">lien de tÃ©lÃ©chargement de guacamole-auth-jdbc</a>. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
curl <span class="nt">-fSL</span> <span class="nt">-o</span> guacamole-auth-jdbc.tar.gz <span class="s1">'https://apache.org/dyn/closer.lua/guacamole/1.5.5/binary/guacamole-auth-jdbc-1.5.5.tar.gz?action=download'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">tar </span>xfz guacamole-auth-jdbc.tar.gz
<span class="nb">cd </span>guacamole-auth-jdbc-<span class="k">*</span>/mysql
<span class="nb">cp </span>guacamole-auth-jdbc-mysql-<span class="k">*</span>.jar /usr/local/share/guacamole/
<span class="nb">ln</span> <span class="nt">-s</span> /usr/local/share/guacamole/guacamole-auth-jdbc-mysql-<span class="k">*</span>.jar /etc/guacamole/extensions</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insÃ©rez ici l&#8217;adresse du fichier guacamole-auth-jdbc Ã  charger</td>
</tr>
</table>
</div>
</li>
<li>
<p>CrÃ©ez les tables de la base:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>schema
<span class="nb">cat</span> <span class="k">*</span>.sql | mysql <span class="nt">-u</span> cxguacamole <span class="nt">-p</span> cxguacamole <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>mettez derriÃ¨re le <code>-u</code> le nom d&#8217;utilisateur de la base de donnÃ©es et derriÃ¨re le <code>-p</code> le nom de la base de donnÃ©es. Un mot de passe vous sera demandÃ©.</td>
</tr>
</table>
</div>
</li>
<li>
<p>RedÃ©marrez tomcat et guacd. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl restart tomcat9
systemctl restart guacd</code></pre>
</div>
</div>
</li>
<li>
<p>Allez sur le site de <code>guacamole.example.com/guacamole</code></p>
</li>
<li>
<p>Loguez vous avec le compte: <code>guacadmin</code> et password: <code>guacadmin</code></p>
</li>
<li>
<p>Commencez par cliquez sur <code>guacadmin</code> &#8594; <code>paramÃ¨tres</code> &#8594; <code>utilisateurs</code>&#8594; <code>Nouvel Utilisateur</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Identifiant</code> &#8592; Tapez <code>admin</code></p>
</li>
<li>
<p><code>Mot de passe</code> &#8592; Tapez votre <a href="#pass_gen">mot de passe gÃ©nÃ©rÃ©</a></p>
</li>
<li>
<p><code>RÃ©pÃ©tez mot de passe</code> &#8592; Retapez votre mot de passe</p>
</li>
<li>
<p><code>Permissions</code> &#8592; activer toutes les options</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deconnectez vous et reconnectez vous avec le login <code>admin</code></p>
</li>
<li>
<p>cliquez sur <code>admin</code> &#8594; <code>paramÃ¨tres</code> &#8594; <code>utilisateurs</code> &#8594; <code>guacadmin</code></p>
</li>
<li>
<p>Supprimez ce compte utilisateur</p>
</li>
<li>
<p>Si vous avez activÃ© VNC. Cliquez sur <code>Admin</code> &#8594; <code>ParamÃ¨tres</code> &#8594; <code>Utilisateurs</code> &#8594; <code>Connexions</code> &#8594; <code>Nouvelle Connexion</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Nom</code> &#8592; Tapez <code>Local server VNC</code></p>
</li>
<li>
<p><code>Protocole</code> &#8592; SÃ©lectionnez <code>VNC</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>Nom dâhÃ´te</code> &#8592; Tapez <code>Localhost</code></p>
</li>
<li>
<p>Cochez <code>SFTP</code> &#8594; <code>Activer SFTP</code></p>
</li>
<li>
<p><code>SFTP</code> &#8594; <code>Nom d&#8217;hÃ´te</code> &#8592; Tapez <code>Localhost</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>port</code> &#8592; Tapez <code>5900</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>Mot de passe</code> &#8592; Tapez votre mot de passe VNC de votre machine locale.</p>
</li>
<li>
<p><code>SFTP</code> &#8594; <code>Mot de passe</code> &#8592; Tapez un mot de passe sur votre HÃ´te</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cliquez sur <code>Admin</code> &#8594; <code>ParamÃ¨tres</code> &#8594; <code>Utilisateurs</code> &#8594; <code>Connexions</code> &#8594; <code>Nouvelle Connexion</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Nom</code> &#8592; Tapez <code>Local server SSH</code></p>
</li>
<li>
<p><code>Protocole</code> &#8592; SÃ©lectionnez <code>SSH</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>Nom dâhÃ´te</code> &#8592; Tapez <code>Localhost</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>port</code> &#8592; Tapez <code>22</code></p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>Identifiant</code> &#8592; Tapez un login sur votre HÃ´te</p>
</li>
<li>
<p><code>ParamÃ¨tres</code> &#8594; <code>Mot de passe</code> &#8592; Tapez votre mot de passe de compte</p>
</li>
<li>
<p>Cochez <code>SFTP</code> &#8594; <code>Activer SFTP</code></p>
</li>
<li>
<p><code>SFTP</code> &#8594; <code>File browser root directory</code> &#8592; Tapez <code>/</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Vous pouvez maintenant vÃ©rifier vos connexions en vous loguant avec l&#8217;un des deux profils.</p>
</li>
<li>
<p>l&#8217;appui simultanÃ© sur <code>SHIFT</code> <code>CTRL</code> <code>ALT</code> fait apparaÃ®tre un menu pour effectuer des chargements de fichiers ou contrÃ´ler votre connexion</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade_de_guacamole">34.4. Upgrade de Guacamole</h3>
<div class="paragraph">
<p>Il est nÃ©cessaire de regÃ©nÃ©rer les logiciels avec les derniÃ¨res versions.</p>
</div>
<div class="paragraph">
<p>Appliquez la procÃ©dure suivante:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>ArrÃªtez le serveur guacamole</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">systemctl stop guacd</code></pre>
</div>
</div>
</li>
<li>
<p>TÃ©lÃ©chargez la derniÃ¨re version de Guacamole en allant sur le site web et en rÃ©cupÃ©rant le <a href="https://guacamole.apache.org/releases/">lien de tÃ©lÃ©chargement</a>.</p>
</li>
<li>
<p>tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /tmp
curl <span class="nt">-fSL</span> <span class="nt">-o</span> guacamole-server.tar.gz <span class="s1">'http://apache.org/dyn/closer.cgi?action=download&amp;filename=guacamole/1.2.0/source/guacamole-server-1.2.0.tar.gz'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nb">tar </span>xfz guacamole-server.tar.gz
<span class="nb">cd </span>guacamole-server-<span class="k">*</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insÃ©rez ici l&#8217;adresse du package serveur Ã  charger</td>
</tr>
</table>
</div>
</li>
<li>
<p>Lancez la configuration. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">./configure <span class="nt">--with-init-dir</span><span class="o">=</span>/etc/init.d</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez la compilation et l&#8217;installation. Tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">make
make <span class="nb">install
</span>ldconfig</code></pre>
</div>
</div>
</li>
<li>
<p>TÃ©lÃ©chargez le dernier client <code>war</code> de Guacamole en allant sur le site web et en rÃ©cupÃ©rant le <a href="https://guacamole.apache.org/releases/">lien de tÃ©lÃ©chargement</a>. RÃ©cupÃ©rez le lien puis tapez:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd</span> /usr/local/share/guacamole
curl <span class="nt">-fSL</span> <span class="nt">-o</span> guacamole.war <span class="s1">'http://apache.org/dyn/closer.cgi?action=download&amp;filename=guacamole/1.2.0/binary/guacamole-1.2.0.war'</span> <i class="conum" data-value="1"></i><b>(1)</b>
systemctl daemon-reload
systemctl restart tomcat9 <i class="conum" data-value="2"></i><b>(2)</b>
systemctl start guacd</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>insÃ©rez ici l&#8217;adresse du war Ã  charger</td>
</tr>
</table>
</div>
</li>
<li>
<p>Allez sur le site de <code>guacamole.example.com/guacamole</code></p>
</li>
<li>
<p>VÃ©rifiez que tout fonctionne</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annexe">35. Annexe</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_de_hestia">35.1. Installation de Hestia</h3>
<div class="paragraph">
<p><code>Hestia</code> est basÃ© sur VestaCP. C&#8217;est une alternative opensource et plus moderne de cet outil.
La documentation est proposÃ©e ici: <a href="https://docs.hestiacp.com/" class="bare">https://docs.hestiacp.com/</a></p>
</div>
<div class="paragraph">
<p>Attention <code>Hestia</code> n&#8217;est pas compatible de <code>Webmin</code> dans le sens que <code>Webmin</code> est incapable de lire et d&#8217;interprÃ©ter les fichiers crÃ©Ã©s par <code>Hestia</code>.</p>
</div>
<div class="paragraph">
<p>De mÃªme, <code>Hestia</code> est principalement compatible de PHP. Si vous utilisez des systÃ¨me web basÃ©s sur des applicatifs Ã©crits en Python ou en Ruby, la configuration sera Ã  faire Ã  la main avec tous les problÃ¨mes de compatibilitÃ© que cela impose.</p>
</div>
<div class="paragraph">
<p>Pour installer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#root_login">Loguez vous comme root sur le serveur</a></p>
</li>
<li>
<p>TÃ©lÃ©charger le package et lancez lâinstalleur</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">wget https://raw.githubusercontent.com/hestiacp/hestiacp/release/install/hst-install.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Lancez l&#8217;installeur. Tapez :</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">bash hst-install.sh <span class="nt">-g</span> <span class="nb">yes</span> <span class="nt">-o</span> <span class="nb">yes</span></code></pre>
</div>
</div>
</li>
<li>
<p>Si le systÃ¨me n&#8217;est pas compatible, HestiaCP vous le dira. Sinon,  il vous informe de la configuration qui sera installÃ©e. Tapez <code>Y</code> pour continuer.</p>
</li>
<li>
<p>Entrez votre adresse mail standard et indÃ©pendante du futur serveur qui sera installÃ©. ce peut Ãªtre une adresse gmail.com par exemple.</p>
</li>
</ol>
</div>
</li>
<li>
<p><code>Hestia</code> est installÃ©. Il est important de bien noter le mot de passe du compte admin de <code>Hestia</code> ainsi que le numÃ©ro de port du site web</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_dun_Ã©cran_3_5_inch_rpi_lcd_a">35.2. Configuration d&#8217;un Ã©cran 3.5 inch RPI LCD (A)</h3>
<div class="sect3">
<h4 id="_pour_commencer">35.2.1. Pour commencer</h4>
<div class="paragraph">
<p>Le RPi LCD peut Ãªtre pilotÃ© de deux maniÃ¨res :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>installer le pilote sur votre
Raspbian OS.</p>
</li>
<li>
<p>utiliser le fichier image prÃªt Ã  l&#8217;emploi ou lle pilote LCD est prÃ©installÃ©.</p>
</li>
<li>
<p>TÃ©lÃ©chargez la derniÃ¨re image sur le site web de Raspberry Pi et Ã©crivez-la sur la carte SD.</p>
</li>
<li>
<p>Connectez l&#8217;Ã©cran LCD RPI Ã  Raspberry Pi et connectez le Pi au rÃ©seau.</p>
</li>
<li>
<p>Configurez votre Pi :</p>
<div class="literalblock">
<div class="content">
<pre>sudo raspi-config</pre>
</div>
</div>
</li>
<li>
<p>configurez ainsi :</p>
<div class="ulist">
<ul>
<li>
<p>SÃ©lectionnez "Expand Filesystem".</p>
</li>
<li>
<p>Boot Option &#8594; Desktop Autologin (peut diffÃ©rer selon la rÃ©vision Raspbian)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ouvrez le terminal du Raspberry PI (Vous devrez peut-Ãªtre connecter un clavier et un Ã©cran LCD HDMI Ã  PI pour l&#8217;installation du pilote). Tapez:</p>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/waveshare/LCD-show.git
cd LCD-show/</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note: Une connexion rÃ©seau est nÃ©cessaire lors de l&#8217;installation du pilote sur votre Pi, sinon l&#8217;installation ne fonctionnera pas correctement.</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x LCD35-show
./LCD35-show</pre>
</div>
</div>
</li>
<li>
<p>AprÃ¨s le redÃ©marrage du systÃ¨me, le RPI LCD est prÃªt Ã  l&#8217;emploi.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_basculer_entre_laffichage_lcd_et_hdmi">35.2.2. Basculer entre l&#8217;affichage LCD et HDMI</h4>
<div class="paragraph">
<p>Une fois que l&#8217;Ã©cran LCD est activÃ©, les paramÃ¨tres par dÃ©faut pour HDMI sont modifiÃ©s. Si vous souhaitez utiliser un autre moniteur HDMI, veuillez exÃ©cuter la commande suivante :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD-hdmi</pre>
</div>
</div>
<div class="paragraph">
<p>Cela permet de basculer le mode sur l&#8217;affichage LCD :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>chmod +x LCD35-show
./LCD35-show</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_paramÃ¨tres_dorientation_de_lÃ©cran">35.2.3. ParamÃ¨tres d&#8217;orientation de l&#8217;Ã©cran</h4>
<div class="paragraph">
<p>Une fois le pilote tactile installÃ©, l&#8217;orientation de l&#8217;Ã©cran peut Ãªtre dÃ©finie par ces commandes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 0 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 0</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 90 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 90</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 180 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 180</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rotation de 270 degrÃ©s</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>cd LCD-show/
./LCD35-show 270</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calibrage_de_lÃ©cran_tactile">35.2.4. Calibrage de l&#8217;Ã©cran tactile</h4>
<div class="paragraph">
<p>Cet Ã©cran LCD peut Ãªtre calibrÃ© Ã  l&#8217;aide d&#8217;un programme appelÃ© <code>xinput_calibrator</code> . Il n&#8217;est pas prÃ©installÃ© sur le systÃ¨me d&#8217;exploitation Raspbian original. Vous devez donc le tÃ©lÃ©charger et installer le programme manuellement.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo apt-get install -y xinput-calibrator</pre>
</div>
</div>
<div class="paragraph">
<p>Entrez les commandes suivantes pour le calibrage de l&#8217;Ã©cran tactile :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo DISPLAY=:0.0 xinput_calibrator</pre>
</div>
</div>
<div class="paragraph">
<p>ou SÃ©lectionnez Menu &#8594; Preferences &#8594; Calibrate Touchscreen.</p>
</div>
<div class="paragraph">
<p>AprÃ¨s l&#8217;exÃ©cution de ces commandes, l&#8217;Ã©cran LCD affiche une invite pour un calibrage en quatre points. Cliquez sur les points un par un pour terminer le calibrage tactile. Ensuite, les nouvelles donnÃ©es de calibrage seront affichÃ©es dans le terminal, comme indiquÃ© ci-dessous. Veuillez obtenir ces donnÃ©es pour une utilisation ultÃ©rieure.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Doing dynamic recalibration:
Setting new calibration data: 3919, 208, 236, 3913</pre>
</div>
</div>
<div class="paragraph">
<p>Tapez la commande suivante pour Ã©diter 99-calibration.conf:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo nano /etc/X11/xorg.conf.d/99-calibration.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Ensuite, les anciennes donnÃ©es d&#8217;Ã©talonnage seront affichÃ©es dans le terminal :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Section "InputClass"
Identifier  "calibration"
MatchProduct    "ADS7846 Touchscreen"
Option  "Calibration"   "160 3723 3896 181"
Option  "SwapAxes"  "1"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>Modifiez les donnÃ©es d&#8217;Ã©talonnage en fonction des nouvelles donnÃ©es d&#8217;Ã©talonnage affichÃ©es plus haut :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Section "InputClass"
Identifier  "calibration"
MatchProduct    "ADS7846 Touchscreen"
Option  "Calibration"   "3919 208 236 3913"
Option  "SwapAxes"  "1"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>Appuyez sur les touches Ctrl+X, et sÃ©lectionnez l&#8217;option Y pour enregistrer la modification.</p>
</div>
<div class="paragraph">
<p>La modification sera valide aprÃ¨s le redÃ©marrage du systÃ¨me. Entrez la commande suivante pour le redÃ©marrage du systÃ¨me :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Notices: En cas de toucher imprÃ©cis, veuillez procÃ©der Ã  un nouvel Ã©talonnage de l&#8217;Ã©cran et redÃ©marrer le systÃ¨me.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_installer_un_clavier_virtuel">35.2.5. Installer un clavier virtuel</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Installer matchbox-keyboard</p>
<div class="literalblock">
<div class="content">
<pre>sudo apt-get install update
sudo apt-get install matchbox-keyboard
sudo nano /usr/bin/toggle-matchbox-keyboard.sh</pre>
</div>
</div>
</li>
<li>
<p>Copiez les commandes ci-dessous dans toggle-matchbox-keyboard.sh et sauvegardez.</p>
<div class="literalblock">
<div class="content">
<pre>#!/bin/bash
#This script toggle the virtual keyboard
PID=`pidof matchbox-keyboard`
if [Â ! -e $PID ]; then
killall matchbox-keyboard
else
matchbox-keyboard -s 50 extended&amp;
fi</pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez les commandes:</p>
<div class="literalblock">
<div class="content">
<pre>sudo chmod +x /usr/bin/toggle-matchbox-keyboard.sh
sudo mkdir /usr/local/share/applications
sudo nano /usr/local/share/applications/toggle-matchbox-keyboard.desktop</pre>
</div>
</div>
</li>
<li>
<p>Copiez les commandes ci-dessous dans toggle-matchbox-keyboard.desktop et sauvegardez.</p>
<div class="literalblock">
<div class="content">
<pre>[Desktop Entry]
Name=Toggle Matchbox Keyboard
Comment=Toggle Matchbox Keyboard`
Exec=toggle-matchbox-keyboard.sh
Type=Application
Icon=matchbox-keyboard.png
Categories=Panel;Utility;MB
X-MB-INPUT-MECHANSIM=True</pre>
</div>
</div>
</li>
<li>
<p>ExÃ©cutez les commandes ci dessous.</p>
<div class="paragraph">
<p><strong>NOTE: Notez que vous devez utiliser les droits d&#8217;utilisateur "Pi" au lieu de root pour exÃ©cuter cette commande</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>nano ~/.config/lxpanel/LXDE-pi/panels/panel</pre>
</div>
</div>
</li>
<li>
<p>Trouvez la dÃ©claration qui est similaire Ã  celle ci-dessous : (Elle peut Ãªtre diffÃ©rente dans une autre version)</p>
<div class="literalblock">
<div class="content">
<pre>Plugin {
  type = launchbar
  Config {
    Button {
      id=lxde-screenlock.desktop
    }
    Button {
      id=lxde-logout.desktop
    }
  }
}</pre>
</div>
</div>
</li>
<li>
<p>Ajoutez ces dÃ©clarations pour ajouter une option de bouton :</p>
<div class="literalblock">
<div class="content">
<pre>Button {
  id=/usr/local/share/applications/toggle-matchbox-keyboard.desktop
}</pre>
</div>
</div>
</li>
<li>
<p>redÃ©marrez votre Raspberry Pi. Si le clavier virtuel est correctement installÃ©, vous pouvez constater qu&#8217;il y a une icÃ´ne de clavier sur la gauche de la barre</p>
<div class="literalblock">
<div class="content">
<pre>sudo reboot</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_ressources">35.2.6. Ressources</h4>
<div class="sect4">
<h5 id="_manuel_utilisateur">Manuel utilisateur</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.waveshare.com/w/upload/1/1e/RPi_LCD_User_Manual_EN.pdf">RPiLCD User Manual</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_images">Images</h5>
<div class="paragraph">
<p>Description : si vous avez eu du mal Ã  installer le pilote, essayez l&#8217;image avec le pilote prÃ©installÃ©.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://drive.google.com/open?id=1xsvANujoImwVQvdf0n7IiUjP8BuCe2GK">RPi-35inch-LCD-(A)-Raspbian-180326.7z</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_driver">Driver</h5>
<div class="paragraph">
<p>Le pilote peut Ãªtre tÃ©lÃ©chargÃ© sur github</p>
</div>
<div class="literalblock">
<div class="content">
<pre>git clone https://github.com/waveshare/LCD-show.git</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fichiers_de_configuration_de_rÃ©fÃ©rence">Fichiers de configuration de rÃ©fÃ©rence</h5>
<div class="paragraph">
<p>/boot/cmdline.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dwc_otg.lpm_enable=0 console=tty1 console=ttyAMA0,115200 root=/dev/mmcblk0p7 rootfstype=ext4 elevator=deadline rootwait fbcon=map:10 fbcon=font:ProFont6x11 logo.nologo</pre>
</div>
</div>
<div class="paragraph">
<p>/boot/config.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre># For more options and information see
# http://www.raspberrypi.org/documentation/configuration/config-txt.md
# Some settings may impact device functionality. See link above for details

# uncomment if you get no picture on HDMI for a default "safe" mode
#hdmi_safe=1

# uncomment this if your display has a black border of unused pixels visible
# and your display can output without overscan
#disable_overscan=1

# uncomment the following to adjust overscan. Use positive numbers if console
# goes off screen, and negative if there is too much border
#overscan_left=16
#overscan_right=16
#overscan_top=16
#overscan_bottom=16

# uncomment to force a console size. By default it will be display's size minus
# overscan.
#framebuffer_width=1280
#framebuffer_height=720

# uncomment if hdmi display is not detected and composite is being output
hdmi_force_hotplug=1

# uncomment to force a specific HDMI mode (this will force VGA)
#hdmi_group=1
#hdmi_mode=1

# uncomment to force a HDMI mode rather than DVI. This can make audio work in
# DMT (computer monitor) modes
#hdmi_drive=2

# uncomment to increase signal to HDMI, if you have interference, blanking, or
# no display
#config_hdmi_boost=4

# uncomment for composite PAL
#sdtv_mode=2

#uncomment to overclock the arm. 700 MHz is the default.
#arm_freq=800

# Uncomment some or all of these to enable the optional hardware interfaces
dtparam=i2c_arm=on
#dtparam=i2s=on
dtparam=spi=on
enable_uart=1
# Uncomment this to enable the lirc-rpi module
#dtoverlay=lirc-rpi

# Additional overlays and parameters are documented /boot/overlays/README

# Enable audio (loads snd_bcm2835)
dtparam=audio=on
dtoverlay=tft35a
#dtoverlay=ads7846,cs=1,penirq=17,penirq_pull=2,speed=1000000,keep_vref_on=1,swapxy=1,pmax=255,xohms=60,xmin=200,xmax=3900,ymin=200,ymax=3900</pre>
</div>
</div>
<div class="paragraph">
<p>/etc/inittab</p>
</div>
<div class="paragraph">
<p>Ajouter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Spawn a getty on Raspberry Pi serial line
T0:23:respawn:/sbin/getty -L ttyAMA0 115200 vt100</pre>
</div>
</div>
<div class="paragraph">
<p>/usr/share/X11/xorg.conf/99-fbturbo.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "Device"
        Identifier      "Allwinner A10/A13/A20 FBDEV"
        Driver          "fbturbo"
        Option          "fbdev" "/dev/fb1"

        Option          "SwapbuffersWait" "true"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>/usr/share/X11/xorg.conf.d/40-libinput.conf
/usr/share/X11/xorg.conf.d/45-evdev.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "InputClass"
        Identifier "libinput pointer catchall"
        MatchIsPointer "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput keyboard catchall"
        MatchIsKeyboard "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput touchpad catchall"
        MatchIsTouchpad "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput touchscreen catchall"
        MatchIsTouchscreen "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection

Section "InputClass"
        Identifier "libinput tablet catchall"
        MatchIsTablet "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>/etc/X11/xorg.conf.d/99-calibration.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Section "InputClass"
        Identifier      "calibration"
        MatchProduct    "ADS7846 Touchscreen"
        Option  "Calibration"   "3936 227 268 3880"
        Option  "SwapAxes"      "1"
EndSection</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.7<br>
Last updated 2024-05-27 22:54:05 +0200
</div>
</div>
</body>
</html>